$(document).ready(function(){var n=!1,a=0,t=$(".round1"),r=$(".round2"),o=$(".round3"),s=$(".box-inner"),i=$(".voice-msg"),l=$(".speak-btn"),c=function(e){t[0==e?"hide":"show"](),r[0==e?"hide":"show"](),0==e&&(o.removeAttr("style"),s.removeAttr("style"))},d=function(){var e=l.data("speakTimer");clearInterval(e),l.removeClass("speaking"),n=!1},v=new voiceWorker({callback:{onResult:function(e){e.done(function(e){var t=$.parseJSON(e),a=t.data;if(t.status)if(0!=a.code||Ls.isEmpty(a.data))i.html("识别失败，请点击按钮后再说一次。");else{i.html("正在搜索结果，请稍候！");var r=a.data.replace(/，|。|！/gi," ");sendKeyWords(r)}c(!1),l.removeClass("speaking"),n=!1})},onProcess:function(e){Ls.log(e),"lowVolume"==e?(v.stop(),c(!1)):"onStart"==e?(c(),i.html("语音识别中...")):"onStop"==e&&(c(!1),d(),v.recorderWorker.getRecord())},onVolume:function(e,t){l.addClass("speaking");var a=Math.max.apply(Math,t),r=(1-a)*(1-a)*36;s.height(r);var n={width:e+61+"px",height:e+61+"px",margin:11-e/2+"px 0 0 -"+e/2+"px"};$(".round3").css(n)},onError:function(e,t){d(),alert(t)}}});document.addEventListener&&document.addEventListener("visibilitychange",function(){1==document.hidden&&v.kill()}),l.click(function(){var e=$(this),t=e.data("speakTimer");if(a=0,clearInterval(t),t=setInterval(function(){if(30<++a)return n=!1,clearInterval(t),e.removeClass("speaking"),void v.stop()},1e3),e.data("speakTimer",t),e.hasClass("speaking"))return clearInterval(t),e.removeClass("speaking"),n=!1,v.stop(),!1;n?(clearInterval(t),v.stop()):(n=!0,v.start())}),v.isSupport()?$(".voice-worker").show():$(".voice-worker").hide()});