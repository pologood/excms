!function(R){"use strict";var l={data:void 0,lang:"cn",multiple:!1,pagination:!0,dropButton:!0,listSize:10,multipleControlbar:!0,maxSelectLimit:0,selectToCloseList:!1,initRecord:void 0,dbTable:"tbl",keyField:"id",showField:"name",searchField:void 0,andOr:"AND",orderBy:void 0,pageSize:10,params:void 0,formatItem:void 0,autoFillResult:!1,autoSelectFirst:!1,noResultClean:!0,selectOnly:!1,inputDelay:.5,eSelect:void 0,eOpen:void 0,eAjaxSuccess:void 0,eTagRemove:void 0,eClear:void 0},p=function(e,t){this.setOption(t),this.setLanguage(),this.setCssClass(),this.setProp(),this.setElem(e),this.setButtonAttrDefault(),this.setInitRecord(),this.eDropdownButton(),this.eInput(),this.eWhole()};function o(e){return R(e).closest("div.sp_container").find("input.sp_input")}p.version="2.18",p.dataKey="selectPageObject",p.prototype.setOption=function(e){e.searchField=e.searchField||e.showField,e.andOr=e.andOr.toUpperCase(),"AND"!==e.andOr&&"OR"!==e.andOr&&(e.andOr="AND");for(var t=["searchField"],a=0;a<t.length;a++)e[t[a]]=this.strToArray(e[t[a]]);e.orderBy=e.orderBy||e.showField,e.orderBy=this.setOrderbyOption(e.orderBy,e.showField),e.multiple&&!e.selectToCloseList&&(e.autoFillResult=!1,e.autoSelectFirst=!1),e.pagination||(e.pageSize=200),("number"!==R.type(e.listSize)||e.listSize<0)&&(e.listSize=10),this.option=e},p.prototype.strToArray=function(e){return e?e.replace(/[\s　]+/g,"").split(","):""},p.prototype.setOrderbyOption=function(e,t){var a=[],o=[];if("object"==typeof e)for(var l=0;l<e.length;l++)o=R.trim(e[l]).split(" "),a[l]=2==o.length?o:[o[0],"ASC"];else o=R.trim(e).split(" "),a[0]=2==o.length?o:o[0].match(/^(ASC|DESC)$/i)?[t,o[0]]:[o[0],"ASC"];return a},p.prototype.setLanguage=function(){var e,t=this.option;switch(t.lang){case"de":e={add_btn:"Hinzufügen-Button",add_title:"Box hinzufügen",del_btn:"Löschen-Button",del_title:"Box löschen",next:"Nächsten",next_title:"Nächsten"+t.pageSize+" (Pfeil-rechts)",prev:"Vorherigen",prev_title:"Vorherigen"+t.pageSize+" (Pfeil-links)",first_title:"Ersten (Umschalt + Pfeil-links)",last_title:"Letzten (Umschalt + Pfeil-rechts)",get_all_btn:"alle (Pfeil-runter)",get_all_alt:"(Button)",close_btn:"Schließen (Tab)",close_alt:"(Button)",loading:"lade...",loading_alt:"(lade)",page_info:"page_num von page_count",select_ng:"Achtung: Bitte wählen Sie aus der Liste aus.",select_ok:"OK : Richtig ausgewählt.",not_found:"nicht gefunden",ajax_error:"Bei der Verbindung zum Server ist ein Fehler aufgetreten.",clear:"Löschen Sie den Inhalt",select_all:"Wähle diese Seite",unselect_all:"Diese Seite entfernen",clear_all:"Alles löschen",max_selected:"Sie können nur bis zu max_selected_limit Elemente auswählen"};break;case"en":e={add_btn:"Add button",add_title:"add a box",del_btn:"Del button",del_title:"delete a box",next:"Next",next_title:"Next"+t.pageSize+" (Right key)",prev:"Prev",prev_title:"Prev"+t.pageSize+" (Left key)",first_title:"First (Shift + Left key)",last_title:"Last (Shift + Right key)",get_all_btn:"Get All (Down key)",get_all_alt:"(button)",close_btn:"Close (Tab key)",close_alt:"(button)",loading:"loading...",loading_alt:"(loading)",page_info:"page_num of page_count",select_ng:"Attention : Please choose from among the list.",select_ok:"OK : Correctly selected.",not_found:"not found",ajax_error:"An error occurred while connecting to server.",clear:"Clear content",select_all:"Select current page",unselect_all:"Clear current page",clear_all:"Clear all selected",max_selected:"You can only select up to max_selected_limit items"};break;case"es":e={add_btn:"Agregar boton",add_title:"Agregar una opcion",del_btn:"Borrar boton",del_title:"Borrar una opcion",next:"Siguiente",next_title:"Proximas "+t.pageSize+" (tecla derecha)",prev:"Anterior",prev_title:"Anteriores "+t.pageSize+" (tecla izquierda)",first_title:"Primera (Shift + Left)",last_title:"Ultima (Shift + Right)",get_all_btn:"Ver todos (tecla abajo)",get_all_alt:"(boton)",close_btn:"Cerrar (tecla TAB)",close_alt:"(boton)",loading:"Cargando...",loading_alt:"(Cargando)",page_info:"page_num de page_count",select_ng:"Atencion: Elija una opcion de la lista.",select_ok:"OK: Correctamente seleccionado.",not_found:"no encuentre",ajax_error:"Un error ocurrió mientras conectando al servidor.",clear:"Borrar el contenido",select_all:"Elija esta página",unselect_all:"Borrar esta página",clear_all:"Borrar todo marcado",max_selected:"Solo puedes seleccionar hasta max_selected_limit elementos"};break;case"pt-br":e={add_btn:"Adicionar botão",add_title:"Adicionar uma caixa",del_btn:"Apagar botão",del_title:"Apagar uma caixa",next:"Próxima",next_title:"Próxima "+t.pageSize+" (tecla direita)",prev:"Anterior",prev_title:"Anterior "+t.pageSize+" (tecla esquerda)",first_title:"Primeira (Shift + Left)",last_title:"Última (Shift + Right)",get_all_btn:"Ver todos (Seta para baixo)",get_all_alt:"(botão)",close_btn:"Fechar (tecla TAB)",close_alt:"(botão)",loading:"Carregando...",loading_alt:"(Carregando)",page_info:"page_num de page_count",select_ng:"Atenção: Escolha uma opção da lista.",select_ok:"OK: Selecionado Corretamente.",not_found:"não encontrado",ajax_error:"Um erro aconteceu enquanto conectando a servidor.",clear:"Limpe o conteúdo",select_all:"Selecione a página atual",unselect_all:"Remova a página atual",clear_all:"Limpar tudo",max_selected:"Você só pode selecionar até max_selected_limit itens"};break;case"ja":e={add_btn:"追加ボタン",add_title:"入力ボックスを追加します",del_btn:"削除ボタン",del_title:"入力ボックスを削除します",next:"次へ",next_title:"次の"+t.pageSize+"件 (右キー)",prev:"前へ",prev_title:"前の"+t.pageSize+"件 (左キー)",first_title:"最初のページへ (Shift + 左キー)",last_title:"最後のページへ (Shift + 右キー)",get_all_btn:"全件取得 (下キー)",get_all_alt:"画像:ボタン",close_btn:"閉じる (Tabキー)",close_alt:"画像:ボタン",loading:"読み込み中...",loading_alt:"画像:読み込み中...",page_info:"page_num 件 (全 page_count 件)",select_ng:"注意 : リストの中から選択してください",select_ok:"OK : 正しく選択されました。",not_found:"(0 件)",ajax_error:"サーバとの通信でエラーが発生しました。",clear:"コンテンツをクリアする",select_all:"当ページを選びます",unselect_all:"移して当ページを割ります",clear_all:"選択した項目をクリアする",max_selected:"最多で max_selected_limit のプロジェクトを選ぶことしかできません"};break;case"cn":default:e={add_btn:"添加按钮",add_title:"添加区域",del_btn:"删除按钮",del_title:"删除区域",next:"下一页",next_title:"下"+t.pageSize+" (→)",prev:"上一页",prev_title:"上"+t.pageSize+" (←)",first_title:"首页 (Shift + ←)",last_title:"尾页 (Shift + →)",get_all_btn:"获得全部 (↓)",get_all_alt:"(按钮)",close_btn:"关闭 (Tab键)",close_alt:"(按钮)",loading:"读取中...",loading_alt:"(读取中)",page_info:"第 page_num 页(共page_count页)",select_ng:"请注意：请从列表中选择.",select_ok:"OK : 已经选择.",not_found:"无查询结果",ajax_error:"连接到服务器时发生错误！",clear:"清除内容",select_all:"选择当前页项目",unselect_all:"取消选择当前页项目",clear_all:"清除全部已选择项目",max_selected:"最多只能选择 max_selected_limit 个项目"}}this.message=e},p.prototype.setCssClass=function(){this.css_class={container:"sp_container",container_open:"sp_container_open",re_area:"sp_result_area",result_open:"sp_result_area_open",control_box:"sp_control_box",element_box:"sp_element_box",navi:"sp_navi",results:"sp_results",re_off:"sp_results_off",select:"sp_over",select_ok:"sp_select_ok",select_ng:"sp_select_ng",selected:"sp_selected",input_off:"sp_input_off",message_box:"sp_message_box",disabled:"sp_disabled",button:"sp_button",btn_on:"sp_btn_on",btn_out:"sp_btn_out",input:"sp_input",clear_btn:"sp_clear_btn",align_right:"sp_align_right"}},p.prototype.setProp=function(){this.prop={disabled:!1,current_page:1,max_page:1,is_loading:!1,xhr:!1,key_paging:!1,key_select:!1,prev_value:"",selected_text:"",last_input_time:void 0,init_set:!1},this.template={tag:{content:'<li class="selected_tag" itemvalue="#item_value#">#item_text#<span class="tag_close"><i class="iconfont if-close"></i></span></li>',textKey:"#item_text#",valueKey:"#item_value#"},page:{current:"page_num",total:"page_count"},msg:{maxSelectLimit:"max_selected_limit"}}},p.prototype.elementRealSize=function(e,t){var a,o,l={absolute:!1,clone:!1,includeMargin:!1,display:"block"},n=e.eq(0),i=[],s="";a=function(){o.each(function(e){var t=R(this),a=i[e];void 0===a?t.removeAttr("style"):t.attr("style",a)})},function(){o=n.parents().addBack().filter(":hidden"),s+="visibility: hidden !important; display: "+l.display+" !important; ",!0===l.absolute&&(s+="position: absolute !important;"),o.each(function(){var e=R(this),t=e.attr("style");i.push(t),e.attr("style",t?t+";"+s:s)})}();var r=/(outer)/.test(t)?n[t](l.includeMargin):n[t]();return a(),r},p.prototype.setElem=function(e){var t={},a=this.option,o=this.css_class,l=this.message,n=R(e),i=n.outerWidth();i<=0&&(i=this.elementRealSize(n,"outerWidth")),i<150&&(i=150),t.combo_input=n.attr({autocomplete:"off"}).addClass(o.input).wrap("<div>"),a.selectOnly&&t.combo_input.prop("readonly",!0),t.container=t.combo_input.parent().addClass(o.container),t.combo_input.prop("disabled")&&(a.multiple?t.container.addClass(o.disabled):t.combo_input.addClass(o.input_off)),t.container.width(i),t.button=R("<div>").addClass(o.button),t.dropdown=R('<span class="sp_caret"></span>'),t.clear_btn=R("<div>").html(R("<i>").addClass("iconfont if-close")).addClass(o.clear_btn).attr("title",l.clear),a.dropButton||t.clear_btn.addClass(o.align_right),t.element_box=R("<ul>").addClass(o.element_box),a.multiple&&a.multipleControlbar&&(t.control=R("<div>").addClass(o.control_box)),t.result_area=R("<div>").addClass(o.re_area),a.pagination&&(t.navi=R("<div>").addClass("sp_pagination").append("<ul>")),t.results=R("<ul>").addClass(o.results);var s="_text",r=t.combo_input.attr("id")||t.combo_input.attr("name"),c=t.combo_input.attr("name")||"selectPage",p=c,u=r;if(t.hidden=R('<input type="hidden" class="sp_hidden" />').attr({name:p,id:u}).val(""),t.combo_input.attr({name:c+s,id:r+s}),t.container.append(t.hidden),a.dropButton&&(t.container.append(t.button),t.button.append(t.dropdown)),R(document.body).append(t.result_area),t.result_area.append(t.results),a.pagination&&t.result_area.append(t.navi),a.multiple){a.multipleControlbar&&(t.control.append('<button type="button" class="btn btn-default sp_clear_all" ><i class="iconfont if-clear"></i></button>'),t.control.append('<button type="button" class="btn btn-default sp_unselect_all" ><i class="iconfont if-unselect-all"></i></button>'),t.control.append('<button type="button" class="btn btn-default sp_select_all" ><i class="iconfont if-select-all"></i></button>'),t.control_text=R("<p>"),t.control.append(t.control_text),t.result_area.prepend(t.control)),t.container.addClass("sp_container_combo"),t.combo_input.addClass("sp_combo_input").before(t.element_box);var d=R("<li>").addClass("input_box");d.append(t.combo_input),t.element_box.append(d),t.combo_input.attr("placeholder")&&t.combo_input.attr("placeholder_bak",t.combo_input.attr("placeholder"))}this.elem=t},p.prototype.setButtonAttrDefault=function(){this.option.dropButton&&this.elem.button.attr("title",this.message.close_btn)},p.prototype.setInitRecord=function(e){var o=this,l=o.option,t=o.elem,a="";if("undefined"!=R.type(t.combo_input.data("init"))&&(l.initRecord=String(t.combo_input.data("init"))),e||l.initRecord||!t.combo_input.val()||(l.initRecord=t.combo_input.val()),t.combo_input.val(""),e||t.hidden.val(l.initRecord),a=e&&t.hidden.val()?t.hidden.val():l.initRecord)if("object"==typeof l.data){var n=new Array,i=a.split(",");R.each(i,function(e,t){for(var a=0;a<l.data.length;a++)if(l.data[a][l.keyField]==t){n.push(l.data[a]);break}}),!l.multiple&&1<n.length&&(n=[n[0]]),o.afterInit(o,n)}else R.ajax({dataType:"json",type:"POST",url:l.data,data:{searchTable:l.dbTable,searchKey:l.keyField,searchValue:a},success:function(e){var t=null;l.eAjaxSuccess&&R.isFunction(l.eAjaxSuccess)&&(t=l.eAjaxSuccess(e)),o.afterInit(o,t.list)},error:function(e,t,a){o.ajaxErrorNotify(o,a)}})},p.prototype.afterInit=function(o,e){if(e&&(!R.isArray(e)||0!==e.length)){R.isArray(e)||(e=[e]);var l=o.option,t=o.css_class,n=function(e){var t=e[l.showField];if(l.formatItem&&R.isFunction(l.formatItem))try{t=l.formatItem(e)}catch(e){}return t};if(l.multiple)o.prop.init_set=!0,o.clearAll(o),R.each(e,function(e,t){var a={text:n(t),value:t[l.keyField]};o.isAlreadySelected(o,a)||o.addNewTag(o,a)}),o.tagValuesSet(o),o.inputResize(o),o.prop.init_set=!1;else{var a=e[0];o.elem.combo_input.val(n(a)),o.elem.hidden.val(a[l.keyField]),o.prop.prev_value=n(a),o.prop.selected_text=n(a),l.selectOnly&&o.elem.combo_input.attr("title",o.message.select_ok).removeClass(t.select_ng).addClass(t.select_ok),o.putClearButton()}}},p.prototype.eDropdownButton=function(){var t=this;t.option.dropButton&&t.elem.button.mouseup(function(e){e.stopPropagation(),t.elem.result_area.is(":hidden")&&!t.elem.combo_input.prop("disabled")?t.elem.combo_input.focus():t.hideResults(t)})},p.prototype.eInput=function(){var t=this,a=t.option,o=t.elem,e=t.message,l=function(){t.prop.page_move=!1,t.suggest(t),t.setCssFocusedInput(t)};o.combo_input.keyup(function(e){t.processKey(t,e)}).keydown(function(e){t.processControl(t,e)}).focus(function(e){o.result_area.is(":hidden")&&(e.stopPropagation(),t.prop.first_show=!0,l())}),o.container.on("click.SelectPage","div."+t.css_class.clear_btn,function(e){e.stopPropagation(),t.disabled(t)||(t.clearAll(t),a.eClear&&R.isFunction(a.eClear)&&a.eClear(t))}),o.result_area.on("mousedown.SelectPage",function(e){e.stopPropagation()}),a.multiple&&(a.multipleControlbar&&(o.control.find(".sp_select_all").on("click.SelectPage",function(e){t.selectAllLine(t)}).hover(function(){o.control_text.html(e.select_all)},function(){o.control_text.html("")}),o.control.find(".sp_unselect_all").on("click.SelectPage",function(e){t.unSelectAllLine(t)}).hover(function(){o.control_text.html(e.unselect_all)},function(){o.control_text.html("")}),o.control.find(".sp_clear_all").on("click.SelectPage",function(e){t.clearAll(t)}).hover(function(){o.control_text.html(e.clear_all)},function(){o.control_text.html("")})),o.element_box.on("click.SelectPage",function(e){var t=e.target||e.srcElement;R(t).is("ul")&&o.combo_input.focus()}),o.element_box.on("click.SelectPage","span.tag_close",function(){var e=R(this).closest("li");t.removeTag(t,e),l(),a.eTagRemove&&R.isFunction(a.eTagRemove)&&a.eTagRemove(1,t)}),t.inputResize(t))},p.prototype.eWhole=function(){var o=this.css_class,l=function(e){e.elem.combo_input.val(""),e.option.multiple||e.elem.hidden.val(""),e.prop.selected_text=""};R(document.body).off("mousedown.selectPage").on("mousedown.selectPage",function(e){var t=e.target||e.srcElement,a=R(t).closest("div."+o.container);R("div."+o.container+"."+o.container_open).each(function(){if(this!=a[0]){var e=R(this).find("input."+o.input).data(p.dataKey);if(!e.elem.combo_input.val()&&e.elem.hidden.val()&&!e.option.multiple)return e.prop.current_page=1,l(e),e.hideResults(e),!0;e.elem.results.find("li").not("."+o.message_box).size()?e.option.autoFillResult?e.elem.hidden.val()?e.hideResults(e):e.elem.results.find("li.sp_over").size()?e.selectCurrentLine(e,!0):e.option.autoSelectFirst?(e.nextLine(e),e.selectCurrentLine(e,!0)):e.hideResults(e):e.hideResults(e):(e.option.noResultClean?l(e):e.option.multiple||e.elem.hidden.val(""),e.hideResults(e))}})})},p.prototype.eResultList=function(){var t=this,a=this.css_class;t.elem.results.children("li").hover(function(){t.prop.key_select?t.prop.key_select=!1:R(this).hasClass(a.selected)||R(this).hasClass(a.message_box)||(R(this).addClass(a.select),t.setCssFocusedResults(t))},function(){R(this).removeClass(a.select)}).click(function(e){t.prop.key_select?t.prop.key_select=!1:(e.preventDefault(),e.stopPropagation(),R(this).hasClass(a.selected)||t.selectCurrentLine(t,!1))})},p.prototype.eScroll=function(){var c=this.css_class;R(window).on("scroll.SelectPage",function(e){R("div."+c.container+"."+c.container_open).each(function(){var e=R(this).find("input."+c.input).data(p.dataKey),t=e.elem.result_area.offset(),a=R(window).scrollTop(),o=R(document).height(),l=R(window).height(),n=e.elem.result_area.outerHeight(),i=t.top+n,s=l<o,r=e.elem.result_area.hasClass("shadowDown");s&&(r?l+a<i&&e.calcResultsSize(e):t.top<a&&e.calcResultsSize(e))})})},p.prototype.ePaging=function(){var t=this;t.option.pagination&&(t.elem.navi.find("li.csFirstPage").off("click").on("click",function(e){e.preventDefault(),t.firstPage(t)}),t.elem.navi.find("li.csPreviousPage").off("click").on("click",function(e){e.preventDefault(),t.prevPage(t)}),t.elem.navi.find("li.csNextPage").off("click").on("click",function(e){e.preventDefault(),t.nextPage(t)}),t.elem.navi.find("li.csLastPage").off("click").on("click",function(e){e.preventDefault(),t.lastPage(t)}))},p.prototype.ajaxErrorNotify=function(e,t){e.showMessage(e.message.ajax_error)},p.prototype.showMessage=function(e,t){if(t){var a='<li class="'+e.css_class.message_box+'"><i class="iconfont if-warning"></i> '+t+"</li>";e.elem.results.empty().append(a).show(),e.calcResultsSize(e),e.setOpenStatus(e,!0),e.elem.control.hide(),e.option.pagination&&e.elem.navi.hide()}},p.prototype.scrollWindow=function(e,t){var a,o=e.getCurrentLine(e),l=o&&!t?o.offset().top:e.elem.container.offset().top;e.prop.size_li=e.elem.results.children("li:first").outerHeight(),a=e.prop.size_li;var n,i=R(window).height(),s=R(window).scrollTop(),r=s+i-a;if(o.length)if(l<s||i<a)n=l-s;else{if(!(r<l))return;n=l-r}else l<s&&(n=l-s);window.scrollBy(0,n)},p.prototype.setOpenStatus=function(e,t){var a=e.elem,o=e.css_class;t?(a.container.addClass(o.container_open),a.result_area.addClass(o.result_open)):(a.container.removeClass(o.container_open),a.result_area.removeClass(o.result_open))},p.prototype.setCssFocusedInput=function(e){},p.prototype.setCssFocusedResults=function(e){},p.prototype.checkValue=function(e){var t=e.elem.combo_input.val();t!=e.prop.prev_value&&(e.prop.prev_value=t,e.prop.first_show=!1,e.option.selectOnly&&e.setButtonAttrDefault(),e.option.multiple||t||(e.elem.combo_input.val(""),e.elem.hidden.val(""),e.elem.clear_btn.remove()),e.suggest(e))},p.prototype.processKey=function(e,t){-1===R.inArray(t.keyCode,[37,38,39,40,27,9,13])&&(16!=t.keyCode&&e.setCssFocusedInput(e),e.inputResize(e),"string"===R.type(e.option.data)?(e.prop.last_input_time=t.timeStamp,setTimeout(function(){t.timeStamp-e.prop.last_input_time==0&&e.checkValue(e)},1e3*e.option.inputDelay)):e.checkValue(e))},p.prototype.processControl=function(e,t){if(-1<R.inArray(t.keyCode,[37,38,39,40,27,9])&&e.elem.result_area.is(":visible")||-1<R.inArray(t.keyCode,[13,9])&&e.getCurrentLine(e))switch(t.preventDefault(),t.stopPropagation(),t.cancelBubble=!0,t.returnValue=!1,t.keyCode){case 37:t.shiftKey?e.firstPage(e):e.prevPage(e);break;case 38:e.prop.key_select=!0,e.prevLine(e);break;case 39:t.shiftKey?e.lastPage(e):e.nextPage(e);break;case 40:e.elem.results.children("li").length?(e.prop.key_select=!0,e.nextLine(e)):e.suggest(e);break;case 9:e.prop.key_paging=!0,e.selectCurrentLine(e,!0);break;case 13:e.selectCurrentLine(e,!0);break;case 27:e.prop.key_paging=!0,e.hideResults(e)}},p.prototype.abortAjax=function(e){e.prop.xhr&&(e.prop.xhr.abort(),e.prop.xhr=!1)},p.prototype.suggest=function(e){var t,a=R.trim(e.elem.combo_input.val());t=(t=e.option.multiple?a:a&&a===e.prop.selected_text?"":a).split(/[\s　]+/),e.option.eOpen&&R.isFunction(e.option.eOpen)&&e.option.eOpen.call(e),e.abortAjax(e);var o=e.prop.current_page||1;"object"==typeof e.option.data?e.searchForJson(e,t,o):e.searchForDb(e,t,o)},p.prototype.setLoading=function(e){""===e.elem.results.html()&&e.setOpenStatus(e,!0)},p.prototype.searchForDb=function(n,i,s){var r=n.option;r.eAjaxSuccess&&R.isFunction(r.eAjaxSuccess)||n.hideResults(n);var e=r.params,t={},a=r.searchField;i.length&&i[0]&&i[0]!==n.prop.prev_value&&(s=1);var o={q_word:i,pageNumber:s,pageSize:r.pageSize,andOr:r.andOr,orderBy:r.orderBy,searchTable:r.dbTable};if(o[a]=i[0],e&&R.isFunction(e)){var l=e.call(n);t=l&&R.isPlainObject(l)?R.extend({},o,l):o}else t=o;n.prop.xhr=R.ajax({dataType:"json",url:r.data,type:"POST",data:t,success:function(e){if(!e||!R.isPlainObject(e))return n.hideResults(n),void n.ajaxErrorNotify(n,errorThrown);var t={},a={};try{t=r.eAjaxSuccess(e),a.originalResult=t.list,a.cnt_whole=t.totalRow}catch(e){return void n.showMessage(n,n.message.ajax_error)}if(a.candidate=[],a.keyField=[],"object"!=typeof a.originalResult)return n.prop.xhr=null,void n.notFoundSearch(n);a.cnt_page=a.originalResult.length;for(var o=0;o<a.cnt_page;o++)for(var l in a.originalResult[o])l==r.keyField&&a.keyField.push(a.originalResult[o][l]),l==r.showField&&a.candidate.push(a.originalResult[o][l]);n.prepareResults(n,a,i,s)},error:function(e,t,a){"abort"!=t&&(n.hideResults(n),n.ajaxErrorNotify(n,a))},complete:function(){n.prop.xhr=null}})},p.prototype.searchForJson=function(e,t,a){for(var o=e.option,l=[],n=[],i=[],s={},r=0,c=[];n[r]=t[r].replace(/\W/g,"\\$&").toString(),c[r]=new RegExp(n[r],"gi"),++r<t.length;);for(r=0;r<o.data.length;r++){for(var p,u=!1,d=o.data[r],_=0;_<c.length;_++)if(p=d[o.searchField],o.formatItem&&R.isFunction(o.formatItem)&&(p=o.formatItem(d)),p.match(c[_])){if(u=!0,"OR"==o.andOr)break}else if(u=!1,"AND"==o.andOr)break;u&&l.push(d)}var m=new RegExp("^"+n[0]+"$","gi"),f=new RegExp("^"+n[0],"gi"),g=[],h=[],v=[];for(r=0;r<l.length;r++){var b=o.orderBy[0][0],y=String(l[r][b]);y.match(m)?g.push(l[r]):y.match(f)?h.push(l[r]):v.push(l[r])}if(o.orderBy[0][1].match(/^asc$/i)?(g=e.sortAsc(e,g),h=e.sortAsc(e,h),v=e.sortAsc(e,v)):(g=e.sortDesc(e,g),h=e.sortDesc(e,h),v=e.sortDesc(e,v)),i=i.concat(g).concat(h).concat(v),s.cnt_whole=i.length,e.prop.page_move)i.length<=(a-1)*o.pageSize&&(a=1,e.prop.current_page=1);else if(!o.multiple){var x=e.elem.hidden.val();if("undefined"!==R.type(x)&&""!==R.trim(x)){var S=0;R.each(i,function(e,t){if(t[o.keyField]==x)return S=e+1,!1}),(a=Math.ceil(S/o.pageSize))<1&&(a=1),e.prop.current_page=a}}var C=(a-1)*o.pageSize,w=C+o.pageSize;for(s.originalResult=[],r=C;r<w&&void 0!==i[r];r++)for(var k in s.originalResult.push(i[r]),i[r])k==o.keyField&&(void 0===s.keyField&&(s.keyField=[]),s.keyField.push(i[r][k])),k==o.showField&&(void 0===s.candidate&&(s.candidate=[]),s.candidate.push(i[r][k]));void 0===s.candidate&&(s.candidate=[]),s.cnt_page=s.candidate.length,e.prepareResults(e,s,t,a)},p.prototype.sortAsc=function(l,e){return e.sort(function(e,t){var a=e[l.option.orderBy[0][0]],o=t[l.option.orderBy[0][0]];return"number"===R.type(a)?a-o:String(a).localeCompare(String(o))}),e},p.prototype.sortDesc=function(l,e){return e.sort(function(e,t){var a=e[l.option.orderBy[0][0]],o=t[l.option.orderBy[0][0]];return"number"===R.type(a)?o-a:String(o).localeCompare(String(a))}),e},p.prototype.notFoundSearch=function(e){e.elem.results.empty(),e.calcResultsSize(e),e.setOpenStatus(e,!0),e.setCssFocusedInput(e)},p.prototype.prepareResults=function(e,t,a,o){e.option.pagination&&e.setNavi(e,t.cnt_whole,t.cnt_page,o),t.keyField||(t.keyField=!1),e.option.selectOnly&&1===t.candidate.length&&t.candidate[0]==a[0]&&(e.elem.hidden.val(t.keyField[0]),this.setButtonAttrDefault());var l=!1;a&&a.length&&a[0]&&(l=!0),e.displayResults(e,t,l)},p.prototype.setNavi=function(e,t,a,o){var l,n,i,s,r,c=e.message,p=e.elem.navi.find("ul"),u=Math.ceil(t/e.option.pageSize);0===u?o=0:u<o?o=u:0===o&&(o=1),e.prop.current_page=o,e.prop.max_page=u,l=e,i=o,s=u,r=function(){return c.page_info.replace(l.template.page.current,i).replace(l.template.page.total,s)},0===(n=p).find("li").size()?(n.hide().empty(),n.append('<li class="csFirstPage" title="'+c.first_title+'" ><a href="javascript:void(0);"> <i class="iconfont if-first"></i> </a></li>'),n.append('<li class="csPreviousPage" title="'+c.prev_title+'" ><a href="javascript:void(0);"><i class="iconfont if-previous"></i></a></li>'),n.append('<li class="pageInfoBox"><a href="javascript:void(0);"> '+r()+" </a></li>"),n.append('<li class="csNextPage" title="'+c.next_title+'" ><a href="javascript:void(0);"><i class="iconfont if-next"></i></a></li>'),n.append('<li class="csLastPage" title="'+c.last_title+'" ><a href="javascript:void(0);"> <i class="iconfont if-last"></i> </a></li>'),n.show()):n.find("li.pageInfoBox a").html(r());var d="disabled",_=p.find("li.csFirstPage"),m=p.find("li.csPreviousPage"),f=p.find("li.csNextPage"),g=p.find("li.csLastPage");1===o||0===o?(_.hasClass(d)||_.addClass(d),m.hasClass(d)||m.addClass(d)):(_.hasClass(d)&&_.removeClass(d),m.hasClass(d)&&m.removeClass(d)),o===u||0===u?(f.hasClass(d)||f.addClass(d),g.hasClass(d)||g.addClass(d)):(f.hasClass(d)&&f.removeClass(d),g.hasClass(d)&&g.removeClass(d)),1<u&&e.ePaging()},p.prototype.displayResults=function(e,t,a){var o=e.option,l=e.elem;if(l.results.hide().empty(),o.multiple&&"number"===R.type(o.maxSelectLimit)&&0<o.maxSelectLimit){var n=l.element_box.find("li.selected_tag").size();if(0<n&&n>=o.maxSelectLimit){var i=e.message.max_selected;return void e.showMessage(e,i.replace(e.template.msg.maxSelectLimit,o.maxSelectLimit))}}if(t.candidate.length)for(var s=t.candidate,r=t.keyField,c=l.hidden.val(),p=c?c.split(","):new Array,u="",d=0;d<s.length;d++){if(o.formatItem&&R.isFunction(o.formatItem))try{u=o.formatItem(t.originalResult[d])}catch(e){console.error("formatItem内容格式化函数内容设置不正确！"),u=s[d]}else u=s[d];var _=R("<li>").html(u).attr({pkey:r[d]});o.formatItem||_.attr("title",u),-1!==R.inArray(r[d].toString(),p)&&_.addClass(e.css_class.selected),_.data("dataObj",t.originalResult[d]),l.results.append(_)}else{var m='<li class="'+e.css_class.message_box+'"><i class="iconfont if-warning"></i> '+e.message.not_found+"</li>";l.results.append(m)}l.results.show(),o.multiple&&o.multipleControlbar&&l.control.show(),o.pagination&&l.navi.show(),e.calcResultsSize(e),e.setOpenStatus(e,!0),e.eResultList(),e.eScroll(),a&&t.candidate.length&&o.autoSelectFirst&&e.nextLine(e)},p.prototype.calcResultsSize=function(e){var m=e.option,f=e.elem,t=function(){if("static"!==f.container.css("position")){if(!m.pagination){var e=f.results.find("li:first").outerHeight(!0)*m.listSize;f.results.css({"max-height":e,"overflow-y":"auto"})}var t=R(document).width(),a=R(document).height(),o=R(window).height(),l=(_=f.container.offset(),R(window).scrollTop()),n=f.result_area.outerWidth(),i=(e=f.result_area.outerHeight(),_.left),s=f.container.outerHeight(),r=_.left+n>t?i-(n-f.container.outerWidth()):i,c=_.top,p=0,u=c+s+e+5,d=o<a;return e<c-l-5&&d&&o+l<u||!d&&o<u?(p=_.top-e-5,f.result_area.removeClass("shadowUp shadowDown").addClass("shadowUp")):(p=_.top+(m.multiple?f.container.outerHeight():s),f.result_area.removeClass("shadowUp shadowDown").addClass("shadowDown"),p+=5),{top:p+"px",left:r+"px"}}var _=f.combo_input.offset();f.result_area.css({top:_.top+f.combo_input.outerHeight()+"px",left:_.left+"px"})};if(f.result_area.is(":visible"))f.result_area.css(t());else{var a=t();f.result_area.css(a).show(1,function(){var e=t();a.top===e.top&&a.left===e.left||f.result_area.css(e)})}},p.prototype.hideResults=function(e){e.prop.key_paging&&(e.scrollWindow(e,!0),e.prop.key_paging=!1),e.setCssFocusedInput(e),e.option.autoFillResult,e.elem.results.empty(),e.elem.result_area.hide(),e.setOpenStatus(e,!1),R(window).off("scroll.SelectPage"),e.abortAjax(e),e.setButtonAttrDefault()},p.prototype.disabled=function(e,t){e.option;var a=e.elem;if("undefined"===R.type(t))return a.combo_input.prop("disabled");"boolean"===R.type(t)&&(a.combo_input.prop("disabled",t),t?a.container.addClass(e.css_class.disabled):a.container.removeClass(e.css_class.disabled))},p.prototype.firstPage=function(e){1<e.prop.current_page&&(e.prop.current_page=1,e.prop.page_move=!0,e.suggest(e))},p.prototype.prevPage=function(e){1<e.prop.current_page&&(e.prop.current_page--,e.prop.page_move=!0,e.suggest(e))},p.prototype.nextPage=function(e){e.prop.current_page<e.prop.max_page&&(e.prop.current_page++,e.prop.page_move=!0,e.suggest(e))},p.prototype.lastPage=function(e){e.prop.current_page<e.prop.max_page&&(e.prop.current_page=e.prop.max_page,e.prop.page_move=!0,e.suggest(e))},p.prototype.afterAction=function(e){e.inputResize(e),e.elem.combo_input.change(),e.setCssFocusedInput(e),e.prop.init_set||(e.option.multiple?e.option.selectToCloseList?(e.hideResults(e),e.elem.combo_input.blur()):(e.suggest(e),e.elem.combo_input.focus()):(e.hideResults(e),e.elem.combo_input.blur()))},p.prototype.selectCurrentLine=function(e,t){e.scrollWindow(e,!0);var a=e.option,o=e.getCurrentLine(e);if(o){if(a.multiple){e.elem.combo_input.val("");var l={text:o.text(),value:o.attr("pkey")};e.isAlreadySelected(e,l)||(e.addNewTag(e,l),e.tagValuesSet(e))}else e.elem.combo_input.val(o.text()),e.elem.hidden.val(o.attr("pkey"));a.selectOnly&&e.setButtonAttrDefault(),a.eSelect&&R.isFunction(a.eSelect)&&a.eSelect(o.data("dataObj"),e),e.prop.prev_value=e.elem.combo_input.val(),e.prop.selected_text=e.elem.combo_input.val(),e.putClearButton()}e.afterAction(e)},p.prototype.putClearButton=function(){this.option.multiple||this.elem.combo_input.prop("disabled")||this.elem.container.append(this.elem.clear_btn)},p.prototype.selectAllLine=function(l){var n=l.option,i=new Array;l.elem.results.find("li").each(function(e,t){var a=R(t),o={text:a.text(),value:a.attr("pkey")};if(l.isAlreadySelected(l,o)||(l.addNewTag(l,o),l.tagValuesSet(l)),i.push(a.data("dataObj")),"number"===R.type(n.maxSelectLimit)&&0<n.maxSelectLimit&&n.maxSelectLimit===l.elem.element_box.find("li.selected_tag").size())return!1}),n.eSelect&&R.isFunction(n.eSelect)&&n.eSelect(i,l),l.afterAction(l)},p.prototype.unSelectAllLine=function(l){var e=l.option,t=l.elem.results.find("li").size();l.elem.results.find("li").each(function(e,t){var a=R(t).attr("pkey"),o=l.elem.element_box.find('li.selected_tag[itemvalue="'+a+'"]');l.removeTag(l,o)}),l.afterAction(l),e.eTagRemove&&R.isFunction(e.eTagRemove)&&e.eTagRemove(t,l)},p.prototype.clearAll=function(e){var t=e.option,a=0;t.multiple&&(a=e.elem.element_box.find("li.selected_tag").size(),e.elem.element_box.find("li.selected_tag").remove()),e.reset(e),e.afterAction(e),t.multiple||e.elem.clear_btn.remove(),t.multiple&&t.eTagRemove&&R.isFunction(t.eTagRemove)&&t.eTagRemove(a,e)},p.prototype.reset=function(e){e.elem.combo_input.val(""),e.elem.hidden.val(""),e.prop.prev_value="",e.prop.selected_text="",e.prop.current_page=1},p.prototype.getCurrentLine=function(e){if(e.elem.result_area.is(":hidden"))return!1;var t=e.elem.results.find("li."+e.css_class.select);return!!t.size()&&t},p.prototype.isAlreadySelected=function(e,t){var a=!1;if(t.value){var o=e.elem.hidden.val();if(o){var l=o.split(",");l&&l.length&&-1!=R.inArray(t.value,l)&&(a=!0)}}return a},p.prototype.addNewTag=function(e,t){if(e.option.multiple&&t){var a,o=e.template.tag.content;o=(o=o.replace(e.template.tag.textKey,t.text)).replace(e.template.tag.valueKey,t.value),a=R(o),e.elem.combo_input.prop("disabled")&&a.find("span.tag_close").hide(),e.elem.combo_input.closest("li").before(a)}},p.prototype.removeTag=function(e,t){var a=R(t).attr("itemvalue"),o=e.elem.hidden.val();if("undefined"!=R.type(a)&&o){var l=o.split(","),n=R.inArray(a.toString(),l);-1!=n&&(l.splice(n,1),e.elem.hidden.val(l.toString()))}R(t).remove(),e.inputResize(e)},p.prototype.tagValuesSet=function(e){if(e.option.multiple){var t=e.elem.element_box.find("li.selected_tag");if(t&&t.size()){var o=new Array;R.each(t,function(e,t){var a=R(t).attr("itemvalue");"undefined"!==R.type(a)&&o.push(a)}),o.length&&e.elem.hidden.val(o.join(","))}}},p.prototype.inputResize=function(e){if(e.option.multiple){var t=e.elem.combo_input.closest("li"),a=function(e,t){t.removeClass("full_width");var a=.75*(e.elem.combo_input.val().length+1)+"em";e.elem.combo_input.css("width",a).removeAttr("placeholder")};0===e.elem.element_box.find("li.selected_tag").size()&&e.elem.combo_input.attr("placeholder_bak")?(t.hasClass("full_width")||t.addClass("full_width"),e.elem.combo_input.attr("placeholder",e.elem.combo_input.attr("placeholder_bak")).removeAttr("style")):a(e,t)}},p.prototype.nextLine=function(e){var t,a=e.getCurrentLine(e);(a?(t=e.elem.results.children("li").index(a),a.removeClass(e.css_class.select)):t=-1,++t<e.elem.results.children("li").length)?(e.elem.results.children("li").eq(t).addClass(e.css_class.select),e.setCssFocusedResults(e)):e.setCssFocusedInput(e);e.scrollWindow(e,!1)},p.prototype.prevLine=function(e){var t,a=e.getCurrentLine(e);(a?(t=e.elem.results.children("li").index(a),a.removeClass(e.css_class.select)):t=e.elem.results.children("li").length,-1<--t)?(e.elem.results.children("li").eq(t).addClass(e.css_class.select),e.setCssFocusedResults(e)):e.setCssFocusedInput(e);e.scrollWindow(e,!1)};var e=R.fn.selectPage;R.fn.selectPage=function(o){return this.each(function(){var e=R(this),t=e.data(p.dataKey),a=R.extend({},l,e.data(),t&&t.option,"object"==typeof o&&o);t||e.data(p.dataKey,t=new p(this,a))})},R.fn.selectPage.Constructor=p,R.fn.selectPageClear=function(){return this.each(function(){var e=o(this).data(p.dataKey);e&&(e.prop.init_set=!0,e.clearAll(e),e.prop.init_set=!1)})},R.fn.selectPageRefresh=function(){return this.each(function(){var e=o(this).data(p.dataKey);e&&e.elem.hidden.val()&&e.setInitRecord(!0)})},R.fn.selectPageData=function(t){return this.each(function(){if(t&&R.isArray(t)){var e=o(this).data(p.dataKey);e&&(e.clearAll(e),e.option.data=t)}})},R.fn.selectPageDisabled=function(t){var a=!1;return this.each(function(){var e=o(this).data(p.dataKey);e&&("undefined"!==R.type(t)?e.disabled(e,t):a=e.disabled(e))}),a},R.fn.selectPageText=function(){var t="";return this.each(function(){var e=o(this).data(p.dataKey);if(e)if(e.option.multiple){var a=[];e.elem.element_box.find("li.selected_tag").each(function(e,t){a.push(R(t).text())}),t+=a.toString()}else t+=e.elem.combo_input.val()}),t},R.fn.selectPage.noConflict=function(){return R.fn.selectPage=e,this}}(window.jQuery);