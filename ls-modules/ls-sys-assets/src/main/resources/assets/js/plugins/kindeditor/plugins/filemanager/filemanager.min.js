KindEditor.plugin("filemanager",function(e){function i(e,i){i.is_dir?e.attr("title",i.filename):e.attr("title",function(e,i,a){return e+" ("+Math.ceil(i/1024)+"KB, "+a+")"}(i.filename,i.filesize,i.datetime))}var a=this,n="filemanager",l=e.undef(a.fileManagerJson,a.basePath+"php/file_manager_json.php"),t=a.pluginsPath+n+"/images/",o=a.lang(n+".");a.plugin.filemanagerDialog=function(r){function d(i,n,t){var o="path="+i+"&order="+n+"&dir="+v;_.showLoading(a.lang("ajaxLoading")),e.ajax(e.addParam(l,o+"&"+(new Date).getTime()),function(e){_.hideLoading(),t(e)})}function s(i,a,n,l){var t=e.formatUrl(a.current_url+n.filename,"absolute"),o=encodeURIComponent(a.current_dir_path+n.filename+"/");n.is_dir?i.click(function(e){d(o,T.val(),l)}):(n.is_photo,i.click(function(e){g.call(this,t,n.filename)})),I.push(i)}function c(i,a){function n(){"VIEW"==C.val()?d(i.current_dir_path,T.val(),p):d(i.current_dir_path,T.val(),m)}e.each(I,function(){this.unbind()}),y.unbind(),C.unbind(),T.unbind(),i.current_dir_path&&y.click(function(e){d(i.moveup_dir_path,T.val(),a)}),C.change(n),T.change(n),w.html("")}function m(i){c(i,m);var a=document.createElement("table");a.className="ke-table",a.cellPadding=0,a.cellSpacing=0,a.border=0,w.append(a);for(var n=i.file_list,l=0,r=n.length;l<r;l++){var d=n[l],p=e(a.insertRow(l));p.mouseover(function(i){e(this).addClass("ke-on")}).mouseout(function(i){e(this).removeClass("ke-on")});var f=t+(d.is_dir?"folder-16.gif":"file-16.gif"),u=e('<img src="'+f+'" width="16" height="16" alt="'+d.filename+'" align="absmiddle" />'),v=e(p[0].insertCell(0)).addClass("ke-cell ke-name").append(u).append(document.createTextNode(" "+d.filename));!d.is_dir||d.has_file?(p.css("cursor","pointer"),v.attr("title",d.filename),s(v,i,d,m)):v.attr("title",o.emptyFolder),e(p[0].insertCell(1)).addClass("ke-cell ke-size").html(d.is_dir?"-":Math.ceil(d.filesize/1024)+"KB"),e(p[0].insertCell(2)).addClass("ke-cell ke-datetime").html(d.datetime)}}function p(a){c(a,p);for(var n=a.file_list,l=0,r=n.length;l<r;l++){var d=n[l],m=e('<div class="ke-inline-block ke-item"></div>');w.append(m);var f=e('<div class="ke-inline-block ke-photo"></div>').mouseover(function(i){e(this).addClass("ke-on")}).mouseout(function(i){e(this).removeClass("ke-on")});m.append(f);var u=a.current_url+d.filename,v=d.is_dir?t+"folder-64.gif":d.is_photo?u:t+"file-64.gif",h=e('<img src="'+v+'" width="80" height="80" alt="'+d.filename+'" />');!d.is_dir||d.has_file?(f.css("cursor","pointer"),i(f,d),s(f,a,d,p)):f.attr("title",o.emptyFolder),f.append(h),m.append('<div class="ke-name" title="'+d.filename+'">'+d.filename+"</div>")}}var f=e.undef(r.width,650),u=e.undef(r.height,510),v=e.undef(r.dirName,""),h=e.undef(r.viewType,"VIEW").toUpperCase(),g=r.clickFn,k=['<div style="padding:10px 20px;">','<div class="ke-plugin-filemanager-header">','<div class="ke-left">','<img class="ke-inline-block" name="moveupImg" src="'+t+'go-up.gif" width="16" height="16" border="0" alt="" /> ','<a class="ke-inline-block" name="moveupLink" href="javascript:;">'+o.moveup+"</a>","</div>",'<div class="ke-right">',o.viewType+' <select class="ke-inline-block" name="viewType">','<option value="VIEW">'+o.viewImage+"</option>",'<option value="LIST">'+o.listImage+"</option>","</select> ",o.orderType+' <select class="ke-inline-block" name="orderType">','<option value="NAME">'+o.fileName+"</option>",'<option value="SIZE">'+o.fileSize+"</option>",'<option value="TYPE">'+o.fileType+"</option>","</select>","</div>",'<div class="ke-clearfix"></div>',"</div>",'<div class="ke-plugin-filemanager-body"></div>',"</div>"].join(""),_=a.createDialog({name:n,width:f,height:u,title:a.lang(n),body:k}),b=_.div,w=e(".ke-plugin-filemanager-body",b),y=(e('[name="moveupImg"]',b),e('[name="moveupLink"]',b)),C=(e('[name="viewServer"]',b),e('[name="viewType"]',b)),T=e('[name="orderType"]',b),I=[];return C.val(h),d("",T.val(),"VIEW"==h?p:m),_}});