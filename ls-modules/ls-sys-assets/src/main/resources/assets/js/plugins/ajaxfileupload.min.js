$.extend({createUploadIframe:function(e,t){var r="jUploadFrame"+e;return $("<iframe />").css({position:"absolute",top:"-9999px",left:"-9999px",border:"solid 1px #ff0000","z-index":3e4}).attr({id:r,name:r,src:t}).appendTo("body").get(0)},createUploadForm:function(e,t,r,a){var o,n="jUploadForm"+e,l="jUploadFile"+e,i=$('<form  action="" method="POST" name="'+n+'" id="'+n+'" enctype="multipart/form-data"></form>');if(r)for(var c in r)$('<input type="hidden" name="'+c+'" value="'+r[c]+'" />').appendTo(i);o=null==a?$("#"+t):a;var d=$(o).clone();return $(o).attr("id",l).before(d).appendTo(i),i.css({position:"absolute",top:"-1200px",left:"-1200px"}).appendTo("body"),i},ajaxFileUpload:function(o){o=$.extend({},$.ajaxSettings,o);var e=(new Date).getTime(),n=$.createUploadForm(e,o.fileElementId,void 0!==o.data&&o.data,o.fileElement),l=($.createUploadIframe(e,o.secureuri),"jUploadFrame"+e),t="jUploadForm"+e;o.global&&!$.active++&&$.event.trigger("ajaxStart");var i=!1,c={};o.global&&$.event.trigger("ajaxSend",[c,o]);var r=function(e){var t=$("#"+l);try{c=t.contents().text()}catch(e){$.handleError(o,c,null,e)}if(c||"timeout"==e){var r;i=!0;try{if("error"!=(r="timeout"!=e?"success":"error")){var a=$.uploadHttpData(c,o.dataType);o.success&&o.success(a,r),o.global&&$.event.trigger("ajaxSuccess",[c,o])}else $.handleError(o,c,r)}catch(e){r="error",$.handleError(o,c,r,e)}o.global&&$.event.trigger("ajaxComplete",[c,o]),o.global&&!--$.active&&$.event.trigger("ajaxStop"),o.complete&&o.complete(c,r),t.off(),setTimeout(function(){try{t.remove(),n.remove()}catch(e){$.handleError(o,c,null,e)}},100),c=null}};0<o.timeout&&setTimeout(function(){i||r("timeout")},o.timeout);try{(n=$("#"+t)).attr({action:o.url,method:"POST",target:l,enctype:"multipart/form-data"}),n.submit()}catch(e){$.handleError(o,c,null,e)}var a=$("#"+l).load(r);return{abort:function(){try{a.remove(),n&&n.remove()}catch(e){}}}},uploadHttpData:function(e,t){return"script"==(t=t.toLowerCase())?$.globalEval(e):"json"==t?e=new Function("return "+e)():"html"==t&&$("<div>").html(e).evalScripts(),e},handleError:function(e,t,r,a){e.error&&e.error(t,r,a),e.global&&$.event.trigger("ajaxError",[t,e,a])}});