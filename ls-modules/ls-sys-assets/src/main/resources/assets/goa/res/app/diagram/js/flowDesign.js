EditorUi=function(b,a){this.editor=b||new Editor();this.container=a||document.body;var f=b.graph;this.container.style.overflow="hidden";var i=mxUtils.bind(this,function(j){if(j==null){j=window.event}if(this.isSelectionAllowed(j)){return true}return f.isEditing()||this.dialog!=null});if(this.container==document.body){document.onselectstart=i;document.onmousedown=i}if(mxClient.IS_IE&&document.documentMode!=9){mxEvent.addListener(this.container,"contextmenu",i)}else{this.container.oncontextmenu=i}new Image().src=mxPopupMenu.prototype.submenuImage;if(mxConnectionHandler.prototype.connectImage!=null){new Image().src=mxConnectionHandler.prototype.connectImage.src}this.actions=new Actions(this);this.menus=new Menus(this);this.createDivs();this.refresh();this.createUi();f.init(this.diagramContainer);f.refresh();f.container.setAttribute("tabindex","0");f.container.style.overflow=(touchStyle)?"hidden":"auto";f.container.style.cursor="default";f.container.style.backgroundImage="url("+IMAGE_PATH+"/grid.gif)";f.container.focus();var c=f.fireMouseEvent;f.fireMouseEvent=function(l,k,j){if(l==mxEvent.MOUSE_DOWN){this.container.focus()}c.apply(this,arguments)};f.panningHandler.autoExpand=true;f.panningHandler.factoryMethod=mxUtils.bind(this,function(l,j,k){this.menus.createPopupMenu(l,j,k)});b.outline.init(this.outlineContainer);var d=(mxClient.IS_TOUCH)?"touchstart":"mousedown";mxEvent.addListener(document,d,mxUtils.bind(this,function(j){f.panningHandler.hideMenu()}));if(mxClient.IS_TOUCH){mxEvent.addListener(f.container,"gesturechange",mxUtils.bind(this,function(j){f.view.getDrawPane().setAttribute("transform","scale("+j.scale+")");f.view.getOverlayPane().style.visibility="hidden"}));mxEvent.addListener(f.container,"gestureend",mxUtils.bind(this,function(j){f.view.getDrawPane().removeAttribute("transform");f.zoomToCenter=true;f.zoom(j.scale);f.view.getOverlayPane().style.visibility="visible"}))}var g=this.createKeyHandler(b);this.getKeyHandler=function(){return g};window.onbeforeunload=function(){if(b.modified){return mxResources.get("allChangesLost")}};mxEvent.addListener(window,"resize",mxUtils.bind(this,function(){this.refresh();f.sizeDidChange();this.editor.outline.update(false);this.editor.outline.outline.sizeDidChange()}));this.init();this.open()};EditorUi.prototype.splitSize=(mxClient.IS_TOUCH)?16:8;EditorUi.prototype.menubarHeight=0;EditorUi.prototype.toolbarHeight=40;EditorUi.prototype.footerHeight=0;EditorUi.prototype.hsplitPosition=90;EditorUi.prototype.vsplitPosition=0;EditorUi.prototype.init=function(){this.addUndoListener();this.addSelectionListener();var c=this.actions.get("paste");var b=function(){c.setEnabled(!mxClipboard.isEmpty())};var a=mxClipboard.cut;mxClipboard.cut=function(){a.apply(this,arguments);b()};var d=mxClipboard.copy;mxClipboard.copy=function(){d.apply(this,arguments);b()}};EditorUi.prototype.isSelectionAllowed=function(a){return false};EditorUi.prototype.open=function(){try{if(window.opener!=null&&window.opener.openFile!=null){window.opener.openFile.setConsumer(mxUtils.bind(this,function(c,b){try{var f=mxUtils.parseXml(c);this.editor.setGraphXml(f.documentElement);this.editor.modified=false;this.editor.undoManager.clear();if(b!=null){this.editor.filename=b}}catch(d){mxUtils.alert(mxResources.get("invalidOrMissingFile")+": "+d.message)}}))}}catch(a){}};EditorUi.prototype.save=function(b){if(b!=null){var a=mxUtils.getXml(this.editor.getGraphXml());if(a.indexOf("mxGraphModel")==-1){a="<mxGraphModel>"+a+"</mxGraphModel>"}try{if(useLocalStorage){if(localStorage.getItem(b)!=null&&!mxUtils.confirm(mxResources.get("replace",[b]))){return}localStorage.setItem(b,a);this.editor.setStatus(mxResources.get("saved"))}else{if(a.length<MAX_REQUEST_SIZE){a=encodeURIComponent(a);new mxXmlRequest(SAVE_URL,"filename="+b+"&xml="+a).simulate(document,"_blank")}else{mxUtils.alert(mxResources.get("drawingTooLarge"));mxUtils.popup(a);return}}this.editor.filename=b;this.editor.modified=false}catch(c){this.editor.setStatus("Error saving file")}}};EditorUi.prototype.getUrl=function(d){var a=(d!=null)?d:window.location.pathname;var c=(d.indexOf("?")>0)?1:0;for(var b in urlParams){if(c==0){a+="?"}else{a+="&"}a+=b+"="+urlParams[b];c++}return a};EditorUi.prototype.addUndoListener=function(){var a=this.actions.get("undo");var b=this.actions.get("redo");var d=this.editor.undoManager;var c=function(){a.setEnabled(d.canUndo());b.setEnabled(d.canRedo())};d.addListener(mxEvent.ADD,c);d.addListener(mxEvent.UNDO,c);d.addListener(mxEvent.REDO,c);d.addListener(mxEvent.CLEAR,c);c()};EditorUi.prototype.addSelectionListener=function(){var a=mxUtils.bind(this,function(){var m=this.editor.graph;var d=!m.isSelectionEmpty();var n=false;var f=false;var o=m.getSelectionCells();if(o!=null){for(var g=0;g<o.length;g++){var l=o[g];if(m.getModel().isEdge(l)){f=true}if(m.getModel().isVertex(l)){n=true}if(f&&n){break}}}var c=["cut","copy","delete","duplicate","bold","italic","style","fillColor","gradientColor","underline","fontColor","strokeColor","backgroundColor","borderColor","toFront","toBack","dashed","rounded","shadow","rotate","autosize"];for(var g=0;g<c.length;g++){this.actions.get(c[g]).setEnabled(d)}this.actions.get("rotation").setEnabled(n);this.actions.get("group").setEnabled(m.getSelectionCount()>1);this.actions.get("ungroup").setEnabled(m.getSelectionCount()==1&&m.getModel().getChildCount(m.getSelectionCell())>0);var k=n&&m.getSelectionCount()==1;this.actions.get("removeFromGroup").setEnabled(k&&m.getModel().isVertex(m.getModel().getParent(m.getSelectionCell())));var b=["fontFamily","fontSize","alignment","position","text","format","arrange","linewidth","spacing","gradient"];for(var g=0;g<b.length;g++){this.menus.get(b[g]).setEnabled(d)}b=["line","lineend","linestart"];for(var g=0;g<b.length;g++){this.menus.get(b[g]).setEnabled(f)}this.actions.get("setAsDefaultEdge").setEnabled(f);this.menus.get("align").setEnabled(m.getSelectionCount()>1);this.menus.get("direction").setEnabled(n||(f&&m.isLoop(m.view.getState(m.getSelectionCell()))));this.menus.get("navigation").setEnabled(m.foldingEnabled&&((m.view.currentRoot!=null)||(m.getSelectionCount()==1&&m.isValidRoot(m.getSelectionCell()))));this.actions.get("home").setEnabled(m.view.currentRoot!=null);this.actions.get("exitGroup").setEnabled(m.view.currentRoot!=null);var j=m.getSelectionCount()==1&&m.isValidRoot(m.getSelectionCell());this.actions.get("enterGroup").setEnabled(j);this.actions.get("expand").setEnabled(j);this.actions.get("collapse").setEnabled(j);this.actions.get("editLink").setEnabled(m.getSelectionCount()==1);this.actions.get("openLink").setEnabled(m.getSelectionCount()==1&&m.getLinkForCell(m.getSelectionCell())!=null)});this.editor.graph.getSelectionModel().addListener(mxEvent.CHANGE,a);a()};EditorUi.prototype.refresh=function(){var f=mxClient.IS_IE&&(document.documentMode==null||document.documentMode==5);var a=this.container.clientWidth;var d=this.container.clientHeight;if(this.container==document.body){a=document.body.clientWidth||document.documentElement.clientWidth;d=(f)?document.body.clientHeight||document.documentElement.clientHeight:document.documentElement.clientHeight}var c=Math.max(0,Math.min(this.hsplitPosition,a-this.splitSize-20));var i=Math.max(0,Math.min(this.vsplitPosition,d-this.menubarHeight-this.toolbarHeight-this.footerHeight-this.splitSize-1));this.menubarContainer.style.height=this.menubarHeight+"px";this.toolbarContainer.style.top=this.menubarHeight+"px";this.toolbarContainer.style.height=this.toolbarHeight+"px";this.sidebarContainer.style.top=(this.menubarHeight+this.toolbarHeight+3)+"px";this.sidebarContainer.style.width=c+"px";this.outlineContainer.style.width=c+"px";this.outlineContainer.style.height=i+"px";this.outlineContainer.style.bottom=this.footerHeight+"px";this.diagramContainer.style.left=(c+this.splitSize)+"px";this.diagramContainer.style.top=this.sidebarContainer.style.top;this.footerContainer.style.height=this.footerHeight+"px";this.hsplit.style.top=this.sidebarContainer.style.top;this.hsplit.style.bottom=this.outlineContainer.style.bottom;this.hsplit.style.left=c+"px";this.vsplit.style.width=this.sidebarContainer.style.width;this.vsplit.style.bottom=(i+this.footerHeight)+"px";if(f){this.menubarContainer.style.width=a+"px";this.toolbarContainer.style.width=this.menubarContainer.style.width;var b=(d-i-this.splitSize-this.footerHeight-this.menubarHeight-this.toolbarHeight-3);this.sidebarContainer.style.height=b+"px";this.diagramContainer.style.width=(a-c-this.splitSize)+"px";var g=(d-this.footerHeight-this.menubarHeight-this.toolbarHeight-3);this.diagramContainer.style.height=g+"px";this.footerContainer.style.width=this.menubarContainer.style.width;this.hsplit.style.height=g+"px"}else{this.sidebarContainer.style.bottom=(i+this.splitSize+this.footerHeight)+"px";this.diagramContainer.style.bottom=this.outlineContainer.style.bottom}};EditorUi.prototype.createDivs=function(){this.menubarContainer=this.createDiv("geMenubarContainer");this.toolbarContainer=this.createDiv("geToolbarContainer");this.sidebarContainer=this.createDiv("geSidebarContainer");this.outlineContainer=this.createDiv("geOutlineContainer");this.diagramContainer=this.createDiv("geDiagramContainer");this.footerContainer=this.createDiv("geFooterContainer");this.hsplit=this.createDiv("geHsplit");this.vsplit=this.createDiv("geVsplit");this.menubarContainer.style.top="0px";this.menubarContainer.style.left="0px";this.menubarContainer.style.right="0px";this.toolbarContainer.style.left="0px";this.toolbarContainer.style.right="0px";this.sidebarContainer.style.left="0px";this.outlineContainer.style.left="0px";this.diagramContainer.style.right="0px";this.footerContainer.style.left="0px";this.footerContainer.style.right="0px";this.footerContainer.style.bottom="0px";this.vsplit.style.left="0px";this.vsplit.style.height=this.splitSize+"px";this.hsplit.style.width=this.splitSize+"px";var a="<h3>\u5de5\u4f5c\u6d41\u8bbe\u8ba1\u5668</h3>";this.menubarContainer.innerHTML=a};EditorUi.prototype.createUi=function(){this.menubar=this.menus.createMenubar(this.createDiv("geMenubar"));this.menubarContainer.appendChild(this.menubar.container);this.toolbar=this.createToolbar(this.createDiv("geToolbar"));this.toolbarContainer.appendChild(this.toolbar.container);this.sidebar=this.createSidebar(this.sidebarContainer);this.footerContainer.appendChild(this.createFooter());this.statusContainer=this.createStatusContainer();this.editor.addListener("statusChanged",mxUtils.bind(this,function(){this.setStatusText(this.editor.getStatus())}));this.setStatusText(this.editor.getStatus());this.menubar.container.appendChild(this.statusContainer);this.container.appendChild(this.menubarContainer);this.container.appendChild(this.toolbarContainer);this.container.appendChild(this.sidebarContainer);this.container.appendChild(this.outlineContainer);this.container.appendChild(this.diagramContainer);this.container.appendChild(this.footerContainer);this.container.appendChild(this.hsplit);this.container.appendChild(this.vsplit);this.addSplitHandler(this.vsplit,false,this.footerHeight,mxUtils.bind(this,function(a){this.vsplitPosition=a;this.refresh();this.editor.outline.update(false);this.editor.outline.outline.sizeDidChange()}))};EditorUi.prototype.createStatusContainer=function(){var a=document.createElement("a");a.className="geItem geStatus";return a};EditorUi.prototype.setStatusText=function(a){this.statusContainer.innerHTML=a};EditorUi.prototype.createToolbar=function(a){return new Toolbar(this,a)};EditorUi.prototype.createSidebar=function(a){return new Sidebar(this,a)};EditorUi.prototype.createFooter=function(){return this.createDiv("geFooter")};EditorUi.prototype.createDiv=function(b){var a=document.createElement("div");a.className=b;return a};EditorUi.prototype.addSplitHandler=function(d,a,m,j){var b=null;var i=null;function f(){return parseInt(((a)?d.style.left:d.style.bottom))}var k=(mxClient.IS_TOUCH)?"touchstart":"mousedown";var c=(mxClient.IS_TOUCH)?"touchmove":"mousemove";var l=(mxClient.IS_TOUCH)?"touchend":"mouseup";mxEvent.addListener(d,k,function(n){b=new mxPoint(mxEvent.getClientX(n),mxEvent.getClientY(n));i=f();mxEvent.consume(n)});function g(n){if(b!=null){var o=new mxPoint(mxEvent.getClientX(n),mxEvent.getClientY(n));j(Math.max(0,i+((a)?(o.x-b.x):(b.y-o.y))-m));mxEvent.consume(n)}}mxEvent.addListener(document,c,g);mxEvent.addListener(document,l,function(n){g(n);b=null;i=null})};EditorUi.prototype.showDialog=function(c,b,f,g,d,a){this.hideDialog();this.dialog=new Dialog(this,c,b,(mxClient.IS_VML)?f-12:f,g,d,a)};EditorUi.prototype.hideDialog=function(){if(this.dialog!=null){this.dialog.close();this.dialog=null;this.editor.graph.container.focus()}};EditorUi.prototype.openFile=function(){window.openFile=new OpenFile(mxUtils.bind(this,function(){this.hideDialog()}));this.showDialog(new OpenDialog(this).container,300,180,true,true,function(){window.openFile=null})};EditorUi.prototype.saveFile=function(){var a=mxUtils.getXml(this.editor.getGraphXml());if(a.indexOf("mxGraphModel")==-1){a="<mxGraphModel>"+a+"</mxGraphModel>"}};EditorUi.prototype.saveFileToLocal=function(a){if(!a&&this.editor.filename!=null){this.save(this.editor.getOrCreateFilename())}else{this.showDialog(new SaveDialog(this).container,300,100,true,true)}};EditorUi.prototype.executeLayout=function(f,b,d){var g=this.editor.graph;var a=g.getSelectionCell();g.getModel().beginUpdate();try{f.execute(g.getDefaultParent(),a)}catch(i){throw i}finally{if(b&&navigator.userAgent.indexOf("Camino")<0){var c=new mxMorphing(g);c.addListener(mxEvent.DONE,mxUtils.bind(this,function(){g.getModel().endUpdate()}));c.startAnimation()}else{g.getModel().endUpdate()}}};EditorUi.prototype.createKeyHandler=function(c){var g=this.editor.graph;var i=new mxKeyHandler(g);i.isControlDown=function(j){return mxEvent.isControlDown(j)||(mxClient.IS_MAC&&j.metaKey)};function b(l){if(!g.isSelectionEmpty()){var k=0;var j=0;if(l==37){k=-1}else{if(l==38){j=-1}else{if(l==39){k=1}else{if(l==40){j=1}}}}g.moveCells(g.getSelectionCells(),k,j)}}var a=mxUtils.bind(this,function(l,o,k,j){var n=this.actions.get(k);if(n!=null){var m=function(){if(n.enabled){n.funct()}};if(o){if(j){i.bindControlShiftKey(l,m)}else{i.bindControlKey(l,m)}}else{if(j){i.bindShiftKey(l,m)}else{i.bindKey(l,m)}}}});var f=this;var d=i.escape;i.escape=function(j){f.hideDialog();d.apply(this,arguments)};i.enter=function(){};i.bindKey(8,function(){g.foldCells(true)});i.bindKey(13,function(){g.foldCells(false)});i.bindKey(33,function(){g.exitGroup()});i.bindKey(34,function(){g.enterGroup()});i.bindKey(36,function(){g.home()});i.bindKey(35,function(){g.refresh()});i.bindKey(37,function(){b(37)});i.bindKey(38,function(){b(38)});i.bindKey(39,function(){b(39)});i.bindKey(40,function(){b(40)});i.bindKey(113,function(){g.startEditingAtCell()});a(46,false,"delete");a(82,true,"rotate");a(83,true,"save");a(83,true,"saveAs",true);a(107,false,"zoomIn");a(109,false,"zoomOut");a(65,true,"selectAll");a(86,true,"selectVertices",true);a(69,true,"selectEdges",true);a(69,true,"export");a(66,true,"toBack");a(70,true,"toFront");a(68,true,"duplicate");a(90,true,"undo");a(89,true,"redo");a(88,true,"cut");a(67,true,"copy");a(81,true,"connect");a(86,true,"paste");a(71,true,"group");a(71,true,"grid",true);a(85,true,"ungroup");a(112,false,"about");return i};var useLocalStorage=(mxClient.IS_TOUCH||urlParams.storage=="local")&&typeof(localStorage)!="undefined";var fileSupport=window.File!=null&&window.FileReader!=null&&window.FileList!=null;var touchStyle=mxClient.IS_TOUCH||urlParams.touch=="1";var counter=0;try{var op=window;while(op.opener!=null&&!isNaN(op.opener.counter)){op=op.opener}if(op!=null){op.counter++;counter=op.counter}}catch(e){}Editor=function(){mxEventSource.call(this);this.init();this.initStencilRegistry();this.graph=new Graph();this.outline=new mxOutline(this.graph);this.outline.updateOnPan=true;this.undoManager=this.createUndoManager();this.status="";this.filename=null;this.getOrCreateFilename=function(){return this.filename||mxResources.get("drawing",[counter])+".xml"};this.getFilename=function(){return this.filename};this.setStatus=function(b){this.status=b;this.fireEvent(new mxEventObject("statusChanged"))};this.getStatus=function(){return this.status};this.modified=false;this.graph.getModel().addListener(mxEvent.CHANGE,mxUtils.bind(this,function(){this.modified=true}));window.onbeforeunload=mxUtils.bind(this,function(){if(this.modified){return mxResources.get("allChangesLost")}});this.graph.resetViewOnRootChange=false;this.graph.scrollbars=true;this.graph.background=null;this.graph.getSelectionModel().addListener(mxEvent.CHANGE,function(){var d="/activity.do?method=form&etc="+new Date().getTime();if(this.cells&&this.cells.length==1){var b=this.cells[0];var g=b.activityId;var f=b.activityType;var c=b.getValue();var i="&etc="+new Date().getTime()+"&activityId="+g+"&processId="+COA_PROCESSID+"&moduleId="+COA_MODULEID+"&formId="+COA_FORMID+"&activityName="+c+"&activityType="+f;if(f=="0"||f=="2"){d="/activity.do?method=form"+i;openAttrWin(d,c)}else{if(f=="4"){d="/activityTrans.do?method=getRestrict"+i;openAttrWin(d,c)}else{if(f=="1"){d="/flow.do?method=form&from=2"+i;openAttrWin(d,c)}else{hideAttrWin()}}}SELECT_MODEL=b}else{hideAttrWin();SELECT_MODEL=null}});var a=new mxKeyHandler(this.graph);a.bindKey(46,function(d){var f=graph.getSelectionCells();if(f){for(var j=0,c=f.length;j<c;j++){var b=f[j];var g=b.activityType,k=b.activityId;if((g&&(g==1))&&k>0){alert("\u5f00\u59cb\u8282\u70b9\u4e0d\u5141\u8bb8\u5220\u9664!")}else{graph.removeCells([b])}}}})};mxUtils.extend(Editor,mxEventSource);Editor.prototype.gridImage=IMAGE_PATH+"/grid.gif";Editor.prototype.transparentImage=IMAGE_PATH+"/transparent.gif";Editor.prototype.updateCell=function(d,c){var b=this.graph.getModel();if(!SELECT_MODEL){return}b.beginUpdate();try{var a=b.getCell(SELECT_MODEL.getId());a.setValue(c);b.setValue(a,c);if(a.activityType!=0||a.activityType!=100){a.activityId=d}}finally{b.endUpdate()}};Editor.prototype.setGraphXml=function(c){var g=new mxCodec(c.ownerDocument);if(c.nodeName=="mxGraphModel"){this.graph.view.scale=Number(c.getAttribute("scale")||1);this.graph.gridEnabled=c.getAttribute("grid")!="0";this.graph.graphHandler.guidesEnabled=c.getAttribute("guides")!="0";this.graph.setTooltips(c.getAttribute("tooltips")!="0");this.graph.setConnectable(c.getAttribute("connect")!="0");this.graph.foldingEnabled=c.getAttribute("fold")!="0";this.graph.scrollbars=c.getAttribute("scrollbars")!="0";if(!this.graph.scrollbars){this.graph.container.scrollLeft=0;this.graph.container.scrollTop=0;this.graph.view.translate.x=Number(c.getAttribute("dx")||0);this.graph.view.translate.y=Number(c.getAttribute("dy")||0)}this.graph.pageVisible=c.getAttribute("page")=="1";this.graph.pageBreaksVisible=this.graph.pageVisible;this.graph.preferPageSize=this.graph.pageBreaksVisible;var f=c.getAttribute("pageScale");if(f!=null){this.graph.pageScale=f}else{this.graph.pageScale=1.5}var b=c.getAttribute("pageWidth");var d=c.getAttribute("pageHeight");if(b!=null&&d!=null){this.graph.pageFormat=new mxRectangle(0,0,parseFloat(b),parseFloat(d))}var a=c.getAttribute("background");if(a!=null&&a.length>0){this.graph.background=a}g.decode(c,this.graph.getModel());this.updateGraphComponents()}};Editor.prototype.getGraphXml=function(){var a=new mxCodec(mxUtils.createXmlDocument());var b=a.encode(this.graph.getModel());if(this.graph.view.translate.x!=0||this.graph.view.translate.y!=0){b.setAttribute("dx",Math.round(this.graph.view.translate.x*100)/100);b.setAttribute("dy",Math.round(this.graph.view.translate.y*100)/100)}if(this.graph.view.scale!=1){b.setAttribute("scale",Math.round(this.graph.view.scale*1000)/1000)}b.setAttribute("grid",(this.graph.isGridEnabled())?"1":"0");b.setAttribute("guides",(this.graph.graphHandler.guidesEnabled)?"1":"0");b.setAttribute("guides",(this.graph.graphHandler.guidesEnabled)?"1":"0");b.setAttribute("tooltips",(this.graph.tooltipHandler.isEnabled())?"1":"0");b.setAttribute("connect",(this.graph.connectionHandler.isEnabled())?"1":"0");b.setAttribute("fold",(this.graph.foldingEnabled)?"1":"0");b.setAttribute("page",(this.graph.pageVisible)?"1":"0");b.setAttribute("pageScale",this.graph.pageScale);b.setAttribute("pageWidth",this.graph.pageFormat.width);b.setAttribute("pageHeight",this.graph.pageFormat.height);if(!this.graph.scrollbars){b.setAttribute("scrollbars","0")}if(this.graph.background!=null){b.setAttribute("background",this.graph.background)}return b};Editor.prototype.updateGraphComponents=function(){var b=this.graph;var a=this.outline;if(b.container!=null&&a.outline.container!=null){if(b.background!=null){if(b.background=="none"){b.container.style.backgroundColor="transparent"}else{if(b.view.backgroundPageShape!=null){b.view.backgroundPageShape.fill=b.background;b.view.backgroundPageShape.reconfigure()}b.container.style.backgroundColor=b.background}}else{b.container.style.backgroundColor=""}if(b.pageVisible){b.container.style.backgroundColor="#ebebeb";b.container.style.borderStyle="solid";b.container.style.borderColor="#e5e5e5";b.container.style.borderTopWidth="1px";b.container.style.borderLeftWidth="1px";b.container.style.borderRightWidth="0px";b.container.style.borderBottomWidth="0px"}else{b.container.style.border=""}a.outline.container.style.backgroundColor=b.container.style.backgroundColor;if(a.outline.pageVisible!=b.pageVisible||a.outline.pageScale!=b.pageScale){a.outline.pageScale=b.pageScale;a.outline.pageVisible=b.pageVisible;a.outline.view.validate()}if(b.scrollbars&&b.container.style.overflow=="hidden"&&!touchStyle){b.container.style.overflow="auto"}else{if(!b.scrollbars||touchStyle){b.container.style.overflow="hidden"}}var c=(mxClient.IS_IE&&document.documentMode>=9)?"url("+this.transparentImage+")":"none";b.container.style.backgroundImage=(!b.pageVisible&&b.isGridEnabled())?"url("+this.gridImage+")":c;if(b.view.backgroundPageShape!=null){b.view.backgroundPageShape.node.style.backgroundImage=(this.graph.isGridEnabled())?"url("+this.gridImage+")":"none"}}};Editor.prototype.init=function(){if(mxClient.IS_IE6||mxClient.IS_IE7){mxClient.link("stylesheet",CSS_PATH+"/grapheditor-ie6.css")}mxResources.loadDefaultBundle=false;mxResources.add(RESOURCE_BASE);mxConstants.DEFAULT_HOTSPOT=0.3;var b=mxConnectionHandler.prototype.createMarker;mxConnectionHandler.prototype.createMarker=function(){var g=b.apply(this,arguments);g.intersects=mxUtils.bind(this,function(j,i){if(this.isConnecting()){return true}return mxCellMarker.prototype.intersects.apply(g,arguments)});return g};mxConstants.SHADOWCOLOR="#d0d0d0";mxConstants.HANDLE_FILLCOLOR="#99ccff";mxConstants.HANDLE_STROKECOLOR="#0088cf";mxConstants.VERTEX_SELECTION_COLOR="#00a8ff";mxConstants.OUTLINE_COLOR="#00a8ff";mxConstants.OUTLINE_HANDLE_FILLCOLOR="#99ccff";mxConstants.OUTLINE_HANDLE_STROKECOLOR="#00a8ff";mxConstants.CONNECT_HANDLE_FILLCOLOR="#cee7ff";mxConstants.EDGE_SELECTION_COLOR="#00a8ff";mxConstants.DEFAULT_VALID_COLOR="#00a8ff";mxConstants.LABEL_HANDLE_FILLCOLOR="#cee7ff";mxConstants.GUIDE_COLOR="#0088cf";mxConstants.DEFAULT_FONTSIZE=14;mxGraph.prototype.pageBreakColor="#c0c0c0";mxGraph.prototype.pageScale=1;mxRubberband.prototype.defaultOpacity=30;mxGraphView.prototype.createBackgroundPageShape=function(g){return new mxRectangleShape(g,this.graph.background||"white","#cacaca")};mxGraphView.prototype.getBackgroundPageBounds=function(){var v=this.getGraphBounds();var q=(v.width>0)?v.x/this.scale-this.translate.x:0;var p=(v.height>0)?v.y/this.scale-this.translate.y:0;var s=v.width/this.scale;var l=v.height/this.scale;var k=this.graph.pageFormat;var i=this.graph.pageScale;var u=k.width*i;var n=k.height*i;var j=Math.floor(Math.min(0,q)/u);var r=Math.floor(Math.min(0,p)/n);var t=Math.ceil(Math.max(1,q+s)/u);var m=Math.ceil(Math.max(1,p+l)/n);var z=t-j;var o=m-r;var g=new mxRectangle(this.scale*(this.translate.x+j*u),this.scale*(this.translate.y+r*n),this.scale*z*u,this.scale*o*n);return g};var c=mxGraph.prototype.panGraph;mxGraph.prototype.panGraph=function(i,g){c.apply(this,arguments);if((this.dialect!=mxConstants.DIALECT_SVG&&this.view.backgroundPageShape!=null)&&(!this.useScrollbarsForPanning||!mxUtils.hasScrollbars(this.container))){this.view.backgroundPageShape.node.style.marginLeft=i+"px";this.view.backgroundPageShape.node.style.marginTop=g+"px"}};mxGraphView.prototype.validateBackground=function(){var i=this.graph.getBackgroundImage();if(i!=null){if(this.backgroundImage==null||this.backgroundImage.image!=i.src){if(this.backgroundImage!=null){this.backgroundImage.destroy()}var j=new mxRectangle(0,0,1,1);this.backgroundImage=new mxImageShape(j,i.src);this.backgroundImage.dialect=this.graph.dialect;this.backgroundImage.init(this.backgroundPane);this.backgroundImage.redraw()}this.redrawBackgroundImage(this.backgroundImage,i)}else{if(this.backgroundImage!=null){this.backgroundImage.destroy();this.backgroundImage=null}}if(this.graph.pageVisible){var j=this.getBackgroundPageBounds();if(this.backgroundPageShape==null){this.backgroundPageShape=this.createBackgroundPageShape(j);this.backgroundPageShape.scale=1;this.backgroundPageShape.isShadow=true;this.backgroundPageShape.dialect=mxConstants.DIALECT_STRICTHTML;this.backgroundPageShape.init(this.graph.container);this.graph.container.firstChild.style.position="absolute";this.graph.container.insertBefore(this.backgroundPageShape.node,this.graph.container.firstChild);this.backgroundPageShape.redraw();this.backgroundPageShape.node.className="geBackgroundPage";mxEvent.addListener(this.backgroundPageShape.node,"dblclick",mxUtils.bind(this,function(m){this.graph.dblClick(m)}));var k=(mxClient.IS_TOUCH)?"touchstart":"mousedown";var l=(mxClient.IS_TOUCH)?"touchmove":"mousemove";var g=(mxClient.IS_TOUCH)?"touchend":"mouseup";mxEvent.addListener(this.backgroundPageShape.node,k,mxUtils.bind(this,function(m){this.graph.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(m))}));mxEvent.addListener(this.backgroundPageShape.node,l,mxUtils.bind(this,function(m){if(this.graph.tooltipHandler!=null&&this.graph.tooltipHandler.isHideOnHover()){this.graph.tooltipHandler.hide()}if(this.graph.isMouseDown&&!mxEvent.isConsumed(m)){this.graph.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(m))}}));mxEvent.addListener(this.backgroundPageShape.node,g,mxUtils.bind(this,function(m){this.graph.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(m))}))}else{this.backgroundPageShape.scale=1;this.backgroundPageShape.bounds=j;this.backgroundPageShape.redraw()}}else{if(this.backgroundPageShape!=null){this.backgroundPageShape.destroy();this.backgroundPageShape=null}}};mxGraph.prototype.updatePageBreaks=function(q,n,v){var r=this.view.scale;var t=this.view.translate;var p=this.pageFormat;var k=r*this.pageScale;var l=this.view.getBackgroundPageBounds();n=l.width;v=l.height;var j=new mxRectangle(r*t.x,r*t.y,p.width*k,p.height*k);q=q&&Math.min(j.width,j.height)>this.minPageBreakDist;var m=(q)?Math.ceil(n/j.width)-1:0;var o=(q)?Math.ceil(v/j.height)-1:0;var u=l.x+n;var g=l.y+v;if(this.horizontalPageBreaks==null&&m>0){this.horizontalPageBreaks=[]}if(this.horizontalPageBreaks!=null){for(var s=0;s<=m;s++){var y=[new mxPoint(l.x+(s+1)*j.width,l.y),new mxPoint(l.x+(s+1)*j.width,g)];if(this.horizontalPageBreaks[s]!=null){this.horizontalPageBreaks[s].scale=1;this.horizontalPageBreaks[s].points=y;this.horizontalPageBreaks[s].redraw()}else{var x=new mxPolyline(y,this.pageBreakColor,this.scale);x.dialect=this.dialect;x.isDashed=this.pageBreakDashed;x.addPipe=false;x.scale=r;x.crisp=true;x.init(this.view.backgroundPane);x.redraw();this.horizontalPageBreaks[s]=x}}for(var s=m;s<this.horizontalPageBreaks.length;s++){this.horizontalPageBreaks[s].destroy()}this.horizontalPageBreaks.splice(m,this.horizontalPageBreaks.length-m)}if(this.verticalPageBreaks==null&&o>0){this.verticalPageBreaks=[]}if(this.verticalPageBreaks!=null){for(var s=0;s<=o;s++){var y=[new mxPoint(l.x,l.y+(s+1)*j.height),new mxPoint(u,l.y+(s+1)*j.height)];if(this.verticalPageBreaks[s]!=null){this.verticalPageBreaks[s].scale=1;this.verticalPageBreaks[s].points=y;this.verticalPageBreaks[s].redraw()}else{var x=new mxPolyline(y,this.pageBreakColor,r);x.dialect=this.dialect;x.isDashed=this.pageBreakDashed;x.addPipe=false;x.scale=r;x.crisp=true;x.init(this.view.backgroundPane);x.redraw();this.verticalPageBreaks[s]=x}}for(var s=o;s<this.verticalPageBreaks.length;s++){this.verticalPageBreaks[s].destroy()}this.verticalPageBreaks.splice(o,this.verticalPageBreaks.length-o)}};mxEdgeHandler.prototype.snapToTerminals=true;mxGraphHandler.prototype.guidesEnabled=true;var a=mxGraphHandler.prototype.shouldRemoveCellsFromParent;mxGraphHandler.prototype.shouldRemoveCellsFromParent=function(l,j,g){for(var k=0;k<j.length;k++){if(this.graph.getModel().isVertex(j[k])){var m=this.graph.getCellGeometry(j[k]);if(m!=null&&m.relative){return false}}}return a.apply(this,arguments)};mxGuide.prototype.isEnabledForEvent=function(g){return !mxEvent.isAltDown(g)};mxPopupMenuAddItem=mxPopupMenu.prototype.addItem;mxPopupMenu.prototype.addItem=function(n,m,i,l,k,j){var g=mxPopupMenuAddItem.apply(this,arguments);if(j!=null&&!j){mxEvent.addListener(g,"mousedown",function(o){mxEvent.consume(o)})}return g};mxEdgeHandler.prototype.addEnabled=true;mxEdgeHandler.prototype.removeEnabled=true;var f=mxGraphHandler.prototype.getInitialCellForEvent;mxGraphHandler.prototype.getInitialCellForEvent=function(l){var j=this.graph.getModel();var i=j.getParent(this.graph.getSelectionCell());var g=f.apply(this,arguments);var k=j.getParent(g);if(i==null||(i!=g&&i!=k)){while(!this.graph.isCellSelected(g)&&!this.graph.isCellSelected(k)&&j.isVertex(k)&&!this.graph.isValidRoot(k)){g=k;k=this.graph.getModel().getParent(g)}}return g};var d=mxGraphHandler.prototype.isDelayedSelection;mxGraphHandler.prototype.isDelayedSelection=function(i){var g=d.apply(this,arguments);var k=this.graph.getModel();var j=k.getParent(this.graph.getSelectionCell());var l=k.getParent(i);if(j==null||(j!=i&&j!=l)){if(!this.graph.isCellSelected(i)&&k.isVertex(l)&&!this.graph.isValidRoot(l)){g=true}}return g};mxGraphHandler.prototype.selectDelayed=function(k){var g=k.getCell();if(g==null){g=this.cell}var i=this.graph.getModel();var j=i.getParent(g);while(this.graph.isCellSelected(g)&&i.isVertex(j)&&!this.graph.isValidRoot(j)){g=j;j=i.getParent(g)}this.graph.selectCellForEvent(g,k.getEvent())};mxPanningHandler.prototype.getCellForPopupEvent=function(k){var g=k.getCell();var i=this.graph.getModel();var j=i.getParent(g);while(i.isVertex(j)&&!this.graph.isValidRoot(j)){if(this.graph.isCellSelected(j)){g=j}j=i.getParent(j)}return g}};Editor.prototype.createUndoManager=function(){var b=this.graph;var c=new mxUndoManager();var a=function(g,f){c.undoableEditHappened(f.getProperty("edit"))};b.getModel().addListener(mxEvent.UNDO,a);b.getView().addListener(mxEvent.UNDO,a);var d=function(k,f){var l=b.getSelectionCellsForChanges(f.getProperty("edit").changes);var g=[];for(var j=0;j<l.length;j++){if(b.view.getState(l[j])!=null){g.push(l[j])}}b.setSelectionCells(g)};c.addListener(mxEvent.UNDO,d);c.addListener(mxEvent.REDO,d);return c};Editor.prototype.initStencilRegistry=function(){mxStencilRegistry.loadStencilSet(STENCIL_PATH+"/general.xml")};(function(){mxStencilRegistry.packages=[];mxStencilRegistry.getStencil=function(b){var a=mxStencilRegistry.stencils[b];if(a==null){var c=mxStencilRegistry.getBasenameForStencil(b);if(c!=null){mxStencilRegistry.loadStencilSet(STENCIL_PATH+"/"+c+".xml",null);a=mxStencilRegistry.stencils[b]}}return a};mxStencilRegistry.getBasenameForStencil=function(a){var d=a.split(".");var c=null;if(d.length>0&&d[0]=="mxgraph"){c=d[1];for(var b=2;b<d.length-1;b++){c+="/"+d[b]}}return c};mxStencilRegistry.loadStencilSet=function(b,c,f){f=(f!=null)?f:false;var a=mxStencilRegistry.packages[b]!=null;if(f||!a){mxStencilRegistry.packages[b]=1;var d=mxUtils.load(b);mxStencilRegistry.parseStencilSet(d.getXml(),c,!a)}};mxStencilRegistry.parseStencilSet=function(i,d,c){c=(c!=null)?c:true;var k=i.documentElement;var j=k.firstChild;var a="";var b=k.getAttribute("name");if(b!=null){a=b+"."}while(j!=null){if(j.nodeType==mxConstants.NODETYPE_ELEMENT){b=j.getAttribute("name");if(b!=null){var l=j.getAttribute("w");var g=j.getAttribute("h");l=(l==null)?80:parseInt(l,10);g=(g==null)?80:parseInt(g,10);a=a.toLowerCase();var f=b.replace(/ /g,"_");if(c){mxStencilRegistry.addStencil(a+f.toLowerCase(),new mxStencil(j))}if(d!=null){d(a,f,b,l,g)}}}j=j.nextSibling}}})();OpenFile=function(a){this.producer=null;this.consumer=null;this.done=a};OpenFile.prototype.setConsumer=function(a){this.consumer=a;this.execute()};OpenFile.prototype.setData=function(b,a){this.data=b;this.filename=a;this.execute()};OpenFile.prototype.error=function(a){this.cancel();mxUtils.alert(a)};OpenFile.prototype.execute=function(){if(this.consumer!=null&&this.data!=null){this.consumer(this.data,this.filename);this.cancel()}};OpenFile.prototype.cancel=function(){if(this.done!=null){this.done()}};Graph=function(b,c,g,d){mxGraph.call(this,b,c,g,d);this.setConnectable(true);this.setDropEnabled(true);this.setPanning(true);this.setTooltips(!mxClient.IS_TOUCH);this.setAllowLoops(true);this.allowAutoPanning=false;this.connectionHandler.setCreateTarget(false);this.alternateEdgeStyle="vertical";if(d==null){this.loadStylesheet()}var a=new mxRubberband(this);this.getRubberband=function(){return a};this.panningHandler.addListener(mxEvent.PAN_START,mxUtils.bind(this,function(){this.container.style.cursor="pointer"}));this.panningHandler.addListener(mxEvent.PAN_END,mxUtils.bind(this,function(){this.container.style.cursor="default"}));this.isHtmlLabel=function(i){var k=this.view.getState(i);var j=(k!=null)?k.style:this.getCellStyle(i);return j.html=="1"};this.isCellLocked=function(i){return false};this.connectionHandler.tapAndHoldTolerance=16;var f=this.connectionHandler.tapAndHold;this.connectionHandler.tapAndHold=function(i,j){if(j==null){if(!this.graph.panningHandler.active){a.start(i.getGraphX(),i.getGraphY());this.graph.panningHandler.panningTrigger=false}}else{if(tapAndHoldStartsConnection){f.apply(this,arguments)}else{if(this.graph.isCellSelected(j.cell)&&this.graph.getSelectionCount()>1){this.graph.removeSelectionCell(j.cell)}}}};if(touchStyle){this.initTouch()}};var ATTRWIN=null,ATTRWINObj=null;function openAttrWin(b,a){w=440;h=570;var c=document.body.clientWidth;var d=(document.body.clientHeight||document.documentElement.clientHeight);ATTRWINObj=Ls.dialog.get();if(ATTRWINObj!=null){ATTRWIN=ATTRWINObj.get("ATTRWIN",1)}if(ATTRWIN!=null){Ls.log.add("ATTRWIN >>>");Ls.log.add(ATTRWIN);if(ATTRWIN.iframe){ATTRWIN.title("\u8bbe\u7f6e["+a+"]\u5c5e\u6027");ATTRWIN.setContent("url:"+b,false,true);ATTRWIN.show()}else{__createAttrWin(b,w,h,45,c-w-10,a)}}else{__createAttrWin(b,w,h,45,c-w-10,a)}}function __createAttrWin(c,d,a,g,f,b){b="\u8bbe\u7f6e["+b+"]\u5c5e\u6027"||"\u8bbe\u7f6e\u5c5e\u6027";Ls.dialog.create({id:"ATTRWIN",title:b,content:"url:"+c,width:d,height:a,left:f,top:g,min:false,max:false,esc:false,colse:function(){return false},resize:true},function(i){ATTRWIN=i})}function hideAttrWin(){if(ATTRWIN!=null){ATTRWIN.hide()}}mxUtils.extend(Graph,mxGraph);Graph.prototype.minFitScale=null;Graph.prototype.maxFitScale=null;Graph.prototype.loadStylesheet=function(){var a=mxUtils.load(STYLE_PATH+"/default.xml").getDocumentElement();var b=new mxCodec(a.ownerDocument);b.decode(a,this.getStylesheet())};Graph.prototype.flipEdge=function(c){if(c!=null){var f=this.view.getState(c);var b=(f!=null)?f.style:this.getCellStyle(c);if(b!=null){var a=mxUtils.getValue(b,mxConstants.STYLE_ELBOW,mxConstants.ELBOW_HORIZONTAL);var d=(a==mxConstants.ELBOW_HORIZONTAL)?mxConstants.ELBOW_VERTICAL:mxConstants.ELBOW_HORIZONTAL;this.setCellStyles(mxConstants.STYLE_ELBOW,d,[c])}}};Graph.prototype.isCellFoldable=function(a){return this.foldingEnabled&&this.isSwimlane(a)};Graph.prototype.isValidRoot=function(a){return this.isSwimlane(a)};Graph.prototype.createGroupCell=function(){var a=mxGraph.prototype.createGroupCell.apply(this,arguments);a.setStyle("group");return a};Graph.prototype.getTooltipForCell=function(a){var b="";if(this.getModel().isVertex(a)){var c=this.getCellGeometry(a);var d=function(f){return Math.round(parseFloat(f)*100)/100};if(c!=null){if(b==null){b=""}else{if(b.length>0){b+="\n"}}b+="X: "+d(c.x)+"\nY: "+d(c.y)+"\nW: "+d(c.width)+"\nH: "+d(c.height)}}else{if(this.getModel().isEdge(a)){b=mxGraph.prototype.getTooltipForCell.apply(this,arguments)}}return b};Graph.prototype.convertValueToString=function(a){if(a.value!=null&&typeof(a.value)=="object"){return a.value.getAttribute("label")}return mxGraph.prototype.convertValueToString.apply(this,arguments)};Graph.prototype.cellLabelChanged=function(b,d,a){if(b.value!=null&&typeof(b.value)=="object"){var c=b.value.cloneNode(true);c.setAttribute("label",d);d=c}mxGraph.prototype.cellLabelChanged.apply(this,arguments)};Graph.prototype.setLinkForCell=function(a,b){var c=null;if(a.value!=null&&typeof(a.value)=="object"){c=a.value.cloneNode(true)}else{var d=mxUtils.createXmlDocument();c=d.createElement("UserObject");c.setAttribute("label",a.value)}if(b!=null&&b.length>0){c.setAttribute("link",b)}else{c.removeAttribute("link")}this.model.setValue(a,c)};Graph.prototype.getLinkForCell=function(a){if(a.value!=null&&typeof(a.value)=="object"){return a.value.getAttribute("link")}return null};Graph.prototype.initTouch=function(){this.connectionHandler.marker.isEnabled=function(){return this.graph.connectionHandler.first!=null};this.addListener(mxEvent.START_EDITING,function(d,c){this.panningHandler.hideMenu()});var a=false;var b=null;this.updateMouseEvent=function(d){mxGraph.prototype.updateMouseEvent.apply(this,arguments);if(d.getState()==null){var c=this.getCellAt(d.graphX,d.graphY);if(this.getModel().isEdge(c)){d.state=this.view.getState(c);if(d.state!=null&&d.state.shape!=null){this.container.style.cursor=d.state.shape.node.style.cursor}}}if(d.getState()==null){this.container.style.cursor="default"}};this.fireMouseEvent=function(g,f,d){if(g==mxEvent.MOUSE_DOWN){if(!this.panningHandler.isMenuShowing()){b=f.getCell();a=(b!=null)?this.isCellSelected(b):this.isSelectionEmpty()}else{a=false;b=null}}else{if(g==mxEvent.MOUSE_UP){if(a&&!this.isEditing()){if(!this.panningHandler.isMenuShowing()){var c=mxEvent.getClientX(f.getEvent());var i=mxEvent.getClientY(f.getEvent());this.panningHandler.popup(c+16,i,b,f.getEvent())}a=false;b=null;f.consume();return}a=false;b=null}}mxGraph.prototype.fireMouseEvent.apply(this,arguments);if(g==mxEvent.MOUSE_MOVE&&f.isConsumed()){a=false;b=null}}};(function(){if(touchStyle){mxConstants.HANDLE_SIZE=16;mxConstants.LABEL_HANDLE_SIZE=7;if(mxClient.IS_TOUCH){mxVertexHandler.prototype.tolerance=4;mxEdgeHandler.prototype.tolerance=6;Graph.prototype.tolerance=14;Graph.prototype.gridSize=20;mxPanningHandler.prototype.selectOnPopup=false;mxPanningHandler.prototype.useLeftButtonForPanning=true;mxPanningHandler.prototype.isPanningTrigger=function(k){var j=k.getEvent();return(this.useLeftButtonForPanning&&(this.ignoreCell||k.getState()==null))||(mxEvent.isControlDown(j)&&mxEvent.isShiftDown(j))||(this.usePopupTrigger&&mxEvent.isPopupTrigger(j))}}var g=mxGraphHandler.prototype.mouseDown;mxGraphHandler.prototype.mouseDown=function(j,k){g.apply(this,arguments);if(this.graph.isCellSelected(k.getCell())&&this.graph.getSelectionCount()>1){this.delayedSelection=false}};Graph.prototype.createHandlers=function(j){this.tooltipHandler=new mxTooltipHandler(this);this.tooltipHandler.setEnabled(false);this.selectionCellsHandler=new mxSelectionCellsHandler(this);this.panningHandler=new mxPanningHandler(this);this.panningHandler.panningEnabled=false;this.connectionHandler=new mxConnectionHandler(this);this.connectionHandler.setEnabled(false);this.graphHandler=new mxGraphHandler(this)};mxConnectionHandler.prototype.selectCells=function(j,k){if(touchStyle&&k!=null){this.graph.setSelectionCell(k)}else{this.graph.setSelectionCell(j)}};var a=mxGraph.prototype.dblClick;Graph.prototype.dblClick=function(k,j){if(j==null){var l=mxUtils.convertPoint(this.container,mxEvent.getClientX(k),mxEvent.getClientY(k));j=this.getCellAt(l.x,l.y)}a.call(this,k,j)};var i=new mxImage(IMAGE_PATH+"/touch-handle.png",16,16);mxVertexHandler.prototype.handleImage=i;mxEdgeHandler.prototype.handleImage=i;mxOutline.prototype.sizerImage=i;new Image().src=i.src;var d=IMAGE_PATH+"/touch-connector.png";var c=mxVertexHandler.prototype.init;mxVertexHandler.prototype.init=function(){c.apply(this,arguments);var j=(mxClient.IS_TOUCH)?"touchstart":"mousedown";if(showConnectorImg&&this.graph.connectionHandler.isEnabled()&&this.graph.isCellConnectable(this.state.cell)&&!this.graph.isValidRoot(this.state.cell)&&this.graph.getSelectionCount()==1){this.connectorImg=mxUtils.createImage(d);this.connectorImg.style.cursor="pointer";this.connectorImg.style.width="29px";this.connectorImg.style.height="29px";this.connectorImg.style.position="absolute";if(!mxClient.IS_TOUCH){this.connectorImg.setAttribute("title",mxResources.get("connect"));mxEvent.redirectMouseEvents(this.connectorImg,this.graph,this.state)}this.connectorImg.style.padding="2px";mxEvent.addListener(this.connectorImg,j,mxUtils.bind(this,function(k){this.graph.panningHandler.hideMenu();var l=mxUtils.convertPoint(this.graph.container,mxEvent.getClientX(k),mxEvent.getClientY(k));this.graph.connectionHandler.start(this.state,l.x,l.y);this.graph.isMouseDown=true;mxEvent.consume(k)}));this.graph.container.appendChild(this.connectorImg)}this.redrawTools()};var b=mxVertexHandler.prototype.redraw;mxVertexHandler.prototype.redraw=function(){b.apply(this);this.redrawTools()};mxVertexHandler.prototype.redrawTools=function(){if(this.state!=null&&this.connectorImg!=null){if(mxVertexHandler.prototype.singleSizer){this.connectorImg.style.left=(this.state.x+this.state.width-this.connectorImg.offsetWidth/2)+"px";this.connectorImg.style.top=(this.state.y-this.connectorImg.offsetHeight/2)+"px"}else{this.connectorImg.style.left=(this.state.x+this.state.width+mxConstants.HANDLE_SIZE/2+4)+"px";this.connectorImg.style.top=(this.state.y+(this.state.height-this.connectorImg.offsetHeight)/2)+"px"}}};var f=mxVertexHandler.prototype.destroy;mxVertexHandler.prototype.destroy=function(j,k){f.apply(this,arguments);if(this.connectorImg!=null){this.connectorImg.parentNode.removeChild(this.connectorImg);this.connectorImg=null}};new Image().src=d}else{}})();function Dialog(l,c,j,f,k,m,i){var n=0;if(mxClient.IS_IE&&document.documentMode!=9){n=60}j+=n;f+=n;var b=Math.max(0,Math.round((document.body.scrollWidth-j)/2));var g=Math.max(0,Math.round((Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)-f)/3));var a=l.createDiv("geDialog");a.style.width=j+"px";a.style.height=f+"px";a.style.left=b+"px";a.style.top=g+"px";if(this.bg==null){this.bg=l.createDiv("background");this.bg.style.position="absolute";this.bg.style.background="white";this.bg.style.left="0px";this.bg.style.top="0px";this.bg.style.bottom="0px";this.bg.style.right="0px";mxUtils.setOpacity(this.bg,80);if(mxClient.IS_QUIRKS){new mxDivResizer(this.bg)}}if(k){document.body.appendChild(this.bg)}a.appendChild(c);document.body.appendChild(a);if(m){var d=document.createElement("img");d.setAttribute("src",IMAGE_PATH+"/close.png");d.setAttribute("title",mxResources.get("close"));d.className="geDialogClose";d.style.top=(g+14)+"px";d.style.left=(b+j+38-n)+"px";mxEvent.addListener(d,"click",mxUtils.bind(this,function(){l.hideDialog()}));document.body.appendChild(d);this.dialogImg=d}this.onDialogClose=i;this.container=a}Dialog.prototype.close=function(){if(this.onDialogClose!=null){this.onDialogClose();this.onDialogClose=null}if(this.dialogImg!=null){this.dialogImg.parentNode.removeChild(this.dialogImg);this.dialogImg=null}this.container.parentNode.removeChild(this.container);this.bg.parentNode.removeChild(this.bg)};function OpenDialog(){var a=document.createElement("iframe");a.style.backgroundColor="transparent";a.allowTransparency="true";a.style.borderStyle="none";a.style.borderWidth="0px";a.style.overflow="hidden";a.frameBorder="0";a.setAttribute("width","320px");a.setAttribute("height","190px");a.setAttribute("src",OPEN_FORM);this.container=a}function ColorDialog(j,c,k){this.editorUi=j;var i=document.createElement("input");i.style.marginBottom="10px";i.style.width="216px";if(mxClient.IS_IE){i.style.marginTop="10px";document.body.appendChild(i)}var d=new jscolor.color(i);d.pickerOnfocus=false;d.showPicker();var a=document.createElement("div");jscolor.picker.box.style.position="relative";jscolor.picker.box.style.width="230px";jscolor.picker.box.style.height="100px";jscolor.picker.box.style.paddingBottom="10px";a.appendChild(jscolor.picker.box);function b(m){var p=document.createElement("table");p.style.borderCollapse="collapse";p.setAttribute("cellspacing","0");p.style.marginBottom="20px";p.style.cellSpacing="0px";var n=document.createElement("tbody");p.appendChild(n);var r=m.length/12;for(var s=0;s<r;s++){var q=document.createElement("tr");for(var o=0;o<12;o++){(function(t){var u=document.createElement("td");u.style.border="1px solid black";u.style.padding="0px";u.style.width="16px";u.style.height="16px";if(t=="none"){u.style.background="url('"+IMAGE_PATH+"/nocolor.png')"}else{u.style.backgroundColor="#"+t}q.appendChild(u);mxEvent.addListener(u,"click",function(){if(t=="none"){d.fromString("ffffff");i.value="none"}else{d.fromString(t)}})})(m[s*12+o])}n.appendChild(q)}var l=document.createElement("center");l.appendChild(p);a.appendChild(l)}a.appendChild(i);mxUtils.br(a);b(["none","FFFFFF","E6E6E6","CCCCCC","B3B3B3","999999","808080","666666","4D4D4D","333333","1A1A1A","000000","FFCCCC","FFE6CC","FFFFCC","E6FFCC","CCFFCC","CCFFE6","CCFFFF","CCE5FF","CCCCFF","E5CCFF","FFCCFF","FFCCE6","FF9999","FFCC99","FFFF99","CCFF99","99FF99","99FFCC","99FFFF","99CCFF","9999FF","CC99FF","FF99FF","FF99CC","FF6666","FFB366","FFFF66","B3FF66","66FF66","66FFB3","66FFFF","66B2FF","6666FF","B266FF","FF66FF","FF66B3","FF3333","FF9933","FFFF33","99FF33","33FF33","33FF99","33FFFF","3399FF","3333FF","9933FF","FF33FF","FF3399","FF0000","FF8000","FFFF00","80FF00","00FF00","00FF80","00FFFF","007FFF","0000FF","7F00FF","FF00FF","FF0080","CC0000","CC6600","CCCC00","66CC00","00CC00","00CC66","00CCCC","0066CC","0000CC","6600CC","CC00CC","CC0066","990000","994C00","999900","4D9900","009900","00994D","009999","004C99","000099","4C0099","990099","99004D","660000","663300","666600","336600","006600","006633","006666","003366","000066","330066","660066","660033","330000","331A00","333300","1A3300","003300","00331A","003333","001933","000033","190033","330033","33001A"]);var g=document.createElement("div");g.style.whiteSpace="nowrap";var f=(k!=null)?k:this.createApplyFunction();g.appendChild(mxUtils.button(mxResources.get("apply"),function(){var l=i.value;if(l!="none"){l="#"+l}f(l);j.hideDialog()}));g.appendChild(mxUtils.button(mxResources.get("cancel"),function(){j.hideDialog()}));if(c!=null){if(c=="none"){d.fromString("ffffff");i.value="none"}else{d.fromString(c)}}a.appendChild(g);this.picker=d;this.colorInput=i;this.container=a}ColorDialog.prototype.createApplyFunction=function(){return mxUtils.bind(this,function(a){this.editorUi.editor.graph.setCellStyles(this.currentColorKey,(a=="none")?"none":a)})};function AboutDialog(c){var f=document.createElement("div");f.setAttribute("align","center");var b=document.createElement("h3");mxUtils.write(b,mxResources.get("about")+" GraphEditor");f.appendChild(b);var a=document.createElement("img");a.style.border="0px";a.setAttribute("width","176");a.setAttribute("width","151");a.setAttribute("src",IMAGE_PATH+"/logo.png");f.appendChild(a);mxUtils.br(f);mxUtils.write(f,"Powered by mxGraph "+mxClient.VERSION);mxUtils.br(f);var d=document.createElement("a");d.setAttribute("href","http://www.jgraph.com/");d.setAttribute("target","_blank");mxUtils.write(d,"www.jgraph.com");f.appendChild(d);mxUtils.br(f);mxUtils.br(f);f.appendChild(mxUtils.button(mxResources.get("close"),function(){c.hideDialog()}));this.container=f}function PageSetupDialog(j){var k=j.editor.graph;var n=mxConstants.PAGE_FORMAT_A4_PORTRAIT;var g=((k.pageFormat.width==n.width&&k.pageFormat.height==n.height)||(k.pageFormat.height==n.width&&k.pageFormat.width==n.height))?n:mxConstants.PAGE_FORMAT_LETTER_PORTRAIT;var o,a;var l=document.createElement("table");l.style.width="100%";l.style.height="100%";var c=document.createElement("tbody");o=document.createElement("tr");a=document.createElement("td");a.style.fontSize="10pt";mxUtils.write(a,mxResources.get("paperSize")+":");o.appendChild(a);var f=document.createElement("select");var d=document.createElement("option");d.setAttribute("value","a4");mxUtils.write(d,"A4");f.appendChild(d);var i=document.createElement("option");i.setAttribute("value","letter");mxUtils.write(i,"Letter");f.appendChild(i);if(g===mxConstants.PAGE_FORMAT_LETTER_PORTRAIT){i.setAttribute("selected","selected")}a=document.createElement("td");a.style.fontSize="10pt";a.appendChild(f);o.appendChild(a);c.appendChild(o);o=document.createElement("tr");a=document.createElement("td");o.appendChild(a);var b=document.createElement("input");b.setAttribute("type","checkbox");if(k.pageFormat.width==g.height){b.setAttribute("checked","checked")}a=document.createElement("td");a.style.padding="4 0 16 2px";a.style.fontSize="10pt";a.appendChild(b);mxUtils.write(a," "+mxResources.get("landscape"));o.appendChild(a);c.appendChild(o);o=document.createElement("tr");a=document.createElement("td");a.style.fontSize="10pt";a.style.width="130px";mxUtils.write(a,mxResources.get("pageScale")+":");o.appendChild(a);var m=document.createElement("input");m.setAttribute("value",(j.editor.graph.pageScale*100)+"%");m.style.width="60px";a=document.createElement("td");a.appendChild(m);o.appendChild(a);c.appendChild(o);o=document.createElement("tr");a=document.createElement("td");a.colSpan=2;a.style.paddingTop="40px";a.setAttribute("align","right");a.appendChild(mxUtils.button(mxResources.get("ok"),function(){j.hideDialog();var p=b.checked;k.pageFormat=(f.value=="letter")?((p)?mxConstants.PAGE_FORMAT_LETTER_LANDSCAPE:mxConstants.PAGE_FORMAT_LETTER_PORTRAIT):((p)?mxConstants.PAGE_FORMAT_A4_LANDSCAPE:mxConstants.PAGE_FORMAT_A4_PORTRAIT);j.editor.outline.outline.pageFormat=k.pageFormat;k.pageScale=parseInt(m.value)/100;if(!k.pageVisible){j.actions.get("pageView").funct()}else{j.editor.updateGraphComponents();k.view.validateBackground();k.sizeDidChange();j.editor.outline.update()}}));a.appendChild(mxUtils.button(mxResources.get("cancel"),function(){j.hideDialog()}));o.appendChild(a);c.appendChild(o);c.appendChild(o);l.appendChild(c);this.container=l}function PrintDialog(m){var n=m.editor.graph;var p=mxConstants.PAGE_FORMAT_A4_PORTRAIT;var i=((n.pageFormat.width==p.width&&n.pageFormat.height==p.height)||(n.pageFormat.height==p.width&&n.pageFormat.width==p.height))?p:mxConstants.PAGE_FORMAT_LETTER_PORTRAIT;var q,a;var o=document.createElement("table");o.style.width="100%";o.style.height="100%";var c=document.createElement("tbody");q=document.createElement("tr");a=document.createElement("td");a.style.fontSize="10pt";mxUtils.write(a,mxResources.get("paperSize")+":");q.appendChild(a);var f=document.createElement("select");var d=document.createElement("option");d.setAttribute("value","a4");mxUtils.write(d,"A4");f.appendChild(d);var j=document.createElement("option");j.setAttribute("value","letter");mxUtils.write(j,"Letter");f.appendChild(j);if(i===mxConstants.PAGE_FORMAT_LETTER_PORTRAIT){j.setAttribute("selected","selected")}a=document.createElement("td");a.style.fontSize="10pt";a.appendChild(f);q.appendChild(a);c.appendChild(q);q=document.createElement("tr");a=document.createElement("td");q.appendChild(a);var b=document.createElement("input");b.setAttribute("type","checkbox");if(n.pageFormat.width==i.height){b.setAttribute("checked","checked")}a=document.createElement("td");a.style.padding="4 0 16 2px";a.style.fontSize="10pt";a.appendChild(b);mxUtils.write(a," "+mxResources.get("landscape"));q.appendChild(a);c.appendChild(q);q=document.createElement("tr");var k=document.createElement("input");k.setAttribute("type","checkbox");a=document.createElement("td");a.style.paddingRight="10px";a.style.fontSize="10pt";a.appendChild(k);mxUtils.write(a," "+mxResources.get("posterPrint")+":");q.appendChild(a);var l=document.createElement("input");l.setAttribute("value","1");l.setAttribute("type","number");l.setAttribute("min","1");l.setAttribute("size","4");l.setAttribute("disabled","disabled");l.style.width="50px";a=document.createElement("td");a.style.fontSize="10pt";a.appendChild(l);mxUtils.write(a," "+mxResources.get("pages"));q.appendChild(a);c.appendChild(q);mxEvent.addListener(k,"change",function(){if(k.checked){l.removeAttribute("disabled")}else{l.setAttribute("disabled","disabled")}});q=document.createElement("tr");a=document.createElement("td");a.colSpan=2;a.style.paddingTop="40px";a.setAttribute("align","right");function g(){var z=b.checked;var C=(f.value=="letter")?((z)?mxConstants.PAGE_FORMAT_LETTER_LANDSCAPE:mxConstants.PAGE_FORMAT_LETTER_PORTRAIT):((z)?mxConstants.PAGE_FORMAT_A4_LANDSCAPE:mxConstants.PAGE_FORMAT_A4_PORTRAIT);var u=1/n.pageScale;if(k.checked){var t=parseInt(l.value);if(!isNaN(t)){u=mxUtils.getScaleForPageCount(t,n,C)}}var I=n.getGraphBounds();var F=k.checked;var v=0;var s=0;var G=0;var E=(I.width>0)?I.x/n.view.scale-n.view.translate.x:0;var D=(I.height>0)?I.y/n.view.scale-n.view.translate.y:0;if(E<0||D<0){F=true;if(n.pageVisible){var r=n.pageScale;var H=C.width*r;var A=C.height*r;s=(E>0)?E:C.width*-Math.floor(Math.min(0,E)/H)+Math.min(0,E)/n.pageScale;G=(D>0)?D:C.height*-Math.floor(Math.min(0,D)/A)+Math.min(0,D)/n.pageScale}else{s=10;G=10}}var B=new mxPrintPreview(n,u,C,v,s,G);B.title=mxResources.get("preview");B.autoOrigin=F;return B.open()}a.appendChild(mxUtils.button(mxResources.get("print"),function(){m.hideDialog();g().print()}));a.appendChild(mxUtils.button(mxResources.get("preview"),function(){m.hideDialog();g()}));a.appendChild(mxUtils.button(mxResources.get("cancel"),function(){m.hideDialog()}));q.appendChild(a);c.appendChild(q);c.appendChild(q);o.appendChild(c);this.container=o}function SaveDialog(a){var g,i;var d=document.createElement("table");var b=document.createElement("tbody");g=document.createElement("tr");i=document.createElement("td");i.style.fontSize="10pt";i.style.width="100px";mxUtils.write(i,mxResources.get("filename")+":");g.appendChild(i);var c=document.createElement("input");c.setAttribute("value",a.editor.getOrCreateFilename());c.style.width="180px";i=document.createElement("td");i.appendChild(c);g.appendChild(i);b.appendChild(g);g=document.createElement("tr");i=document.createElement("td");i.colSpan=2;i.style.paddingTop="30px";i.style.whiteSpace="nowrap";i.setAttribute("align","right");var f=mxUtils.button(mxResources.get("save"),function(){a.save(c.value);a.hideDialog()});i.appendChild(f);i.appendChild(mxUtils.button(mxResources.get("cancel"),function(){a.hideDialog()}));g.appendChild(i);b.appendChild(g);b.appendChild(g);d.appendChild(b);this.container=d}function EditFileDialog(j){var a=document.createElement("div");a.style.textAlign="right";var i=document.createElement("textarea");i.style.width="600px";i.style.height="374px";i.value=mxUtils.getPrettyXml(j.editor.getGraphXml());a.appendChild(i);if(fileSupport){function k(m){m.stopPropagation();m.preventDefault();if(m.dataTransfer.files.length>0){var n=m.dataTransfer.files[0];var l=new FileReader();l.onload=function(o){i.value=o.target.result};l.readAsText(n)}}function c(l){l.stopPropagation();l.preventDefault()}i.addEventListener("dragover",c,false);i.addEventListener("drop",k,false)}var g=document.createElement("select");g.style.width="180px";var f=document.createElement("option");f.setAttribute("value","new");mxUtils.write(f,mxResources.get("openInNewWindow"));g.appendChild(f);var d=document.createElement("option");d.setAttribute("value","replace");mxUtils.write(d,mxResources.get("replaceExistingDrawing"));g.appendChild(d);var b=document.createElement("option");b.setAttribute("value","import");mxUtils.write(b,mxResources.get("addToExistingDrawing"));g.appendChild(b);a.appendChild(g);a.appendChild(mxUtils.button(mxResources.get("ok"),function(){if(g.value=="new"){window.openFile=new OpenFile(function(){j.hideDialog();window.openFile=null});window.openFile.setData(i.value,null);window.open(j.getUrl())}else{if(g.value=="replace"){var o=mxUtils.parseXml(i.value);j.editor.setGraphXml(o.documentElement);j.hideDialog()}else{if(g.value=="import"){var o=mxUtils.parseXml(i.value);var l=new mxGraphModel();var n=new mxCodec(o);n.decode(o.documentElement,l);var m=l.getChildren(l.getChildAt(l.getRoot(),0));j.editor.graph.setSelectionCells(j.editor.graph.importCells(m));j.hideDialog()}}}}));a.appendChild(mxUtils.button(mxResources.get("cancel"),function(){j.hideDialog()}));this.container=a}function ExportDialog(t){var d=t.editor.graph;var k=d.getGraphBounds();var A=d.view.scale;var s=300;var r=220;var j,l;var y=document.createElement("table");y.setAttribute("class","tform");var b=document.createElement("tbody");j=document.createElement("tr");l=document.createElement("td");l.style.fontSize="10pt";l.style.width="100px";mxUtils.write(l,mxResources.get("filename")+":");j.appendChild(l);var m=document.createElement("input");m.setAttribute("value",t.editor.getOrCreateFilename());m.style.width="180px";m.setAttribute("class","text");l=document.createElement("td");l.appendChild(m);j.appendChild(l);b.appendChild(j);j=document.createElement("tr");l=document.createElement("td");l.style.fontSize="10pt";mxUtils.write(l,mxResources.get("format")+":");j.appendChild(l);var n=document.createElement("select");n.style.width="180px";n.setAttribute("class","select");var f=document.createElement("option");f.setAttribute("value","xml");mxUtils.write(f,"XML - Diagramly XML Document");n.appendChild(f);var g=document.createElement("option");g.setAttribute("value","png");mxUtils.write(g,"PNG - Portable Network Graphics");n.appendChild(g);var z=document.createElement("option");z.setAttribute("value","gif");mxUtils.write(z,"GIF - Graphics Interchange Format");n.appendChild(z);var u=document.createElement("option");u.setAttribute("value","jpg");mxUtils.write(u,"JPG - JPEG File Interchange Format");n.appendChild(u);var i=document.createElement("option");i.setAttribute("value","pdf");mxUtils.write(i,"PDF - Portable Document Format");n.appendChild(i);var c=document.createElement("option");c.setAttribute("value","svg");mxUtils.write(c,"SVG - Scalable Vector Graphics");n.appendChild(c);l=document.createElement("td");l.appendChild(n);j.appendChild(l);b.appendChild(j);j=document.createElement("tr");l=document.createElement("td");l.style.fontSize="10pt";mxUtils.write(l,mxResources.get("width")+":");j.appendChild(l);var q=document.createElement("input");q.setAttribute("value",s);q.setAttribute("class","text");q.style.width="180px";l=document.createElement("td");l.appendChild(q);j.appendChild(l);b.appendChild(j);j=document.createElement("tr");l=document.createElement("td");l.style.fontSize="10pt";mxUtils.write(l,mxResources.get("height")+":");j.appendChild(l);var p=document.createElement("input");p.setAttribute("value",r);p.setAttribute("class","text");p.style.width="180px";l=document.createElement("td");l.appendChild(p);j.appendChild(l);b.appendChild(j);j=document.createElement("tr");l=document.createElement("td");l.style.fontSize="10pt";mxUtils.write(l,mxResources.get("borderWidth")+":");j.appendChild(l);var x=document.createElement("input");x.setAttribute("value",s);x.setAttribute("class","text");x.style.width="180px";x.value="0";l=document.createElement("td");l.appendChild(x);j.appendChild(l);b.appendChild(j);y.appendChild(b);function o(){var C=m.value;var B=C.lastIndexOf(".");if(B>0){m.value=C.substring(0,B+1)+n.value}else{m.value=C+"."+n.value}if(n.value==="xml"){q.setAttribute("disabled","true");q.setAttribute("class","text-disabled");p.setAttribute("disabled","true");p.setAttribute("class","text-disabled");x.setAttribute("disabled","true");x.setAttribute("class","text-disabled")}else{q.removeAttribute("disabled");q.setAttribute("class","text");p.removeAttribute("disabled");p.setAttribute("class","text");x.removeAttribute("disabled");x.setAttribute("class","text")}}mxEvent.addListener(n,"change",o);o();function v(){if(q.value>MAX_WIDTH||q.value<0){q.style.backgroundColor="red"}else{q.style.backgroundColor=""}if(p.value>MAX_HEIGHT||p.value<0){p.style.backgroundColor="red"}else{p.style.backgroundColor=""}}mxEvent.addListener(q,"change",function(){if(s>0){p.value=Math.ceil(parseInt(q.value)*r/s)}else{p.value="0"}v()});mxEvent.addListener(p,"change",function(){if(r>0){q.value=Math.ceil(parseInt(p.value)*s/r)}else{q.value="0"}v()});var a=new mxImageExport();j=document.createElement("tr");l=document.createElement("td");l.colSpan=2;l.style.paddingTop="10px";l.setAttribute("align","right");l.appendChild(mxUtils.button(mxResources.get("save"),mxUtils.bind(this,function(){if(parseInt(q.value)<=0&&parseInt(p.value)<=0){mxUtils.alert(mxResources.get("drawingEmpty"))}else{var M=n.value;var C=m.value;if(M=="xml"){var I=encodeURIComponent(mxUtils.getXml(t.editor.getGraphXml()));new mxXmlRequest(SAVE_URL,"filename="+escape(C)+"&xml="+I).simulate(document,"")}else{if(M=="svg"){var F=Math.max(0,parseInt(x.value))+1;var D=parseInt(q.value)/s;var B=d.getGraphBounds();var O=mxUtils.createXmlDocument();var K=(O.createElementNS!=null)?O.createElementNS(mxConstants.NS_SVG,"svg"):O.createElement("svg");if(d.background!=null){if(K.style!=null){K.style.backgroundColor=d.background}else{K.setAttribute("style","background-color:"+d.background)}}if(O.createElementNS==null){K.setAttribute("xmlns",mxConstants.NS_SVG)}K.setAttribute("width",(Math.ceil(B.width*D)+2*F)+"px");K.setAttribute("height",(Math.ceil(B.height*D)+2*F)+"px");K.setAttribute("version","1.1");O.appendChild(K);var J=new mxSvgCanvas2D(K);J.scale(D);J.translate(Math.floor(-B.x)+F,Math.floor(-B.y)+F);a.drawState(d.getView().getState(d.model.root),J);var I=mxUtils.getXml(K);if(I.length<MAX_REQUEST_SIZE){new mxXmlRequest(SAVE_URL,"filename="+escape(C)+"&format="+M+"&xml="+I)}else{mxUtils.alert(mxResources.get("drawingTooLarge"));mxUtils.popup(I)}}else{var F=Math.max(0,parseInt(x.value))+1;var D=parseInt(q.value)/s;var B=d.getGraphBounds();var N=mxUtils.createXmlDocument();var K=N.createElement("output");N.appendChild(K);var E=new mxXmlCanvas2D(K);E.scale(D);E.translate(Math.floor(-B.x*D)+F,Math.floor(-B.y*D)+F);a.drawState(d.getView().getState(d.model.root),E);var L=Math.ceil(B.width*D)+2*F;var H=Math.ceil(B.height*D)+2*F;var I=mxUtils.getXml(K);if(I.length<=MAX_REQUEST_SIZE&&s<MAX_WIDTH&&s>0&&r<MAX_HEIGHT&&r>0){var G=d.background||"#ffffff";new mxXmlRequest(EXPORT_URL,"filename="+escape(C)+"&format="+M+"&bg="+G+"&w="+L+"&h="+H+"&plain="+encodeURIComponent(I)).simulate(document,"_blank")}else{mxUtils.alert(mxResources.get("drawingTooLarge"))}}}t.hideDialog()}})));l.appendChild(mxUtils.button(mxResources.get("cancel"),function(){t.hideDialog()}));j.appendChild(l);b.appendChild(j);b.appendChild(j);y.appendChild(b);this.container=y}function Actions(a){this.editorUi=a;this.actions=new Object();this.init()}Actions.prototype.init=function(){var d=this.editorUi;var a=d.editor;var c=a.graph;this.addAction("new",function(){window.open(d.getUrl())});this.addAction("open",function(){window.openNew=true;window.openKey="open";d.openFile()});this.addAction("import",function(){mxLog.debug("action import >>> ");window.openNew=false;window.openKey="import";window.openFile=new OpenFile(mxUtils.bind(this,function(){d.hideDialog()}));window.openFile.setConsumer(mxUtils.bind(this,function(i,g){mxLog.debug("window.openFile.setConsumer >>> ");try{var k=mxUtils.parseXml(i);a.setGraphXml(k.documentElement);var l=mxUtils.getXml(a.getGraphXml())}catch(j){mxUtils.alert(mxResources.get("invalidOrMissingFile")+": "+j.message)}}));d.showDialog(new OpenDialog(this).container,300,180,true,true,function(){window.openFile=null})});this.addAction("save",function(){mxLog.info("action-save click >>>");d.saveFile(false)},null,null,"Ctrl+S");this.addAction("saveAs",function(){d.saveFile(true)},null,null,"Ctrl+Shift-S");this.addAction("export",function(){d.showDialog(new ExportDialog(d).container,300,200,true,true)},null,null,"Ctrl+E");this.put("editFile",new Action(mxResources.get("edit"),mxUtils.bind(this,function(){this.editorUi.showDialog(new EditFileDialog(d).container,620,420,true,true)})));this.addAction("pageSetup",function(){d.showDialog(new PageSetupDialog(d).container,300,200,true,true)});this.addAction("print",function(){d.showDialog(new PrintDialog(d).container,300,200,true,true)},null,"sprite-print","Ctrl+P");this.addAction("preview",function(){mxUtils.show(c,null,10,10)});this.addAction("undo",function(){a.undoManager.undo()},null,"sprite-undo","Ctrl+Z");this.addAction("redo",function(){a.undoManager.redo()},null,"sprite-redo","Ctrl+Y");this.addAction("cut",function(){mxClipboard.cut(c)},null,"sprite-cut","Ctrl+X");this.addAction("copy",function(){mxClipboard.copy(c)},null,"sprite-copy","Ctrl+C");this.addAction("paste",function(){mxClipboard.paste(c)},false,"sprite-paste","Ctrl+V");this.addAction("delete",function(){var k=c.getSelectionCells();if(k){for(var m=0,j=k.length;m<j;m++){var g=k[m];var l=g.activityType,n=g.activityId;if((l&&(l==1))&&n>0){alert("\u5f00\u59cb\u8282\u70b9\u4e0d\u5141\u8bb8\u5220\u9664!")}else{c.removeCells([g])}}}},null,null,"Delete");this.addAction("duplicate",function(){var g=c.gridSize;c.setSelectionCells(c.moveCells(c.getSelectionCells(),g,g,true))},null,null,"Ctrl+D");this.addAction("selectVertices",function(){c.selectVertices()},null,null,"Ctrl+Shift+V");this.addAction("selectEdges",function(){c.selectEdges()},null,null,"Ctrl+Shift+E");this.addAction("selectAll",function(){c.selectAll()},null,null,"Ctrl+A");this.addAction("home",function(){c.home()},null,null,"Home");this.addAction("exitGroup",function(){c.exitGroup()},null,null,"Page Up");this.addAction("enterGroup",function(){c.enterGroup()},null,null,"Page Down");this.addAction("expand",function(){c.foldCells(false)},null,null,"Enter");this.addAction("collapse",function(){c.foldCells(true)},null,null,"Backspace");this.addAction("toFront",function(){c.orderCells(false)},null,null,"Ctrl+F");this.addAction("toBack",function(){c.orderCells(true)},null,null,"Ctrl+B");this.addAction("group",function(){c.setSelectionCell(c.groupCells(null,0))},null,null,"Ctrl+G");this.addAction("ungroup",function(){c.setSelectionCells(c.ungroupCells())},null,null,"Ctrl+U");this.addAction("removeFromGroup",function(){c.removeCellsFromParent()});this.addAction("editLink",function(){var g=c.getSelectionCell();var i=c.getLinkForCell(g);if(i==null){i=""}i=mxUtils.prompt(mxResources.get("enterValue"),i);if(i!=null){c.setLinkForCell(g,i)}});this.addAction("openLink",function(){var g=c.getSelectionCell();var i=c.getLinkForCell(g);if(i!=null){window.open(i)}});this.addAction("autosize",function(){var j=c.getSelectionCells();if(j!=null){c.getModel().beginUpdate();try{for(var k=0;k<j.length;k++){var g=j[k];if(c.getModel().getChildCount(g)){c.updateGroupBounds([g],20)}else{c.updateCellSize(g)}}}finally{c.getModel().endUpdate()}}});this.addAction("rotation",function(){var i="0";var g=c.getView().getState(c.getSelectionCell());if(g!=null){i=g.style[mxConstants.STYLE_ROTATION]||i}i=mxUtils.prompt(mxResources.get("enterValue")+" ("+mxResources.get("rotation")+" 0-360)",i);if(i!=null){c.setCellStyles(mxConstants.STYLE_ROTATION,i)}});this.addAction("rotate",function(){var k=c.getSelectionCells();if(k!=null){c.getModel().beginUpdate();try{for(var m=0;m<k.length;m++){var g=k[m];if(c.getModel().isVertex(g)&&c.getModel().getChildCount(g)==0){var o=c.getCellGeometry(g);if(o!=null){o=o.clone();o.x+=o.width/2-o.height/2;o.y+=o.height/2-o.width/2;var l=o.width;o.width=o.height;o.height=l;c.getModel().setGeometry(g,o);var n=c.view.getState(g);if(n!=null){var j=n.style[mxConstants.STYLE_DIRECTION]||"east";if(j=="east"){j="south"}else{if(j=="south"){j="west"}else{if(j=="west"){j="north"}else{if(j=="north"){j="east"}}}}c.setCellStyles(mxConstants.STYLE_DIRECTION,j,[g])}}}}}finally{c.getModel().endUpdate()}}},null,null,"Ctrl+R");this.addAction("actualSize",function(){c.zoomTo(1)});this.addAction("zoomIn",function(){c.zoomIn()},null,null,"Add");this.addAction("zoomOut",function(){c.zoomOut()},null,null,"Subtract");this.addAction("fitWindow",function(){c.fit()});this.addAction("fitPage",mxUtils.bind(this,function(){if(!c.pageVisible){this.get("pageView").funct()}var i=c.pageFormat;var l=c.pageScale;var g=c.container.clientWidth-20;var j=c.container.clientHeight-20;var k=Math.floor(100*Math.min(g/i.width/l,j/i.height/l))/100;c.zoomTo(k);c.container.scrollLeft=Math.round(c.view.translate.x*k-Math.max(10,(c.container.clientWidth-i.width*l*k)/2));c.container.scrollTop=Math.round(c.view.translate.y*k-Math.max(10,(c.container.clientHeight-i.height*l*k)/2))}));this.addAction("fitPageWidth",mxUtils.bind(this,function(){if(!c.pageVisible){this.get("pageView").funct()}var i=c.pageFormat;var k=c.pageScale;var g=c.container.clientWidth-20;var j=Math.floor(100*g/i.width/k)/100;c.zoomTo(j);c.container.scrollLeft=Math.round(c.view.translate.x*j-Math.max(10,(c.container.clientWidth-i.width*k*j)/2));c.container.scrollTop=Math.round(c.view.translate.y*j-Math.max(10,(c.container.clientHeight-i.height*k*j)/2))}));this.put("customZoom",new Action(mxResources.get("custom"),function(){var g=mxUtils.prompt(mxResources.get("enterValue")+" (%)",parseInt(c.getView().getScale()*100));if(g!=null&&g.length>0&&!isNaN(parseInt(g))){c.zoomTo(parseInt(g)/100)}}));var b=null;b=this.addAction("grid",function(){c.setGridEnabled(!c.isGridEnabled());a.updateGraphComponents()},null,null,"Ctrl+Shift+G");b.setToggleAction(true);b.setSelectedCallback(function(){return c.isGridEnabled()});b=this.addAction("guides",function(){c.graphHandler.guidesEnabled=!c.graphHandler.guidesEnabled});b.setToggleAction(true);b.setSelectedCallback(function(){return c.graphHandler.guidesEnabled});b=this.addAction("tooltips",function(){c.tooltipHandler.setEnabled(!c.tooltipHandler.isEnabled())});b.setToggleAction(true);b.setSelectedCallback(function(){return c.tooltipHandler.isEnabled()});b=this.addAction("navigation",function(){c.foldingEnabled=!c.foldingEnabled;c.view.revalidate()});b.setToggleAction(true);b.setSelectedCallback(function(){return c.foldingEnabled});b=this.addAction("scrollbars",function(){c.scrollbars=!c.scrollbars;a.updateGraphComponents();if(!c.scrollbars){var j=c.view.translate;c.view.setTranslate(j.x-c.container.scrollLeft/c.view.scale,j.y-c.container.scrollTop/c.view.scale);c.container.scrollLeft=0;c.container.scrollTop=0;c.sizeDidChange()}else{var i=c.view.translate.x;var g=c.view.translate.y;c.view.translate.x=0;c.view.translate.y=0;c.sizeDidChange();c.container.scrollLeft-=Math.round(i*c.view.scale);c.container.scrollTop-=Math.round(g*c.view.scale)}},!mxClient.IS_TOUCH);b.setToggleAction(true);b.setSelectedCallback(function(){return c.container.style.overflow=="auto"});b=this.addAction("pageView",mxUtils.bind(this,function(){c.pageVisible=!c.pageVisible;c.pageBreaksVisible=c.pageVisible;c.preferPageSize=c.pageBreaksVisible;c.view.validate();c.sizeDidChange();a.updateGraphComponents();a.outline.update();if(mxUtils.hasScrollbars(c.container)){if(c.pageVisible){c.container.scrollLeft-=20;c.container.scrollTop-=20}else{c.container.scrollLeft+=20;c.container.scrollTop+=20}}}));b.setToggleAction(true);b.setSelectedCallback(function(){return c.pageVisible});this.put("pageBackgroundColor",new Action(mxResources.get("backgroundColor"),function(){var g=function(j){c.background=j;a.updateGraphComponents()};var i=new ColorDialog(d,c.background||"none",g);d.showDialog(i.container,220,360,true,false);if(!mxClient.IS_TOUCH){i.colorInput.focus()}}));b=this.addAction("connect",function(){c.setConnectable(!c.connectionHandler.isEnabled())},null,null,"Ctrl+Q");b.setToggleAction(true);b.setSelectedCallback(function(){return c.connectionHandler.isEnabled()});this.addAction("help",function(){var g="";if(mxResources.isLanguageSupported(mxClient.language)){g="_"+mxClient.language}window.open(RESOURCES_PATH+"/help"+g+".html")});this.put("about",new Action(mxResources.get("about")+" Graph Editor",function(){d.showDialog(new AboutDialog(d).container,320,280,true,true)},null,null,"F1"));var f=mxUtils.bind(this,function(g,i){this.addAction(g,function(){c.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,i)})});f("bold",mxConstants.FONT_BOLD);f("italic",mxConstants.FONT_ITALIC);f("underline",mxConstants.FONT_UNDERLINE);this.addAction("fontColor",function(){d.menus.pickColor(mxConstants.STYLE_FONTCOLOR)});this.addAction("strokeColor",function(){d.menus.pickColor(mxConstants.STYLE_STROKECOLOR)});this.addAction("fillColor",function(){d.menus.pickColor(mxConstants.STYLE_FILLCOLOR)});this.addAction("gradientColor",function(){d.menus.pickColor(mxConstants.STYLE_GRADIENTCOLOR)});this.addAction("backgroundColor",function(){d.menus.pickColor(mxConstants.STYLE_LABEL_BACKGROUNDCOLOR)});this.addAction("borderColor",function(){d.menus.pickColor(mxConstants.STYLE_LABEL_BORDERCOLOR)});this.addAction("shadow",function(){c.toggleCellStyles(mxConstants.STYLE_SHADOW)});this.addAction("dashed",function(){c.toggleCellStyles(mxConstants.STYLE_DASHED)});this.addAction("rounded",function(){c.toggleCellStyles(mxConstants.STYLE_ROUNDED)});this.addAction("style",function(){var i=c.getSelectionCells();if(i!=null&&i.length>0){var g=c.getModel();var j=mxUtils.prompt(mxResources.get("enterValue")+" ("+mxResources.get("style")+")",g.getStyle(i[0])||"");if(j!=null){c.setCellStyle(j,i)}}});this.addAction("setAsDefaultEdge",function(){var g=c.getSelectionCell();if(g!=null&&c.getModel().isEdge(g)){var j=c.getModel().cloneCells([g])[0];var i=j.getStyle();i=mxUtils.setStyle(i,mxConstants.STYLE_ENTRY_X,"");i=mxUtils.setStyle(i,mxConstants.STYLE_ENTRY_Y,"");i=mxUtils.setStyle(i,mxConstants.STYLE_EXIT_X,"");i=mxUtils.setStyle(i,mxConstants.STYLE_EXIT_Y,"");j.setStyle(i);c.connectionHandler.createEdgeState=function(k){return c.view.createState(j)};c.connectionHandler.factoryMethod=function(){return c.cloneCells([j])[0]}}});this.addAction("image",function(){function i(r,n,q){var m=null;var p=c.getSelectionCells();c.getModel().beginUpdate();try{if(p.length==0){var o=c.getGridSize();p=[c.insertVertex(c.getDefaultParent(),null,"",o,o,n,q)];m=p}c.setCellStyles(mxConstants.STYLE_IMAGE,r,p);c.setCellStyles(mxConstants.STYLE_SHAPE,"image",p);if(c.getSelectionCount()==1){if(n!=null&&q!=null){var l=p[0];var s=c.getModel().getGeometry(l);if(s!=null){s=s.clone();s.width=n;s.height=q;c.getModel().setGeometry(l,s)}}}}finally{c.getModel().endUpdate()}if(m!=null){c.setSelectionCells(m);c.scrollCellToVisible(m[0])}}var k="";var j=c.getView().getState(c.getSelectionCell());if(j!=null){k=j.style[mxConstants.STYLE_IMAGE]||k}k=mxUtils.prompt(mxResources.get("enterValue")+" ("+mxResources.get("url")+")",k);if(k!=null){if(k.length>0){var g=new Image();g.onload=function(){i(k,g.width,g.height)};g.onerror=function(){mxUtils.alert(mxResources.get("fileNotFound"))};g.src=k}}})};Actions.prototype.addAction=function(f,b,c,d,a){return this.put(f,new Action(mxResources.get(f),b,c,d,a))};Actions.prototype.put=function(a,b){this.actions[a]=b;return b};Actions.prototype.get=function(a){return this.actions[a]};function Action(d,b,c,f,a){mxEventSource.call(this);this.label=d;this.funct=b;this.enabled=(c!=null)?c:true;this.iconCls=f;this.shortcut=a}mxUtils.extend(Action,mxEventSource);Action.prototype.setEnabled=function(a){if(this.enabled!=a){this.enabled=a;this.fireEvent(new mxEventObject("stateChanged"))}};Action.prototype.setToggleAction=function(a){this.toggleAction=a};Action.prototype.setSelectedCallback=function(a){this.selectedCallback=a};Action.prototype.isSelected=function(){return this.selectedCallback()};Menus=function(a){this.editorUi=a;this.menus=new Object();this.init();new Image().src=IMAGE_PATH+"/checkmark.gif"};Menus.prototype.init=function(){var a=this.editorUi.editor.graph;this.put("fontFamily",new Menu(mxUtils.bind(this,function(f,c){var g=["Helvetica","Verdana","Times New Roman","Garamond","Comic Sans MS","Courier New","Georgia","Lucida Console","Tahoma"];for(var b=0;b<g.length;b++){var d=this.styleChange(f,g[b],[mxConstants.STYLE_FONTFAMILY],[g[b]],null,c);d.firstChild.nextSibling.style.fontFamily=g[b]}f.addSeparator(c);this.promptChange(f,mxResources.get("custom"),"",mxConstants.DEFAULT_FONTFAMILY,mxConstants.STYLE_FONTFAMILY,c)})));this.put("fontSize",new Menu(mxUtils.bind(this,function(f,c){var d=[6,8,9,10,11,12,14,18,24,36,48,72];for(var b=0;b<d.length;b++){this.styleChange(f,d[b],[mxConstants.STYLE_FONTSIZE],[d[b]],null,c)}f.addSeparator(c);this.promptChange(f,mxResources.get("custom"),"(pt)","12",mxConstants.STYLE_FONTSIZE,c)})));this.put("linewidth",new Menu(mxUtils.bind(this,function(f,c){var d=[1,2,3,4,8,12,16,24];for(var b=0;b<d.length;b++){this.styleChange(f,d[b]+"px",[mxConstants.STYLE_STROKEWIDTH],[d[b]],null,c)}f.addSeparator(c);this.promptChange(f,mxResources.get("custom"),"(px)","1",mxConstants.STYLE_STROKEWIDTH,c)})));this.put("line",new Menu(mxUtils.bind(this,function(c,b){this.styleChange(c,mxResources.get("straight"),[mxConstants.STYLE_EDGE],[null],null,b);this.styleChange(c,mxResources.get("entityRelation"),[mxConstants.STYLE_EDGE],["entityRelationEdgeStyle"],null,b);c.addSeparator(b);this.styleChange(c,mxResources.get("horizontal"),[mxConstants.STYLE_EDGE,mxConstants.STYLE_ELBOW],["elbowEdgeStyle","horizontal"],null,b);this.styleChange(c,mxResources.get("vertical"),[mxConstants.STYLE_EDGE,mxConstants.STYLE_ELBOW],["elbowEdgeStyle","vertical"],null,b);c.addSeparator(b);this.styleChange(c,mxResources.get("plain"),[mxConstants.STYLE_EDGE],["segmentEdgeStyle"],null,b);this.styleChange(c,mxResources.get("orthogonal"),[mxConstants.STYLE_EDGE],["orthogonalEdgeStyle"],null,b)})));this.put("lineend",new Menu(mxUtils.bind(this,function(c,b){this.styleChange(c,mxResources.get("classic"),[mxConstants.STYLE_ENDARROW],[mxConstants.ARROW_CLASSIC],null,b);this.styleChange(c,mxResources.get("openArrow"),[mxConstants.STYLE_ENDARROW],[mxConstants.ARROW_OPEN],null,b);this.styleChange(c,mxResources.get("block"),[mxConstants.STYLE_ENDARROW],[mxConstants.ARROW_BLOCK],null,b);c.addSeparator(b);this.styleChange(c,mxResources.get("oval"),[mxConstants.STYLE_ENDARROW],[mxConstants.ARROW_OVAL],null,b);this.styleChange(c,mxResources.get("diamond"),[mxConstants.STYLE_ENDARROW],[mxConstants.ARROW_DIAMOND],null,b);this.styleChange(c,mxResources.get("diamondThin"),[mxConstants.STYLE_ENDARROW],[mxConstants.ARROW_DIAMOND_THIN],null,b);c.addSeparator(b);this.styleChange(c,mxResources.get("none"),[mxConstants.STYLE_ENDARROW],[mxConstants.NONE],null,b);c.addSeparator(b);c.addItem(mxResources.get("transparent"),null,function(){a.toggleCellStyles("endFill",true)},b,null,true);c.addSeparator(b);this.promptChange(c,mxResources.get("size"),"(px)",mxConstants.DEFAULT_MARKERSIZE,mxConstants.STYLE_ENDSIZE,b)})));this.put("linestart",new Menu(mxUtils.bind(this,function(c,b){this.styleChange(c,mxResources.get("classic"),[mxConstants.STYLE_STARTARROW],[mxConstants.ARROW_CLASSIC],null,b);this.styleChange(c,mxResources.get("openArrow"),[mxConstants.STYLE_STARTARROW],[mxConstants.ARROW_OPEN],null,b);this.styleChange(c,mxResources.get("block"),[mxConstants.STYLE_STARTARROW],[mxConstants.ARROW_BLOCK],null,b);c.addSeparator(b);this.styleChange(c,mxResources.get("oval"),[mxConstants.STYLE_STARTARROW],[mxConstants.ARROW_OVAL],null,b);this.styleChange(c,mxResources.get("diamond"),[mxConstants.STYLE_STARTARROW],[mxConstants.ARROW_DIAMOND],null,b);this.styleChange(c,mxResources.get("diamondThin"),[mxConstants.STYLE_STARTARROW],[mxConstants.ARROW_DIAMOND_THIN],null,b);c.addSeparator(b);this.styleChange(c,mxResources.get("none"),[mxConstants.STYLE_STARTARROW],[mxConstants.NONE],null,b);c.addSeparator(b);c.addItem(mxResources.get("transparent"),null,function(){a.toggleCellStyles("startFill",true)},b,null,true);c.addSeparator(b);this.promptChange(c,mxResources.get("size"),"(px)",mxConstants.DEFAULT_MARKERSIZE,mxConstants.STYLE_STARTSIZE,b)})));this.put("spacing",new Menu(mxUtils.bind(this,function(f,d){var c=this.editorUi.actions.get("shadow").enabled;var b=this.get("line").enabled;if(c||f.showDisabled){this.promptChange(f,mxResources.get("top"),"(px)","0",mxConstants.STYLE_SPACING_TOP,d,c);this.promptChange(f,mxResources.get("right"),"(px)","0",mxConstants.STYLE_SPACING_RIGHT,d,c);this.promptChange(f,mxResources.get("bottom"),"(px)","0",mxConstants.STYLE_SPACING_BOTTOM,d,c);this.promptChange(f,mxResources.get("left"),"(px)","0",mxConstants.STYLE_SPACING_LEFT,d,c);f.addSeparator(d);this.promptChange(f,mxResources.get("global"),"(px)","0",mxConstants.STYLE_SPACING,d,c);this.promptChange(f,mxResources.get("perimeter"),"(px)","0",mxConstants.STYLE_PERIMETER_SPACING,d,c)}if(b||f.showDisabled){f.addSeparator(d);this.promptChange(f,mxResources.get("sourceSpacing"),"(px)","0",mxConstants.STYLE_SOURCE_PERIMETER_SPACING,d,b);this.promptChange(f,mxResources.get("targetSpacing"),"(px)","0",mxConstants.STYLE_TARGET_PERIMETER_SPACING,d,b)}})));this.put("format",new Menu(mxUtils.bind(this,function(c,b){this.addSubmenu("spacing",c,b);this.addMenuItems(c,["-","fillColor"],b);this.addSubmenu("gradient",c,b);this.addMenuItems(c,["-","shadow"],b);this.promptChange(c,mxResources.get("opacity"),"(%)","100",mxConstants.STYLE_OPACITY,b,this.get("format").enabled);this.addMenuItems(c,["-","rounded","dashed","-","strokeColor"],b);this.addSubmenu("linewidth",c,b);this.addMenuItems(c,["-"],b);this.addSubmenu("line",c,b);this.addMenuItems(c,["-"],b);this.addSubmenu("linestart",c,b);this.addSubmenu("lineend",c,b);c.addSeparator(b);this.addMenuItem(c,"style",b)})));this.put("gradient",new Menu(mxUtils.bind(this,function(c,b){this.addMenuItems(c,["gradientColor","-"],b);this.styleChange(c,mxResources.get("north"),[mxConstants.STYLE_GRADIENT_DIRECTION],[mxConstants.DIRECTION_NORTH],null,b);this.styleChange(c,mxResources.get("east"),[mxConstants.STYLE_GRADIENT_DIRECTION],[mxConstants.DIRECTION_EAST],null,b);this.styleChange(c,mxResources.get("south"),[mxConstants.STYLE_GRADIENT_DIRECTION],[mxConstants.DIRECTION_SOUTH],null,b);this.styleChange(c,mxResources.get("west"),[mxConstants.STYLE_GRADIENT_DIRECTION],[mxConstants.DIRECTION_WEST],null,b)})));this.put("text",new Menu(mxUtils.bind(this,function(d,c){this.addMenuItem(d,"fontColor",c);d.addSeparator(c);this.addSubmenu("fontFamily",d,c);this.addSubmenu("fontSize",d,c);this.addMenuItems(d,["-","bold","italic","underline","-"],c);this.addSubmenu("alignment",d,c);this.addSubmenu("position",d,c);this.addMenuItems(d,["-","backgroundColor","borderColor","-"],c);var b=this.get("text").enabled;this.promptChange(d,mxResources.get("textOpacity"),"(%)","100",mxConstants.STYLE_TEXT_OPACITY,c,b);d.addItem(mxResources.get("hide"),null,function(){a.toggleCellStyles(mxConstants.STYLE_NOLABEL,false)},c,null,b);d.addItem(mxResources.get("rotate"),null,function(){a.toggleCellStyles(mxConstants.STYLE_HORIZONTAL,true)},c,null,b)})));this.put("alignment",new Menu(mxUtils.bind(this,function(c,b){this.styleChange(c,mxResources.get("leftAlign"),[mxConstants.STYLE_ALIGN],[mxConstants.ALIGN_LEFT],null,b);this.styleChange(c,mxResources.get("center"),[mxConstants.STYLE_ALIGN],[mxConstants.ALIGN_CENTER],null,b);this.styleChange(c,mxResources.get("rightAlign"),[mxConstants.STYLE_ALIGN],[mxConstants.ALIGN_RIGHT],null,b);c.addSeparator(b);this.styleChange(c,mxResources.get("topAlign"),[mxConstants.STYLE_VERTICAL_ALIGN],[mxConstants.ALIGN_TOP],null,b);this.styleChange(c,mxResources.get("middle"),[mxConstants.STYLE_VERTICAL_ALIGN],[mxConstants.ALIGN_MIDDLE],null,b);this.styleChange(c,mxResources.get("bottomAlign"),[mxConstants.STYLE_VERTICAL_ALIGN],[mxConstants.ALIGN_BOTTOM],null,b)})));this.put("position",new Menu(mxUtils.bind(this,function(c,b){this.styleChange(c,mxResources.get("left"),[mxConstants.STYLE_LABEL_POSITION,mxConstants.STYLE_ALIGN],[mxConstants.ALIGN_LEFT,mxConstants.ALIGN_RIGHT],null,b);this.styleChange(c,mxResources.get("center"),[mxConstants.STYLE_LABEL_POSITION,mxConstants.STYLE_ALIGN],[mxConstants.ALIGN_CENTER,mxConstants.ALIGN_CENTER],null,b);this.styleChange(c,mxResources.get("right"),[mxConstants.STYLE_LABEL_POSITION,mxConstants.STYLE_ALIGN],[mxConstants.ALIGN_RIGHT,mxConstants.ALIGN_LEFT],null,b);c.addSeparator(b);this.styleChange(c,mxResources.get("top"),[mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.STYLE_VERTICAL_ALIGN],[mxConstants.ALIGN_TOP,mxConstants.ALIGN_BOTTOM],null,b);this.styleChange(c,mxResources.get("middle"),[mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.STYLE_VERTICAL_ALIGN],[mxConstants.ALIGN_MIDDLE,mxConstants.ALIGN_MIDDLE],null,b);this.styleChange(c,mxResources.get("bottom"),[mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.STYLE_VERTICAL_ALIGN],[mxConstants.ALIGN_BOTTOM,mxConstants.ALIGN_TOP],null,b)})));this.put("direction",new Menu(mxUtils.bind(this,function(c,b){this.styleChange(c,mxResources.get("north"),[mxConstants.STYLE_DIRECTION],[mxConstants.DIRECTION_NORTH],null,b);this.styleChange(c,mxResources.get("east"),[mxConstants.STYLE_DIRECTION],[mxConstants.DIRECTION_EAST],null,b);this.styleChange(c,mxResources.get("south"),[mxConstants.STYLE_DIRECTION],[mxConstants.DIRECTION_SOUTH],null,b);this.styleChange(c,mxResources.get("west"),[mxConstants.STYLE_DIRECTION],[mxConstants.DIRECTION_WEST],null,b);c.addSeparator(b);c.addItem(mxResources.get("flipH"),null,function(){a.getModel().beginUpdate();try{a.toggleCellStyles(mxConstants.STYLE_STENCIL_FLIPH,false);a.toggleCellStyles(mxConstants.STYLE_IMAGE_FLIPH,false)}finally{a.getModel().endUpdate()}},b);c.addItem(mxResources.get("flipV"),null,function(){a.getModel().beginUpdate();try{a.toggleCellStyles(mxConstants.STYLE_STENCIL_FLIPV,false);a.toggleCellStyles(mxConstants.STYLE_IMAGE_FLIPV,false)}finally{a.getModel().endUpdate()}},b);this.addMenuItem(c,"rotation",b)})));this.put("align",new Menu(mxUtils.bind(this,function(c,b){c.addItem(mxResources.get("leftAlign"),null,function(){a.alignCells(mxConstants.ALIGN_LEFT)},b);c.addItem(mxResources.get("center"),null,function(){a.alignCells(mxConstants.ALIGN_CENTER)},b);c.addItem(mxResources.get("rightAlign"),null,function(){a.alignCells(mxConstants.ALIGN_RIGHT)},b);c.addSeparator(b);c.addItem(mxResources.get("topAlign"),null,function(){a.alignCells(mxConstants.ALIGN_TOP)},b);c.addItem(mxResources.get("middle"),null,function(){a.alignCells(mxConstants.ALIGN_MIDDLE)},b);c.addItem(mxResources.get("bottomAlign"),null,function(){a.alignCells(mxConstants.ALIGN_BOTTOM)},b)})));this.put("layout",new Menu(mxUtils.bind(this,function(c,b){c.addItem(mxResources.get("horizontalTree"),null,mxUtils.bind(this,function(){if(!a.isSelectionEmpty()){var d=new mxCompactTreeLayout(a,true);d.edgeRouting=false;d.levelDistance=30;this.editorUi.executeLayout(d,true,true)}}),b);c.addItem(mxResources.get("verticalTree"),null,mxUtils.bind(this,function(){if(!a.isSelectionEmpty()){var d=new mxCompactTreeLayout(a,false);d.edgeRouting=false;d.levelDistance=30;this.editorUi.executeLayout(d,true,true)}}),b);c.addSeparator(b)})));this.put("navigation",new Menu(mxUtils.bind(this,function(c,b){this.addMenuItems(c,["home","-","exitGroup","enterGroup","-","expand","collapse"],b)})));this.put("arrange",new Menu(mxUtils.bind(this,function(c,b){this.addSubmenu("direction",c,b);this.addSubmenu("layout",c,b);this.addSubmenu("align",c,b);c.addSeparator(b);this.addSubmenu("navigation",c,b);this.addMenuItems(c,["-","autosize","rotate"],b)})));this.put("view",new Menu(mxUtils.bind(this,function(f,c){this.addMenuItems(f,["actualSize"],c);f.addSeparator();var d=[0.25,0.5,0.75,1,2,4];for(var b=0;b<d.length;b++){(function(g){f.addItem((g*100)+"%",null,function(){a.zoomTo(g)},c)})(d[b])}this.addMenuItems(f,["-","zoomIn","zoomOut","-","fitWindow","customZoom","-","fitPage","fitPageWidth"],c)})));this.put("file",new Menu(mxUtils.bind(this,function(c,b){this.addMenuItems(c,["new","open","-","save","saveAs","-","export","-","import","editFile","-","pageSetup","print"],b)})));this.put("edit",new Menu(mxUtils.bind(this,function(c,b){this.addMenuItems(c,["undo","redo","-","cut","copy","paste","delete","-","duplicate","-","editLink","openLink","-","selectVertices","selectEdges","selectAll","-","setAsDefaultEdge"])})));this.put("options",new Menu(mxUtils.bind(this,function(c,b){this.addMenuItems(c,["grid","guides","tooltips","-","connect","navigation","scrollbars","-","pageView","-","pageBackgroundColor"])})));this.put("help",new Menu(mxUtils.bind(this,function(c,b){this.addMenuItems(c,["help","-","about"])})))};Menus.prototype.put=function(a,b){this.menus[a]=b};Menus.prototype.get=function(a){return this.menus[a]};Menus.prototype.addSubmenu=function(b,f,d){var a=this.get(b).enabled;if(f.showDisabled||a){var c=f.addItem(mxResources.get(b),null,null,d,null,a);this.addMenu(b,f,c)}};Menus.prototype.addMenu=function(b,a,c){var d=this.get(b);if(d!=null&&(a.showDisabled||d.enabled)){this.get(b).execute(a,c)}};Menus.prototype.styleChange=function(g,b,f,a,c,d){return g.addItem(b,null,mxUtils.bind(this,function(){var k=this.editorUi.editor.graph;k.getModel().beginUpdate();try{for(var j=0;j<f.length;j++){k.setCellStyles(f[j],a[j])}}finally{k.getModel().endUpdate()}}),d,c)};Menus.prototype.promptChange=function(i,c,g,a,d,f,b){return i.addItem(c,null,mxUtils.bind(this,function(){var l=this.editorUi.editor.graph;var k=a;var j=l.getView().getState(l.getSelectionCell());if(j!=null){k=j.style[d]||k}k=mxUtils.prompt(mxResources.get("enterValue")+((g.length>0)?(" "+g):""),k);if(k!=null&&k.length>0){l.setCellStyles(d,k)}}),f,null,b)};Menus.prototype.pickColor=function(b){if(this.colorDialog==null){this.colorDialog=new ColorDialog(this.editorUi)}this.colorDialog.currentColorKey=b;var d=this.editorUi.editor.graph;var c=d.getView().getState(d.getSelectionCell());var a="none";if(c!=null){a=c.style[b]||a}if(a=="none"){a="ffffff";this.colorDialog.picker.fromString("ffffff");this.colorDialog.colorInput.value="none"}else{this.colorDialog.picker.fromString(a)}this.editorUi.showDialog(this.colorDialog.container,220,360,true,false);if(!mxClient.IS_TOUCH){this.colorDialog.colorInput.focus()}};Menus.prototype.addMenuItem=function(f,a,b){var d=this.editorUi.actions.get(a);if(d!=null&&(f.showDisabled||d.enabled)){var c=f.addItem(d.label,null,d.funct,b,null,d.enabled);if(d.toggleAction&&d.isSelected()){this.addCheckmark(c)}this.addShortcut(c,d);return c}return null};Menus.prototype.addShortcut=function(b,c){if(c.shortcut!=null){var d=b.firstChild.nextSibling.nextSibling;var a=document.createElement("span");a.style.color="gray";mxUtils.write(a,c.shortcut);d.appendChild(a)}};Menus.prototype.addCheckmark=function(a){var b=a.firstChild.nextSibling;b.style.backgroundImage="url("+IMAGE_PATH+"/checkmark.gif)";b.style.backgroundRepeat="no-repeat";b.style.backgroundPosition="2px 50%";b.style.width="20px"};Menus.prototype.addMenuItems=function(d,c,b){for(var a=0;a<c.length;a++){if(c[a]=="-"){d.addSeparator(b)}else{this.addMenuItem(d,c[a],b)}}};Menus.prototype.createPopupMenu=function(d,a,b){var c=this.editorUi.editor.graph;d.smartSeparators=true;if(c.isSelectionEmpty()){this.addMenuItems(d,["undo","redo","-","paste","-"])}else{this.addMenuItems(d,["delete","-","duplicate","-"])}if(c.getSelectionCount()>0){this.addSubmenu("linewidth",d);if(c.getModel().isEdge(c.getSelectionCell())){this.addSubmenu("line",d);d.addSeparator();this.addSubmenu("linestart",d);this.addSubmenu("lineend",d);d.addSeparator();this.addMenuItems(d,["setAsDefaultEdge"])}else{if(c.getSelectionCount()>1){}else{d.addSeparator();this.addSubmenu("layout",d)}}d.addSeparator();if(c.getSelectionCount()==1){}}else{this.addMenuItems(d,["-","selectVertices","selectEdges","-","selectAll"])}};Menus.prototype.createMenubar=function(a){var b=new Menubar(this.editorUi,a);return b};function Menubar(b,a){this.editorUi=b;this.container=a;var c=(mxClient.IS_TOUCH)?"touchstart":"mousedown";mxEvent.addListener(document,c,mxUtils.bind(this,function(d){this.hideMenu()}))}Menubar.prototype.hideMenu=function(){if(this.currentMenu!=null){this.currentMenu.hideMenu()}};Menubar.prototype.addMenu=function(c,a){var b=document.createElement("a");b.setAttribute("href","javascript:void(0);");b.className="geItem";mxUtils.write(b,c);this.addMenuHandler(b,a);this.container.appendChild(b);return b};Menubar.prototype.addMenuHandler=function(c,b){if(b!=null){var a=true;var d=mxUtils.bind(this,function(f){if(a&&c.enabled==null||c.enabled){this.editorUi.editor.graph.panningHandler.hideMenu();var g=new mxPopupMenu(b);g.div.className+=" geMenubarMenu";g.smartSeparators=true;g.showDisabled=true;g.autoExpand=true;g.hideMenu=mxUtils.bind(this,function(){mxPopupMenu.prototype.hideMenu.apply(g,arguments);g.destroy();this.currentMenu=null;this.currentElt=null});g.popup(c.offsetLeft+4,c.offsetTop+c.offsetHeight+4,null,f);this.currentMenu=g;this.currentElt=c}a=true;mxEvent.consume(f)});mxEvent.addListener(c,"mousemove",mxUtils.bind(this,function(f){if(this.currentMenu!=null&&this.currentElt!=c){this.hideMenu();d(f)}}));mxEvent.addListener(c,"mousedown",mxUtils.bind(this,function(){a=this.currentElt!=c}));mxEvent.addListener(c,"click",d)}};function Menu(a,b){mxEventSource.call(this);this.funct=a;this.enabled=(b!=null)?b:true}mxUtils.extend(Menu,mxEventSource);Menu.prototype.setEnabled=function(a){if(this.enabled!=a){this.enabled=a;this.fireEvent(new mxEventObject("stateChanged"))}};Menu.prototype.execute=function(b,a){this.funct(b,a)};(function(){function q(){}q.prototype=new mxCylinder();q.prototype.constructor=q;q.prototype.size=20;q.prototype.redrawPath=function(I,D,J,E,H,F){var G=Math.min(E,Math.min(H,mxUtils.getValue(this.style,"size",this.size)*this.scale));if(F){I.moveTo(G,H);I.lineTo(G,G);I.lineTo(0,0);I.moveTo(G,G);I.lineTo(E,G);I.end()}else{I.moveTo(0,0);I.lineTo(E-G,0);I.lineTo(E,G);I.lineTo(E,H);I.lineTo(G,H);I.lineTo(0,H-G);I.lineTo(0,0);I.close();I.end()}};mxCellRenderer.prototype.defaultShapes.cube=q;function t(){}t.prototype=new mxCylinder();t.prototype.constructor=t;t.prototype.size=30;t.prototype.redrawPath=function(I,D,J,E,H,F){var G=Math.min(E,Math.min(H,mxUtils.getValue(this.style,"size",this.size)*this.scale));if(F){I.moveTo(E-G,0);I.lineTo(E-G,G);I.lineTo(E,G);I.end()}else{I.moveTo(0,0);I.lineTo(E-G,0);I.lineTo(E,G);I.lineTo(E,H);I.lineTo(0,H);I.lineTo(0,0);I.close();I.end()}};mxCellRenderer.prototype.defaultShapes.note=t;function o(){}o.prototype=new mxCylinder();o.prototype.constructor=o;o.prototype.tabWidth=60;o.prototype.tabHeight=20;o.prototype.tabPosition="right";o.prototype.redrawPath=function(N,J,H,K,F,E){var G=mxUtils.getValue(this.style,"tabWidth",this.tabWidth);var D=mxUtils.getValue(this.style,"tabHeight",this.tabHeight);var I=mxUtils.getValue(this.style,"tabPosition",this.tabPosition);var M=Math.min(K,G*this.scale);var L=Math.min(F,D*this.scale);if(E){if(I=="left"){N.moveTo(0,L);N.lineTo(M,L)}else{N.moveTo(K-M,L);N.lineTo(K,L)}N.end()}else{if(I=="left"){N.moveTo(0,0);N.lineTo(M,0);N.lineTo(M,L);N.lineTo(K,L)}else{N.moveTo(0,L);N.lineTo(K-M,L);N.lineTo(K-M,0);N.lineTo(K,0)}N.lineTo(K,F);N.lineTo(0,F);N.lineTo(0,L);N.close();N.end()}};mxCellRenderer.prototype.defaultShapes.folder=o;function l(){}l.prototype=new mxCylinder();l.prototype.constructor=l;l.prototype.size=30;l.prototype.redrawPath=function(I,D,J,E,H,F){var G=Math.min(E,Math.min(H,mxUtils.getValue(this.style,"size",this.size)*this.scale));if(!F){I.moveTo(G,0);I.lineTo(E,0);I.lineTo(E,H);I.lineTo(0,H);I.lineTo(0,G);I.lineTo(G,0);I.close();I.end()}};mxCellRenderer.prototype.defaultShapes.card=l;function v(){}v.prototype=new mxCylinder();v.prototype.constructor=v;v.prototype.size=0.4;v.prototype.redrawPath=function(K,H,G,I,F,E){var L=mxUtils.getValue(this.style,"size",this.size);var J=F*L;var D=1.4;if(!E){K.moveTo(0,J/2);K.quadTo(I/4,J*D,I/2,J/2);K.quadTo(I*3/4,J*(1-D),I,J/2);K.lineTo(I,F-J/2);K.quadTo(I*3/4,F-J*D,I/2,F-J/2);K.quadTo(I/4,F-J*(1-D),0,F-J/2);K.lineTo(0,J/2);K.close();K.end()}};mxCellRenderer.prototype.defaultShapes.tape=v;function B(){}B.prototype=new mxCylinder();B.prototype.constructor=B;B.prototype.size=0.2;B.prototype.redrawPath=function(I,D,J,E,H,F){var G=E*mxUtils.getValue(this.style,"size",this.size);if(!F){I.moveTo(0,0);I.lineTo(E-G,0);I.lineTo(E,H/2);I.lineTo(E-G,H);I.lineTo(0,H);I.lineTo(G,H/2);I.close();I.end()}};mxCellRenderer.prototype.defaultShapes.step=B;function x(){}x.prototype=new mxCylinder();x.prototype.constructor=x;x.prototype.redrawPath=function(I,D,J,E,H,G){var F=Math.min(E/5,H/5)+1;if(G){I.moveTo(E/2,F);I.lineTo(E/2,H-F);I.moveTo(F,H/2);I.lineTo(E-F,H/2);I.end()}else{I.moveTo(0,0);I.lineTo(E,0);I.lineTo(E,H);I.lineTo(0,H);I.close()}};mxCellRenderer.prototype.defaultShapes.plus=x;function s(){}s.prototype=new mxCylinder();s.prototype.constructor=s;s.prototype.redrawPath=function(H,D,I,E,G,F){if(F){H.moveTo(0,0);H.lineTo(E/2,G/2);H.lineTo(E,0);H.end()}else{H.moveTo(0,0);H.lineTo(E,0);H.lineTo(E,G);H.lineTo(0,G);H.close()}};mxCellRenderer.prototype.defaultShapes.message=s;function j(){}j.prototype=new mxCylinder();j.prototype.constructor=j;j.prototype.addPipe=true;j.prototype.redrawPath=function(J,E,K,F,I,G){var H=F/3;var D=I/4;if(!G){J.moveTo(F/2,D);J.curveTo(F/2-H,D,F/2-H,0,F/2,0);J.curveTo(F/2+H,0,F/2+H,D,F/2,D);J.close();J.moveTo(F/2,D);J.lineTo(F/2,2*I/3);J.moveTo(F/2,I/3);J.lineTo(0,I/3);J.moveTo(F/2,I/3);J.lineTo(F,I/3);J.moveTo(F/2,2*I/3);J.lineTo(0,I);J.moveTo(F/2,2*I/3);J.lineTo(F,I);J.end()}};mxCellRenderer.prototype.defaultShapes.umlActor=j;function y(){}y.prototype=new mxCylinder();y.prototype.constructor=y;y.prototype.size=10;y.prototype.addPipe=true;y.prototype.redrawPath=function(K,H,G,I,F,E){var L=this.scale*mxUtils.getValue(this.style,"size",this.size);var D=L*2/3;var J=L;if(!E){K.moveTo(I/2,J);K.curveTo(I/2-D,J,I/2-D,0,I/2,0);K.curveTo(I/2+D,0,I/2+D,J,I/2,J);K.close();K.moveTo(I/2,J);K.lineTo(I/2,F);K.end()}};mxCellRenderer.prototype.defaultShapes.lollipop=y;function c(){}c.prototype=new mxCylinder();c.prototype.constructor=c;c.prototype.jettyWidth=32;c.prototype.jettyHeight=12;c.prototype.redrawPath=function(Q,K,I,M,G,F){var O=mxUtils.getValue(this.style,"jettyWidth",this.jettyWidth);var H=mxUtils.getValue(this.style,"jettyHeight",this.jettyHeight);var P=O*this.scale;var N=H*this.scale;var E=P/2;var D=E+P/2;var L=0.3*G-N/2;var J=0.7*G-N/2;if(F){Q.moveTo(E,L);Q.lineTo(D,L);Q.lineTo(D,L+N);Q.lineTo(E,L+N);Q.moveTo(E,J);Q.lineTo(D,J);Q.lineTo(D,J+N);Q.lineTo(E,J+N);Q.end()}else{Q.moveTo(E,0);Q.lineTo(M,0);Q.lineTo(M,G);Q.lineTo(E,G);Q.lineTo(E,J+N);Q.lineTo(0,J+N);Q.lineTo(0,J);Q.lineTo(E,J);Q.lineTo(E,L+N);Q.lineTo(0,L+N);Q.lineTo(0,L);Q.lineTo(E,L);Q.close();Q.end()}};mxCellRenderer.prototype.defaultShapes.component=c;function n(){}n.prototype=new mxDoubleEllipse();n.prototype.constructor=n;n.prototype.outerStroke=true;n.prototype.createSvg=function(){var D=mxDoubleEllipse.prototype.createSvg.apply(this,arguments);this.foreground.setAttribute("fill",this.innerNode.getAttribute("fill"));this.foreground.setAttribute("stroke",this.stroke);this.innerNode.setAttribute("fill","none");this.innerNode.setAttribute("stroke",(this.outerStroke)?this.stroke:"none");return D};n.prototype.redrawSvg=function(){mxDoubleEllipse.prototype.redrawSvg.apply(this,arguments);this.innerNode.setAttribute("fill","none");if(this.shadowNode!=null){this.shadowNode.setAttribute("cx",this.foreground.getAttribute("cx"));this.shadowNode.setAttribute("cy",this.foreground.getAttribute("cy"));this.shadowNode.setAttribute("rx",this.foreground.getAttribute("rx"));this.shadowNode.setAttribute("ry",this.foreground.getAttribute("ry"))}};n.prototype.createVml=function(){var D=mxDoubleEllipse.prototype.createVml.apply(this,arguments);if(this.fillNode!=null){this.foreground.appendChild(this.fillNode);this.foreground.filled="true"}this.background.filled="false";this.background.stroked=(this.outerStroke)?"true":"false";if(this.shadowNode!=null){this.foreground.appendChild(this.shadowNode)}return D};n.prototype.reconfigure=function(){mxShape.prototype.reconfigure.apply(this,arguments);if(this.dialect==mxConstants.DIALECT_SVG){this.innerNode.setAttribute("fill","none")}else{if(mxUtils.isVml(this.node)){this.background.filled="false"}}};mxCellRenderer.prototype.defaultShapes.endState=n;function m(){}m.prototype=new n();m.prototype.constructor=m;m.prototype.outerStroke=false;mxCellRenderer.prototype.defaultShapes.startState=m;var u=mxImageExport.prototype.initShapes;mxImageExport.prototype.initShapes=function(){u.apply(this,arguments);function D(E){return{drawShape:function(I,G,F,H){var L=F.x;var K=F.y;var M=F.width;var J=F.height;if(H){var N=Math.min(4,Math.min(M/5,J/5));L+=N;K+=N;M-=2*N;J-=2*N;if(M>0&&J>0){I.ellipse(L,K,M,J)}return true}else{I.fillAndStroke();if(E){I.ellipse(L,K,M,J);I.stroke()}}}}}this.shapes.endState=D(true);this.shapes.startState=D(false)};function g(){}g.prototype=new mxArrow();g.prototype.constructor=g;g.prototype.enableFill=false;g.prototype.addPipe=true;g.prototype.augmentBoundingBox=function(D){D.grow(10*this.scale);mxShape.prototype.augmentBoundingBox.apply(this,arguments)};g.prototype.redrawPath=function(U,Q,O,S,ab){U.translate.x-=Q;U.translate.y-=O;var W=10*this.scale;var F=this.points[0];var ae=this.points[this.points.length-1];var T=ae.x-F.x;var R=ae.y-F.y;var V=Math.sqrt(T*T+R*R);var G=V;var ad=T/V;var ac=R/V;var K=G*ad;var J=G*ac;var I=W*ac/3;var H=-W*ad/3;var Z=F.x-I/2;var X=F.y-H/2;var E=Z+I;var D=X+H;var N=E+K;var L=D+J;var aa=N+I;var Y=L+H;var P=aa-3*I;var M=Y-3*H;U.moveTo(E,D);U.lineTo(N,L);U.moveTo(P+I,M+H);U.lineTo(Z,X);U.end()};mxCellRenderer.prototype.defaultShapes.link=g;mxMarker.markers.dash=function(D,I,H,G,F,K,L,E,J){G=G*(L+K);F=F*(L+K);if(J){D.setAttribute("path","m"+Math.floor(H.x-G/2-F/2)+" "+Math.floor(H.y-F/2+G/2)+" l "+Math.floor(H.x+F/2-3*G/2)+" "+Math.floor(H.y-3*F/2-G/2)+" e")}else{D.setAttribute("d","M "+(H.x-G/2-F/2)+" "+(H.y-F/2+G/2)+" L "+(H.x+F/2-3*G/2)+" "+(H.y-3*F/2-G/2)+" z")}return new mxPoint(0,0)};var k=mxImageExport.prototype.initMarkers;mxImageExport.prototype.initMarkers=function(){k.apply(this,arguments);this.markers.dash=function(F,E,H,G,J,I,L,D,K){nx=J*(L+K);ny=I*(L+K);F.begin();F.moveTo(G.x-nx/2-ny/2,G.y-ny/2+nx/2);F.lineTo(G.x+ny/2-3*nx/2,G.y-3*ny/2-nx/2);F.stroke();return new mxPoint(0,0)}};mxShape.prototype.crisp=true;mxShape.prototype.roundedCrispSvg=false;mxActor.prototype.crisp=false;mxCylinder.prototype.crisp=false;mxEllipse.prototype.crisp=false;mxDoubleEllipse.prototype.crisp=false;mxConnector.prototype.crisp=false;o.prototype.crisp=true;c.prototype.crisp=true;var p=-99;if(typeof(mxVertexHandler)!="undefined"){function i(D){mxVertexHandler.call(this,D)}mxUtils.extend(i,mxVertexHandler);i.prototype.useGridForSpecialHandle=false;i.prototype.init=function(){this.horizontal=mxUtils.getValue(this.state.style,mxConstants.STYLE_HORIZONTAL,true);var F=this.state.view.graph;if(this.handleImage!=null){var E=new mxRectangle(0,0,this.handleImage.width,this.handleImage.height);this.specialHandle=new mxImageShape(E,this.handleImage.src)}else{var D=10;var E=new mxRectangle(0,0,D,D);this.specialHandle=new mxRhombus(E,mxConstants.HANDLE_FILLCOLOR,mxConstants.HANDLE_STROKECOLOR);this.specialHandle.crisp=this.crisp}this.specialHandle.dialect=(F.dialect!=mxConstants.DIALECT_SVG)?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG;this.specialHandle.init(F.getView().getOverlayPane());this.specialHandle.node.style.cursor=this.getSpecialHandleCursor();mxEvent.redirectMouseEvents(this.specialHandle.node,F,this.state);mxVertexHandler.prototype.init.apply(this,arguments)};i.prototype.getSpecialHandleCursor=function(){return(this.horizontal)?"n-resize":"w-resize"};i.prototype.redraw=function(){mxVertexHandler.prototype.redraw.apply(this,arguments);var D=this.specialHandle.bounds.width;this.specialHandle.bounds=this.getSpecialHandleBounds(D);this.specialHandle.redraw()};i.prototype.getSpecialHandleBounds=function(D){var E=this.graph.getView().scale;var F=this.state.view.graph.getStartSize(this.state.cell);if(this.horizontal){return new mxRectangle(this.state.x+(this.state.width-D)/2,this.state.y+F.height*E-D/2,D,D)}else{return new mxRectangle(this.state.x+F.width*E-D/2,this.state.y+(this.state.height-D)/2,D,D)}};i.prototype.destroy=function(){mxVertexHandler.prototype.destroy.apply(this,arguments);if(this.specialHandle!=null){this.specialHandle.destroy();this.specialHandle=null}};i.prototype.getHandleForEvent=function(D){if(D.isSource(this.specialHandle)){return p}return mxVertexHandler.prototype.getHandleForEvent.apply(this,arguments)};i.prototype.constrainPoint=function(D){D.x=Math.max(this.state.x,Math.min(this.state.x+this.state.width,D.x));D.y=Math.max(this.state.y,Math.min(this.state.y+this.state.height,D.y))};i.prototype.mouseMove=function(E,F){if(!F.isConsumed()&&this.index==p){var D=new mxPoint(F.getGraphX(),F.getGraphY());this.constrainPoint(D);var G=this.graph.isGridEnabledEvent(F.getEvent());var H=this.graph.getView().scale;if(G&&this.useGridForSpecialHandle){D.x=this.graph.snap(D.x/H)*H;D.y=this.graph.snap(D.y/H)*H}this.updateStyle(D);this.moveSizerTo(this.specialHandle,D.x,D.y);this.state.view.graph.cellRenderer.redraw(this.state,true);F.consume()}else{mxVertexHandler.prototype.mouseMove.apply(this,arguments)}};i.prototype.updateStyle=function(D){var E=0;if(this.horizontal){D.x=this.state.x+this.state.width/2;E=D.y-this.state.y}else{D.y=this.state.y+this.state.height/2;E=D.x-this.state.x}var F=this.graph.getView().scale;this.state.style.startSize=Math.round(Math.max(1,E)/F)};i.prototype.mouseUp=function(D,E){if(!E.isConsumed()&&this.index==p){this.applyStyle();this.reset();E.consume()}else{mxVertexHandler.prototype.mouseUp.apply(this,arguments)}};i.prototype.applyStyle=function(){this.state.view.graph.setCellStyles("startSize",this.state.style.startSize,[this.state.cell])};function z(D){i.call(this,D)}mxUtils.extend(z,i);z.prototype.getSpecialHandleCursor=function(){return"default"};z.prototype.getSpecialHandleBounds=function(L){var J=Number(this.state.style[mxConstants.STYLE_ROTATION]||"0");var H=mxUtils.getValue(this.state.style,"direction","east");if(H!=null){if(H=="north"){J+=270}else{if(H=="west"){J+=180}else{if(H=="south"){J+=90}}}}var E=mxUtils.toRadians(J);var I=Math.cos(E);var G=Math.sin(E);var D=new mxRectangle(this.state.x,this.state.y,this.state.width,this.state.height);if(H=="south"||H=="north"){D.x+=(D.width-D.height)/2;D.y+=(D.height-D.width)/2;var F=D.width;D.width=D.height;D.height=F}var K=this.getSpecialHandlePoint(D);K=mxUtils.getRotatedPoint(K,I,G,new mxPoint(this.state.getCenterX(),this.state.getCenterY()));return new mxRectangle(K.x-L/2,K.y-L/2,L,L)};z.prototype.getSpecialHandlePoint=function(G){var I=this.graph.getView().scale;var E=Math.min(G.width,mxUtils.getValue(this.state.style,"tabWidth",60)*I);var F=Math.min(G.height,mxUtils.getValue(this.state.style,"tabHeight",20)*I);var H=mxUtils.getValue(this.state.style,"tabPosition","right");var D=(H=="left")?G.x+E:G.x+G.width-E;return new mxPoint(D,G.y+F)};z.prototype.updateStyle=function(I){var H=mxUtils.getValue(this.state.style,"direction","east");var K=Number(this.state.style[mxConstants.STYLE_ROTATION]||"0");if(H!=null){if(H=="north"){K+=270}else{if(H=="west"){K+=180}else{if(H=="south"){K+=90}}}}var E=mxUtils.toRadians(K);var J=Math.cos(-E);var G=Math.sin(-E);var D=new mxRectangle(this.state.x,this.state.y,this.state.width,this.state.height);if(H=="south"||H=="north"){D.x+=(D.width-D.height)/2;D.y+=(D.height-D.width)/2;var F=D.width;D.width=D.height;D.height=F}var M=new mxPoint(I.x,I.y);M=mxUtils.getRotatedPoint(M,J,G,new mxPoint(this.state.getCenterX(),this.state.getCenterY()));var L=this.updateStyleUnrotated(M,D);if(L!=null){J=Math.cos(E);G=Math.sin(E);L=mxUtils.getRotatedPoint(L,J,G,new mxPoint(this.state.getCenterX(),this.state.getCenterY()));I.x=L.x;I.y=L.y}};z.prototype.updateStyleUnrotated=function(G,F){var I=mxUtils.getValue(this.state.style,"tabPosition","right");var D=(I=="left")?G.x-F.x:F.x+F.width-G.x;var E=G.y-F.y;var H=this.graph.getView().scale;this.state.style.tabWidth=Math.round(Math.max(1,D)/H);this.state.style.tabHeight=Math.round(Math.max(1,E)/H)};z.prototype.applyStyle=function(){var D=this.graph.getModel();D.beginUpdate();try{this.state.view.graph.setCellStyles("tabWidth",this.state.style.tabWidth,[this.state.cell]);this.state.view.graph.setCellStyles("tabHeight",this.state.style.tabHeight,[this.state.cell])}finally{D.endUpdate()}};function b(D){z.call(this,D)}mxUtils.extend(b,z);b.prototype.defaultValue=20;b.prototype.scaleFactor=1;b.prototype.getSpecialHandlePoint=function(D){var F=this.graph.getView().scale;var E=Math.min(D.width,Math.min(D.height,mxUtils.getValue(this.state.style,"size",this.defaultValue)*F/this.scaleFactor));return new mxPoint(D.x+E,D.y+E)};b.prototype.updateStyleUnrotated=function(F,E){var D=Math.min(Math.min(E.width/this.scaleFactor,F.x-E.x),Math.min(E.height/this.scaleFactor,F.y-E.y));var G=this.graph.getView().scale;this.state.style.size=Math.round(Math.max(1,D)/G)*this.scaleFactor;return new mxPoint(E.x+D,E.y+D)};b.prototype.applyStyle=function(){this.state.view.graph.setCellStyles("size",this.state.style.size,[this.state.cell])};function d(D){b.call(this,D)}mxUtils.extend(d,b);d.prototype.defaultValue=30;d.prototype.scaleFactor=2;function C(D){b.call(this,D)}mxUtils.extend(C,b);C.prototype.defaultValue=30;C.prototype.scaleFactor=1;C.prototype.getSpecialHandlePoint=function(D){var F=this.graph.getView().scale;var E=Math.min(D.width,Math.min(D.height,mxUtils.getValue(this.state.style,"size",this.defaultValue)*F/this.scaleFactor));return new mxPoint(D.x+D.width-E,D.y+E)};C.prototype.updateStyleUnrotated=function(F,E){var D=Math.min(Math.min(E.width/this.scaleFactor,F.x-E.x+E.width),Math.min(E.height/this.scaleFactor,F.y-E.y));var G=this.graph.getView().scale;this.state.style.size=Math.round(Math.max(1,D)/G)*this.scaleFactor;return new mxPoint(E.x+E.width-D,E.y+D)};function a(D){b.call(this,D)}mxUtils.extend(a,b);a.prototype.defaultValue=0.2;a.prototype.scaleFactor=1;a.prototype.getSpecialHandlePoint=function(D){var E=mxUtils.getValue(this.state.style,"size",this.defaultValue);return new mxPoint(D.x+D.width*E,D.y+D.height/2)};a.prototype.updateStyleUnrotated=function(F,E){var D=Math.min(1,(F.x-E.x)/E.width);this.state.style.size=D;return new mxPoint(E.x+D*E.width,E.y+E.height/2)};function A(D){b.call(this,D)}mxUtils.extend(A,b);A.prototype.defaultValue=0.4;A.prototype.scaleFactor=1;A.prototype.getSpecialHandlePoint=function(D){var E=mxUtils.getValue(this.state.style,"size",this.defaultValue);return new mxPoint(D.x+D.width/2,D.y+E*D.height/2)};A.prototype.updateStyleUnrotated=function(F,E){var D=Math.min(1,((F.y-E.y)/E.height)*2);this.state.style.size=D;return new mxPoint(E.x+E.width/2,E.y+D*E.height/2)};var r={swimlane:i,folder:z,cube:b,card:d,note:C,step:a,tape:A};var f=mxGraph.prototype.createHandler;mxGraph.prototype.createHandler=function(E){if(E!=null){var D=r[E.style.shape];if(D!=null){return new D(E)}}return f.apply(this,arguments)}}mxGraph.prototype.getAllConnectionConstraints=function(D,E){if(D!=null&&D.shape!=null){if(D.shape instanceof mxStencilShape){if(D.shape.stencil!=null){return D.shape.stencil.constraints}}else{if(D.shape.constraints!=null){return D.shape.constraints}}}return null};mxRectangleShape.prototype.constraints=[new mxConnectionConstraint(new mxPoint(0.5,0),true),new mxConnectionConstraint(new mxPoint(0,0.5),true),new mxConnectionConstraint(new mxPoint(1,0.5),true),new mxConnectionConstraint(new mxPoint(0.5,1),true)];mxLabel.prototype.constraints=mxRectangleShape.prototype.constraints;mxImageShape.prototype.constraints=mxRectangleShape.prototype.constraints;mxSwimlane.prototype.constraints=mxRectangleShape.prototype.constraints;x.prototype.constraints=mxRectangleShape.prototype.constraints;t.prototype.constraints=mxRectangleShape.prototype.constraints;l.prototype.constraints=mxRectangleShape.prototype.constraints;q.prototype.constraints=mxRectangleShape.prototype.constraints;o.prototype.constraints=mxRectangleShape.prototype.constraints;mxCylinder.prototype.constraints=[new mxConnectionConstraint(new mxPoint(0.5,0),true),new mxConnectionConstraint(new mxPoint(0,0.5),true),new mxConnectionConstraint(new mxPoint(1,0.5),true),new mxConnectionConstraint(new mxPoint(0.5,1),true)];j.prototype.constraints=[new mxConnectionConstraint(new mxPoint(0.25,0),true),new mxConnectionConstraint(new mxPoint(0.5,0),true),new mxConnectionConstraint(new mxPoint(0.75,0),true),new mxConnectionConstraint(new mxPoint(0,0.25),true),new mxConnectionConstraint(new mxPoint(0,0.5),true),new mxConnectionConstraint(new mxPoint(0,0.75),true),new mxConnectionConstraint(new mxPoint(1,0.25),true),new mxConnectionConstraint(new mxPoint(1,0.5),true),new mxConnectionConstraint(new mxPoint(1,0.75),true),new mxConnectionConstraint(new mxPoint(0.25,1),true),new mxConnectionConstraint(new mxPoint(0.5,1),true),new mxConnectionConstraint(new mxPoint(0.75,1),true)];c.prototype.constraints=[new mxConnectionConstraint(new mxPoint(0.5,0),true),new mxConnectionConstraint(new mxPoint(0,0.5),true),new mxConnectionConstraint(new mxPoint(1,0.5),true),new mxConnectionConstraint(new mxPoint(0.5,1),true)];mxActor.prototype.constraints=[new mxConnectionConstraint(new mxPoint(0.5,0),true),new mxConnectionConstraint(new mxPoint(0.25,0.2),false),new mxConnectionConstraint(new mxPoint(0.1,0.5),false),new mxConnectionConstraint(new mxPoint(0,0.75),true),new mxConnectionConstraint(new mxPoint(0.75,0.25),false),new mxConnectionConstraint(new mxPoint(0.9,0.5),false),new mxConnectionConstraint(new mxPoint(1,0.75),true),new mxConnectionConstraint(new mxPoint(0.25,1),true),new mxConnectionConstraint(new mxPoint(0.5,1),true),new mxConnectionConstraint(new mxPoint(0.75,1),true)];v.prototype.constraints=[new mxConnectionConstraint(new mxPoint(0,0.35),false),new mxConnectionConstraint(new mxPoint(0,0.5),false),new mxConnectionConstraint(new mxPoint(0,0.65),false),new mxConnectionConstraint(new mxPoint(1,0.35),false),new mxConnectionConstraint(new mxPoint(1,0.5),false),new mxConnectionConstraint(new mxPoint(1,0.65),false),new mxConnectionConstraint(new mxPoint(0.25,1),false),new mxConnectionConstraint(new mxPoint(0.75,0),false)];B.prototype.constraints=[new mxConnectionConstraint(new mxPoint(0.25,0),true),new mxConnectionConstraint(new mxPoint(0.5,0),true),new mxConnectionConstraint(new mxPoint(0.75,0),true),new mxConnectionConstraint(new mxPoint(0.25,1),true),new mxConnectionConstraint(new mxPoint(0.5,1),true),new mxConnectionConstraint(new mxPoint(0.75,1),true),new mxConnectionConstraint(new mxPoint(0.1,0.25),false),new mxConnectionConstraint(new mxPoint(0.2,0.5),false),new mxConnectionConstraint(new mxPoint(0.1,0.75),false),new mxConnectionConstraint(new mxPoint(0.9,0.25),false),new mxConnectionConstraint(new mxPoint(1,0.5),false),new mxConnectionConstraint(new mxPoint(0.9,0.75),false)];mxLine.prototype.constraints=[new mxConnectionConstraint(new mxPoint(0,0.5),false),new mxConnectionConstraint(new mxPoint(0.25,0.5),false),new mxConnectionConstraint(new mxPoint(0.75,0.5),false),new mxConnectionConstraint(new mxPoint(1,0.5),false)];y.prototype.constraints=[new mxConnectionConstraint(new mxPoint(0.5,0),false),new mxConnectionConstraint(new mxPoint(0.5,1),false)];mxEllipse.prototype.constraints=[new mxConnectionConstraint(new mxPoint(0.5,0),true),new mxConnectionConstraint(new mxPoint(0.5,1),true),new mxConnectionConstraint(new mxPoint(0,0.5),true),new mxConnectionConstraint(new mxPoint(1,0.5))];mxDoubleEllipse.prototype.constraints=mxEllipse.prototype.constraints;mxRhombus.prototype.constraints=mxEllipse.prototype.constraints;mxTriangle.prototype.constraints=[new mxConnectionConstraint(new mxPoint(0,0.25),true),new mxConnectionConstraint(new mxPoint(0,0.5),true),new mxConnectionConstraint(new mxPoint(0,0.75),true),new mxConnectionConstraint(new mxPoint(0.5,0),true),new mxConnectionConstraint(new mxPoint(0.5,1),true),new mxConnectionConstraint(new mxPoint(1,0.5),true)];mxHexagon.prototype.constraints=[new mxConnectionConstraint(new mxPoint(0.375,0),true),new mxConnectionConstraint(new mxPoint(0.5,0),true),new mxConnectionConstraint(new mxPoint(0.625,0),true),new mxConnectionConstraint(new mxPoint(0.125,0.25),false),new mxConnectionConstraint(new mxPoint(0,0.5),true),new mxConnectionConstraint(new mxPoint(0.125,0.75),false),new mxConnectionConstraint(new mxPoint(0.875,0.25),false),new mxConnectionConstraint(new mxPoint(0,0.5),true),new mxConnectionConstraint(new mxPoint(1,0.5),true),new mxConnectionConstraint(new mxPoint(0.875,0.75),false),new mxConnectionConstraint(new mxPoint(0.375,1),true),new mxConnectionConstraint(new mxPoint(0.5,1),true),new mxConnectionConstraint(new mxPoint(0.625,1),true)];mxCloud.prototype.constraints=[new mxConnectionConstraint(new mxPoint(0.25,0.25),false),new mxConnectionConstraint(new mxPoint(0.4,0.1),false),new mxConnectionConstraint(new mxPoint(0.16,0.55),false),new mxConnectionConstraint(new mxPoint(0.07,0.4),false),new mxConnectionConstraint(new mxPoint(0.31,0.8),false),new mxConnectionConstraint(new mxPoint(0.13,0.77),false),new mxConnectionConstraint(new mxPoint(0.8,0.8),false),new mxConnectionConstraint(new mxPoint(0.55,0.95),false),new mxConnectionConstraint(new mxPoint(0.875,0.5),false),new mxConnectionConstraint(new mxPoint(0.96,0.7),false),new mxConnectionConstraint(new mxPoint(0.625,0.2),false),new mxConnectionConstraint(new mxPoint(0.88,0.25),false)];mxArrow.prototype.constraints=null})();function Sidebar(b,a){this.editorUi=b;this.container=a;this.palettes=new Object();this.showTooltips=true;this.graph=new Graph(document.createElement("div"),null,null,this.editorUi.editor.graph.getStylesheet());this.graph.foldingEnabled=false;this.graph.autoScroll=false;this.graph.setTooltips(false);this.graph.setConnectable(false);this.graph.resetViewOnRootChange=false;this.graph.view.setTranslate(this.thumbBorder,this.thumbBorder);this.graph.setEnabled(false);if(document.documentMode==8){document.body.appendChild(this.graph.container)}if(this.shiftThumbs){this.graph.view.canvas.setAttribute("transform","translate(1, 1)")}if(!mxClient.IS_TOUCH){mxEvent.addListener(document,"mouseup",mxUtils.bind(this,function(){this.showTooltips=true}));mxEvent.addListener(a,"scroll",mxUtils.bind(this,function(){this.showTooltips=true}));mxEvent.addListener(document,"mousedown",mxUtils.bind(this,function(){this.showTooltips=false;this.hideTooltip()}));mxEvent.addListener(document,"mousemove",mxUtils.bind(this,function(c){var d=mxEvent.getSource(c);while(d!=null){if(d==this.currentElt){return}d=d.parentNode}this.hideTooltip()}));mxEvent.addListener(document,"mouseout",mxUtils.bind(this,function(c){if(c.toElement==null&&c.relatedTarget==null){this.hideTooltip()}}))}this.init();new Image().src=IMAGE_PATH+"/tooltip.png"}Sidebar.prototype.init=function(){var a=STENCIL_PATH;this.addCOAPalette(a,false);this.addCOALinePalette(true);this.addOtherPalette(a,false)};Sidebar.prototype.enableTooltips=!mxClient.IS_TOUCH;Sidebar.prototype.shiftThumbs=mxClient.IS_SVG||document.documentMode==8;Sidebar.prototype.tooltipBorder=16;Sidebar.prototype.thumbBorder=2;Sidebar.prototype.tooltipDelay=300;Sidebar.prototype.installEdges=true;Sidebar.prototype.gearImage=STENCIL_PATH+"/clipart/Gear_128x128.png";Sidebar.prototype.thumbWidth=26;Sidebar.prototype.thumbHeight=26;function getTop(c){if(c==null){return null}var b=c;var a=b.offsetTop;while(b!=null&&b.offsetParent!=null&&b.offsetParent.tagName!="BODY"){a=a+b.offsetParent.offsetTop;b=b.offsetParent}return a}Sidebar.prototype.showTooltip=function(c,b){if(this.enableTooltips&&this.showTooltips){if(this.currentElt!=c){if(this.thread!=null){window.clearTimeout(this.thread);this.thread=null}var a=mxUtils.bind(this,function(){var f=mxText.prototype.getTableSize;if(this.graph.dialect!=mxConstants.DIALECT_SVG){mxText.prototype.getTableSize=function(o){var n=o.parentNode;document.body.appendChild(o);var m=new mxRectangle(0,0,o.offsetWidth,o.offsetHeight);n.appendChild(o);return m}}if(this.tooltip==null){this.tooltip=document.createElement("div");this.tooltip.className="geSidebarTooltip";document.body.appendChild(this.tooltip);this.graph2=new Graph(this.tooltip,null,null,this.editorUi.editor.graph.getStylesheet());this.graph2.view.setTranslate(this.tooltipBorder,this.tooltipBorder);this.graph2.resetViewOnRootChange=false;this.graph2.foldingEnabled=false;this.graph2.autoScroll=false;this.graph2.setTooltips(false);this.graph2.setConnectable(false);this.graph2.setEnabled(false);this.tooltipImage=mxUtils.createImage(IMAGE_PATH+"/tooltip.png");this.tooltipImage.style.position="absolute";this.tooltipImage.style.width="14px";this.tooltipImage.style.height="27px";document.body.appendChild(this.tooltipImage)}this.graph2.model.clear();this.graph2.addCells(b);var j=this.graph2.getGraphBounds();var i=j.x+j.width+this.tooltipBorder;var d=j.y+j.height+this.tooltipBorder;var l=this.container.clientWidth+this.editorUi.splitSize+3;var g=this.container.offsetTop+c.offsetTop-this.container.scrollTop-d/2+16;var k=Math.max(0,g);if(mxClient.IS_QUIRKS||mxClient.IS_IE7){i+=4;d+=4;g=getTop(c)-d/2+16;k=Math.max(0,g)}this.tooltip.style.display="block";this.tooltip.style.overflow="visible";this.tooltipImage.style.visibility="visible";this.tooltip.style.width=i+"px";this.tooltip.style.height=d+"px";this.tooltip.style.position="absolute";this.tooltip.style.left=l+"px";this.tooltip.style.top=k+"px";this.tooltipImage.style.left=(l-13)+"px";this.tooltipImage.style.top=(k+d/2-13)+"px";mxText.prototype.getTableSize=f});if(this.tooltip!=null&&this.tooltip.style.display!="none"){a()}else{this.thread=window.setTimeout(a,this.tooltipDelay)}this.currentElt=c}}};Sidebar.prototype.hideTooltip=function(){if(this.thread!=null){window.clearTimeout(this.thread);this.thread=null}if(this.tooltip!=null){this.tooltip.style.display="none";this.tooltipImage.style.visibility="hidden";this.currentElt=null}};Sidebar.prototype.addCOAPalette=function(a,b){this.addStencilPalette("COA",mxResources.get("coa"),a+"/coa.xml",";fillColor=#ffffc0;strokeColor=#000000;strokeWidth=2",[],function(j){var m=new mxCell("\u5f00\u59cb",new mxGeometry(0,0,70,50),"ellipse;shape=startState;fillColor=#E6FFCC;strokeColor=#4D9900;gradientColor=#FFFFFF");m.vertex=true;m.activityId=0;m.activityType=1;j.appendChild(this.createVertexTemplateFromCells([m],70,50));var c=new mxCell("\u7ed3\u675f",new mxGeometry(0,0,60,40),"ellipse;shape=endState;fillColor=#990000;strokeColor=#990000;gradientColor=#FF9999;fontColor=#FFFFFF");c.vertex=true;c.activityId=0;c.activityType=100;j.appendChild(this.createVertexTemplateFromCells([c],60,40));var i=new mxCell("\u6d3b\u52a8",new mxGeometry(0,0,80,40),"rounded=1;fillColor=#ffffc0;strokeColor=#000000;gradientColor=#FFFFFF");i.vertex=true;i.activityId=0;i.activityType=0;j.appendChild(this.createVertexTemplateFromCells([i],80,40));var k=new mxCell("\u865a\u62df\u6d3b\u52a8",new mxGeometry(0,0,80,40),"rhombus;fillColor=#ffffc0;strokeColor=#000000;gradientColor=#FFFFFF;dashed=1");k.vertex=true;k.activityId=0;k.activityType=2;j.appendChild(this.createVertexTemplateFromCells([k],80,40));var l=new mxCell("\u6761\u4ef6",new mxGeometry(0,0,0,0),"endArrow=block;endFill=1;endSize=6;");l.geometry.setTerminalPoint(new mxPoint(0,0),true);l.geometry.setTerminalPoint(new mxPoint(160,0),false);l.edge=true;l.activityId=0;l.activityType=4;j.appendChild(this.createEdgeTemplateFromCells([l],160,0));var d=new mxCell("\u6761\u4ef6",new mxGeometry(0,0,90,50),"rhombus;fillColor=#ffffc0;strokeColor=#000000;");d.vertex=true;d.activityId=0;d.activityType=3;var g=new mxCell("no",new mxGeometry(0,0,0,0),"edgeStyle=elbowEdgeStyle;elbow=horizontal;align=left;verticalAlign=bottom;endArrow=open;endSize=8;strokeColor=#000000;");g.geometry.setTerminalPoint(new mxPoint(160,25),false);g.geometry.relative=true;g.geometry.x=-1;g.edge=true;g.activityId=0;g.activityType=4;d.insertEdge(g,true);var f=new mxCell("yes",new mxGeometry(0,0,0,0),"edgeStyle=elbowEdgeStyle;elbow=horizontal;align=left;verticalAlign=top;endArrow=open;endSize=8;strokeColor=#000000;gradientColor=#000000");f.geometry.setTerminalPoint(new mxPoint(45,130),false);f.geometry.relative=true;f.geometry.x=-1;f.edge=true;f.activityId=0;f.activityType=4;d.insertEdge(f,true);j.appendChild(this.createVertexTemplateFromCells([d,g,f],90,50))})};Sidebar.prototype.addCOALinePalette=function(a){this.addPalette("COALine",mxResources.get("coaLine"),a||true,mxUtils.bind(this,function(b){b.appendChild(this.createEdgeTemplate("edgeStyle=none;",100,100));b.appendChild(this.createEdgeTemplate("edgeStyle=elbowEdgeStyle;elbow=vertical;",100,100))}))};Sidebar.prototype.addGeneralPalette=function(a){this.addPalette("general",mxResources.get("general"),a||true,mxUtils.bind(this,function(b){b.appendChild(this.createVertexTemplate("swimlane",200,200,"Container"));b.appendChild(this.createVertexTemplate("swimlane;horizontal=0",200,200,"Pool"));b.appendChild(this.createVertexTemplate('text;fontColor=#000000"',40,26,"Text"));b.appendChild(this.createVertexTemplate("icon;image="+this.gearImage,60,60,"Image"));b.appendChild(this.createVertexTemplate("label;image="+this.gearImage,140,60,"Label"));b.appendChild(this.createVertexTemplate(null,120,60));b.appendChild(this.createVertexTemplate("rounded=1",120,60));b.appendChild(this.createVertexTemplate("ellipse",80,80));b.appendChild(this.createVertexTemplate("ellipse;shape=doubleEllipse",80,80));b.appendChild(this.createVertexTemplate("triangle",60,80));b.appendChild(this.createVertexTemplate("rhombus",80,80));b.appendChild(this.createVertexTemplate("shape=hexagon",120,80));b.appendChild(this.createVertexTemplate("shape=actor;verticalLabelPosition=bottom;verticalAlign=top",40,60));b.appendChild(this.createVertexTemplate("ellipse;shape=cloud",120,80));b.appendChild(this.createVertexTemplate("shape=cylinder",60,80));b.appendChild(this.createVertexTemplate("line",160,10));b.appendChild(this.createVertexTemplate("line;direction=south",10,160));b.appendChild(this.createVertexTemplate("shape=xor",60,80));b.appendChild(this.createVertexTemplate("shape=or",60,80));b.appendChild(this.createVertexTemplate("shape=step",120,80));b.appendChild(this.createVertexTemplate("shape=tape",120,100));b.appendChild(this.createVertexTemplate("shape=cube",120,80));b.appendChild(this.createVertexTemplate("shape=note",80,100));b.appendChild(this.createVertexTemplate("shape=folder",120,120));b.appendChild(this.createVertexTemplate("shape=card",60,80));b.appendChild(this.createVertexTemplate("shape=plus",20,20));b.appendChild(this.createEdgeTemplate("edgeStyle=none;endArrow=none;",100,100));b.appendChild(this.createEdgeTemplate("edgeStyle=none",100,100));b.appendChild(this.createEdgeTemplate("edgeStyle=elbowEdgeStyle;elbow=horizontal",100,100));b.appendChild(this.createEdgeTemplate("edgeStyle=elbowEdgeStyle;elbow=vertical",100,100));b.appendChild(this.createEdgeTemplate("edgeStyle=entityRelationEdgeStyle",100,100));b.appendChild(this.createEdgeTemplate("edgeStyle=segmentEdgeStyle",100,100));b.appendChild(this.createEdgeTemplate("edgeStyle=orthogonalEdgeStyle",100,100));b.appendChild(this.createEdgeTemplate("shape=link",100,100));b.appendChild(this.createEdgeTemplate("arrow",100,100))}))};Sidebar.prototype.addOtherPalette=function(a,b){this.addStencilPalette("Other",mxResources.get("other"),a+"/other.xml",";fillColor=#ffffc0;strokeColor=#000000;strokeWidth=2",[],function(c){c.appendChild(this.createVertexTemplate("swimlane",200,200,"Container"));c.appendChild(this.createVertexTemplate("swimlane;horizontal=0",200,200,"Pool"));c.appendChild(this.createVertexTemplate("text",40,26,"Text"));c.appendChild(this.createVertexTemplate("ellipse;shape=cloud",120,80));c.appendChild(this.createVertexTemplate("shape=actor;verticalLabelPosition=bottom;verticalAlign=top;",40,60,"\u7528\u6237"))})};Sidebar.prototype.addUmlPalette=function(a){this.addPalette("uml","UML",a||false,mxUtils.bind(this,function(m){m.appendChild(this.createVertexTemplate("",110,50,"Object"));var k=new mxCell('<p style="margin:0px;margin-top:4px;text-align:center;"><b>Class</b></p><hr/><div style="height:2px;"></div><hr/>',new mxGeometry(0,0,140,60),"verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1");k.vertex=true;m.appendChild(this.createVertexTemplateFromCells([k],140,60));var k=new mxCell('<p style="margin:0px;margin-top:4px;text-align:center;"><b>Class</b></p><hr/><p style="margin:0px;margin-left:4px;">+ field: Type</p><hr/><p style="margin:0px;margin-left:4px;">+ method(): Type</p>',new mxGeometry(0,0,160,90),"verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1");k.vertex=true;m.appendChild(this.createVertexTemplateFromCells([k],160,90));var k=new mxCell('<p style="margin:0px;margin-top:4px;text-align:center;"><i>&lt;&lt;Interface&gt;&gt;</i><br/><b>Interface</b></p><hr/><p style="margin:0px;margin-left:4px;">+ field1: Type<br/>+ field2: Type</p><hr/><p style="margin:0px;margin-left:4px;">+ method1(Type): Type<br/>+ method2(Type, Type): Type</p>',new mxGeometry(0,0,190,140),"verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1");k.vertex=true;m.appendChild(this.createVertexTemplateFromCells([k],190,140));var k=new mxCell("Module",new mxGeometry(0,0,120,60),"shape=component;align=left;spacingLeft=36");k.vertex=true;m.appendChild(this.createVertexTemplateFromCells([k],120,60));var k=new mxCell("&lt;&lt;component&gt;&gt;<br/><b>Component</b>",new mxGeometry(0,0,180,90),"overflow=fill;html=1");k.vertex=true;var c=new mxCell("",new mxGeometry(1,0,20,20),"shape=component;jettyWidth=8;jettyHeight=4;");c.vertex=true;c.connectable=false;c.geometry.relative=true;c.geometry.offset=new mxPoint(-30,10);k.insert(c);m.appendChild(this.createVertexTemplateFromCells([k],180,90));var k=new mxCell('<p style="margin:0px;margin-top:6px;text-align:center;"><b>Component</b></p><hr/><p style="margin:0px;margin-left:8px;">+ Attribute1: Type<br/>+ Attribute2: Type</p>',new mxGeometry(0,0,180,90),"verticalAlign=top;align=left;overflow=fill;html=1");k.vertex=true;var c=new mxCell("",new mxGeometry(1,0,20,20),"shape=component;jettyWidth=8;jettyHeight=4;");c.vertex=true;c.connectable=false;c.geometry.relative=true;c.geometry.offset=new mxPoint(-23,3);k.insert(c);m.appendChild(this.createVertexTemplateFromCells([k],180,90));m.appendChild(this.createVertexTemplate("shape=lollipop;direction=south;",30,10));var d=new mxCell("Block",new mxGeometry(0,0,180,120),"verticalAlign=top;align=left;spacingTop=8;spacingLeft=2;spacingRight=12;shape=cube;size=10;direction=south;fontStyle=4;");d.vertex=true;m.appendChild(this.createVertexTemplateFromCells([d],180,120));m.appendChild(this.createVertexTemplate("shape=folder;fontStyle=1;spacingTop=10;tabWidth=40;tabHeight=14;tabPosition=left;",70,50,"package"));var k=new mxCell('<p style="margin:0px;margin-top:4px;text-align:center;text-decoration:underline;"><b>Object:Type</b></p><hr/><p style="margin:0px;margin-left:8px;">field1 = value1<br/>field2 = value2<br>field3 = value3</p>',new mxGeometry(0,0,160,90),"verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1");k.vertex=true;m.appendChild(this.createVertexTemplateFromCells([k],160,90));var l=new mxCell('<table cellpadding="5" style="font-size:9pt;border:none;border-collapse:collapse;width:100%;"><tr><td colspan="2" style="border:1px solid gray;background:#e4e4e4;">Tablename</td></tr><tr><td style="border:1px solid gray;">PK</td><td style="border:1px solid gray;">uniqueId</td></tr><tr><td style="border:1px solid gray;">FK1</td><td style="border:1px solid gray;">foreignKey</td></tr><tr><td style="border:1px solid gray;"></td><td style="border:1px solid gray;">fieldname</td></tr></table>',new mxGeometry(0,0,180,99),"verticalAlign=top;align=left;overflow=fill;html=1");l.vertex=true;m.appendChild(this.createVertexTemplateFromCells([l],180,99));m.appendChild(this.createVertexTemplate("shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top",40,80,"Actor"));m.appendChild(this.createVertexTemplate("ellipse",140,70,"Use Case"));var d=new mxCell("",new mxGeometry(0,0,30,30),"ellipse;shape=startState;fillColor=#000000;strokeColor=#ff0000;");d.vertex=true;var g=new mxCell("",new mxGeometry(0,0,0,0),"edgeStyle=elbowEdgeStyle;elbow=horizontal;verticalAlign=bottom;endArrow=open;endSize=8;strokeColor=#ff0000;");g.geometry.setTerminalPoint(new mxPoint(15,70),false);g.edge=true;d.insertEdge(g,true);m.appendChild(this.createVertexTemplateFromCells([d,g],30,30));var d=new mxCell("Activity",new mxGeometry(0,0,120,40),"rounded=1;arcSize=40;fillColor=#ffffc0;strokeColor=#ff0000;");d.vertex=true;var g=new mxCell("",new mxGeometry(0,0,0,0),"edgeStyle=elbowEdgeStyle;elbow=horizontal;verticalAlign=bottom;endArrow=open;endSize=8;strokeColor=#ff0000;");g.geometry.setTerminalPoint(new mxPoint(60,80),false);g.edge=true;d.insertEdge(g,true);m.appendChild(this.createVertexTemplateFromCells([d,g],120,40));var d=new mxCell('<div style="margin-top:8px;"><b>Composite State</b><hr/>Subtitle</div>',new mxGeometry(0,0,160,60),"rounded=1;arcSize=40;overflow=fill;html=1;verticalAlign=top;fillColor=#ffffc0;strokeColor=#ff0000;");d.vertex=true;var g=new mxCell("",new mxGeometry(0,0,0,0),"edgeStyle=elbowEdgeStyle;elbow=horizontal;verticalAlign=bottom;endArrow=open;endSize=8;strokeColor=#ff0000;");g.geometry.setTerminalPoint(new mxPoint(80,100),false);g.edge=true;d.insertEdge(g,true);m.appendChild(this.createVertexTemplateFromCells([d,g],160,60));var d=new mxCell("Condition",new mxGeometry(0,0,80,40),"rhombus;fillColor=#ffffc0;strokeColor=#ff0000;");d.vertex=true;var i=new mxCell("no",new mxGeometry(0,0,0,0),"edgeStyle=elbowEdgeStyle;elbow=horizontal;align=left;verticalAlign=bottom;endArrow=open;endSize=8;strokeColor=#ff0000;");i.geometry.setTerminalPoint(new mxPoint(120,20),false);i.geometry.relative=true;i.geometry.x=-1;i.edge=true;d.insertEdge(i,true);var g=new mxCell("yes",new mxGeometry(0,0,0,0),"edgeStyle=elbowEdgeStyle;elbow=horizontal;align=left;verticalAlign=top;endArrow=open;endSize=8;strokeColor=#ff0000;");g.geometry.setTerminalPoint(new mxPoint(40,80),false);g.geometry.relative=true;g.geometry.x=-1;g.edge=true;d.insertEdge(g,true);m.appendChild(this.createVertexTemplateFromCells([d,i,g],80,40));var d=new mxCell("",new mxGeometry(0,0,200,10),"shape=line;strokeWidth=6;strokeColor=#ff0000;");d.vertex=true;var g=new mxCell("",new mxGeometry(0,0,0,0),"edgeStyle=elbowEdgeStyle;elbow=horizontal;verticalAlign=bottom;endArrow=open;endSize=8;strokeColor=#ff0000;");g.geometry.setTerminalPoint(new mxPoint(100,50),false);g.edge=true;d.insertEdge(g,true);m.appendChild(this.createVertexTemplateFromCells([d,g],200,10));m.appendChild(this.createVertexTemplate("ellipse;shape=endState;fillColor=#000000;strokeColor=#ff0000",30,30));var c=new mxCell(":Object",new mxGeometry(0,0,100,50));c.vertex=true;var b=new mxCell("",new mxGeometry(40,50,20,240),"shape=line;direction=north;dashed=1");b.vertex=true;m.appendChild(this.createVertexTemplateFromCells([c,b],100,290));var c=new mxCell("",new mxGeometry(100,0,20,70));c.vertex=true;var i=new mxCell("invoke",new mxGeometry(0,0,0,0),"edgeStyle=elbowEdgeStyle;elbow=vertical;verticalAlign=bottom;endArrow=block;");i.geometry.setTerminalPoint(new mxPoint(0,0),true);i.edge=true;c.insertEdge(i,false);m.appendChild(this.createVertexTemplateFromCells([c,i],120,70));var c=new mxCell("",new mxGeometry(100,0,20,70));c.vertex=true;var i=new mxCell("invoke",new mxGeometry(0,0,0,0),"edgeStyle=elbowEdgeStyle;elbow=vertical;verticalAlign=bottom;endArrow=block;");i.geometry.setTerminalPoint(new mxPoint(0,0),true);i.edge=true;c.insertEdge(i,false);var g=new mxCell("return",new mxGeometry(0,0,0,0),"edgeStyle=elbowEdgeStyle;elbow=vertical;verticalAlign=bottom;dashed=1;endArrow=open;endSize=8;");g.geometry.setTerminalPoint(new mxPoint(0,70),false);g.edge=true;c.insertEdge(g,true);var f=new mxCell("invoke",new mxGeometry(0,0,0,0),"edgeStyle=elbowEdgeStyle;elbow=vertical;align=left;endArrow=open;");f.edge=true;c.insertEdge(f,true);c.insertEdge(f,false);m.appendChild(this.createVertexTemplateFromCells([c,i,g,f],120,70));var n=new mxCell("name",new mxGeometry(0,0,0,0),"endArrow=block;endFill=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;");n.geometry.setTerminalPoint(new mxPoint(0,0),true);n.geometry.setTerminalPoint(new mxPoint(160,0),false);n.geometry.relative=true;n.geometry.x=-1;n.edge=true;var o=new mxCell("1",new mxGeometry(-1,0,0,0),"resizable=0;align=left;verticalAlign=bottom;labelBackgroundColor=#ffffff;fontSize=10");o.geometry.relative=true;o.setConnectable(false);o.vertex=true;n.insert(o);m.appendChild(this.createEdgeTemplateFromCells([n],160,0));var n=new mxCell("",new mxGeometry(0,0,0,0),"endArrow=none;edgeStyle=orthogonalEdgeStyle;");n.geometry.setTerminalPoint(new mxPoint(0,0),true);n.geometry.setTerminalPoint(new mxPoint(160,0),false);n.edge=true;var o=new mxCell("parent",new mxGeometry(-1,0,0,0),"resizable=0;align=left;verticalAlign=bottom;labelBackgroundColor=#ffffff;fontSize=10");o.geometry.relative=true;o.setConnectable(false);o.vertex=true;n.insert(o);var j=new mxCell("child",new mxGeometry(1,0,0,0),"resizable=0;align=right;verticalAlign=bottom;labelBackgroundColor=#ffffff;fontSize=10");j.geometry.relative=true;j.setConnectable(false);j.vertex=true;n.insert(j);m.appendChild(this.createEdgeTemplateFromCells([n],160,0));var n=new mxCell("1",new mxGeometry(0,0,0,0),"endArrow=open;endSize=12;startArrow=diamondThin;startSize=14;startFill=0;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=bottom;");n.geometry.setTerminalPoint(new mxPoint(0,0),true);n.geometry.setTerminalPoint(new mxPoint(160,0),false);n.geometry.relative=true;n.geometry.x=-1;n.edge=true;m.appendChild(this.createEdgeTemplateFromCells([n],160,0));var n=new mxCell("Relation",new mxGeometry(0,0,0,0),"endArrow=open;endSize=12;startArrow=diamondThin;startSize=14;startFill=0;edgeStyle=orthogonalEdgeStyle;");n.geometry.setTerminalPoint(new mxPoint(0,0),true);n.geometry.setTerminalPoint(new mxPoint(160,0),false);n.edge=true;var o=new mxCell("0..n",new mxGeometry(-1,0,0,0),"resizable=0;align=left;verticalAlign=top;labelBackgroundColor=#ffffff;fontSize=10");o.geometry.relative=true;o.setConnectable(false);o.vertex=true;n.insert(o);var j=new mxCell("1",new mxGeometry(1,0,0,0),"resizable=0;align=right;verticalAlign=top;labelBackgroundColor=#ffffff;fontSize=10");j.geometry.relative=true;j.setConnectable(false);j.vertex=true;n.insert(j);m.appendChild(this.createEdgeTemplateFromCells([n],160,0));var n=new mxCell("Use",new mxGeometry(0,0,0,0),"endArrow=open;endSize=12;dashed=1");n.geometry.setTerminalPoint(new mxPoint(0,0),true);n.geometry.setTerminalPoint(new mxPoint(160,0),false);n.edge=true;m.appendChild(this.createEdgeTemplateFromCells([n],160,0));var n=new mxCell("Extends",new mxGeometry(0,0,0,0),"endArrow=block;endSize=16;endFill=0;dashed=1");n.geometry.setTerminalPoint(new mxPoint(0,0),true);n.geometry.setTerminalPoint(new mxPoint(160,0),false);n.edge=true;m.appendChild(this.createEdgeTemplateFromCells([n],160,0));var n=new mxCell("",new mxGeometry(0,0,0,0),"endArrow=block;startArrow=block;endFill=1;startFill=1");n.geometry.setTerminalPoint(new mxPoint(0,0),true);n.geometry.setTerminalPoint(new mxPoint(160,0),false);n.edge=true;m.appendChild(this.createEdgeTemplateFromCells([n],160,0))}))};Sidebar.prototype.addBpmnPalette=function(a,b){this.addStencilPalette("bpmn","BPMN",a+"/bpmn.xml",";fillColor=#ffffff;strokeColor=#000000;perimeter=ellipsePerimeter;",["Cancel","Error","Link","Message","Compensation","Multiple","Rule","Timer"],function(g){g.appendChild(this.createVertexTemplate("swimlane;horizontal=0;",300,160,"Pool"));var d=new mxCell("Process",new mxGeometry(0,0,140,60),"rounded=1");d.vertex=true;var f=new mxCell("",new mxGeometry(1,1,30,30),"shape=mxgraph.bpmn.timer_start;perimeter=ellipsePerimeter;");f.vertex=true;f.geometry.relative=true;f.geometry.offset=new mxPoint(-40,-15);d.insert(f);g.appendChild(this.createVertexTemplateFromCells([d],140,60));var d=new mxCell("Process",new mxGeometry(0,0,140,60),"rounded=1");d.vertex=true;var f=new mxCell("",new mxGeometry(0.5,1,12,12),"shape=plus");f.vertex=true;f.connectable=false;f.geometry.relative=true;f.geometry.offset=new mxPoint(-6,-12);d.insert(f);g.appendChild(this.createVertexTemplateFromCells([d],140,60));var d=new mxCell("Process",new mxGeometry(0,0,140,60),"rounded=1");d.vertex=true;var f=new mxCell("",new mxGeometry(0,0,20,14),"shape=message");f.vertex=true;f.connectable=false;f.geometry.relative=true;f.geometry.offset=new mxPoint(5,5);d.insert(f);g.appendChild(this.createVertexTemplateFromCells([d],140,60));var d=new mxCell("",new mxGeometry(0,0,60,40),"shape=message");d.vertex=true;g.appendChild(this.createEdgeTemplateFromCells([d],60,40));var i=new mxCell("Sequence",new mxGeometry(0,0,0,0),"endArrow=block;endFill=1;endSize=6");i.geometry.setTerminalPoint(new mxPoint(0,0),true);i.geometry.setTerminalPoint(new mxPoint(160,0),false);i.edge=true;g.appendChild(this.createEdgeTemplateFromCells([i],160,0));var i=new mxCell("Default",new mxGeometry(0,0,0,0),"startArrow=dash;startSize=8;endArrow=block;endFill=1;endSize=6");i.geometry.setTerminalPoint(new mxPoint(0,0),true);i.geometry.setTerminalPoint(new mxPoint(160,0),false);i.edge=true;g.appendChild(this.createEdgeTemplateFromCells([i],160,0));var i=new mxCell("Conditional",new mxGeometry(0,0,0,0),"startArrow=diamondThin;startFill=0;startSize=14;endArrow=block;endFill=1;endSize=6");i.geometry.setTerminalPoint(new mxPoint(0,0),true);i.geometry.setTerminalPoint(new mxPoint(160,0),false);i.edge=true;g.appendChild(this.createEdgeTemplateFromCells([i],160,0));var i=new mxCell("",new mxGeometry(0,0,0,0),"startArrow=oval;startFill=0;startSize=7;endArrow=block;endFill=0;endSize=10;dashed=1");i.geometry.setTerminalPoint(new mxPoint(0,0),true);i.geometry.setTerminalPoint(new mxPoint(160,0),false);i.edge=true;g.appendChild(this.createEdgeTemplateFromCells([i],160,0));var i=new mxCell("",new mxGeometry(0,0,0,0),"startArrow=oval;startFill=0;startSize=7;endArrow=block;endFill=0;endSize=10;dashed=1");i.geometry.setTerminalPoint(new mxPoint(0,0),true);i.geometry.setTerminalPoint(new mxPoint(160,0),false);i.edge=true;var c=new mxCell("",new mxGeometry(0,0,20,14),"shape=message");c.geometry.relative=true;c.setConnectable(false);c.vertex=true;c.geometry.offset=new mxPoint(-10,-7);i.insert(c);g.appendChild(this.createEdgeTemplateFromCells([i],160,0));var i=new mxCell("",new mxGeometry(0,0,0,0),"shape=link");i.geometry.setTerminalPoint(new mxPoint(0,0),true);i.geometry.setTerminalPoint(new mxPoint(160,0),false);i.edge=true;g.appendChild(this.createEdgeTemplateFromCells([i],160,0))},0.5)};Sidebar.prototype.createTitle=function(b){var a=document.createElement("a");a.setAttribute("href","javascript:void(0);");a.className="geTitle";mxUtils.write(a,b);return a};Sidebar.prototype.createThumb=function(m,b,k,i){var c=mxText.prototype.getTableSize;if(this.graph.dialect!=mxConstants.DIALECT_SVG){mxText.prototype.getTableSize=function(r){var q=r.parentNode;document.body.appendChild(r);var p=new mxRectangle(0,0,r.offsetWidth,r.offsetHeight);q.appendChild(r);return p}}var f=mxImageShape.prototype.preserveImageAspect;mxImageShape.prototype.preserveImageAspect=false;this.graph.view.rendering=false;this.graph.view.setScale(1);this.graph.addCells(m);var a=this.graph.getGraphBounds();var g=(this.shiftThumbs)?this.thumbBorder+1:this.thumbBorder;var o=Math.min((b-1)/(a.x+a.width+g),(k-1)/(a.y+a.height+g));this.graph.view.setScale(o);this.graph.view.rendering=true;this.graph.refresh();mxImageShape.prototype.preserveImageAspect=f;a=this.graph.getGraphBounds();var n=Math.max(0,Math.floor((b-a.width)/2));var l=Math.max(0,Math.floor((k-a.height)/2));var d=null;if(this.graph.dialect==mxConstants.DIALECT_SVG&&!mxClient.IS_IE){d=this.graph.view.getCanvas().ownerSVGElement.cloneNode(true)}else{if(document.documentMode==8){d=this.graph.container.cloneNode(false);d.innerHTML=this.graph.container.innerHTML}else{d=this.graph.container.cloneNode(true)}}this.graph.getModel().clear();var j=(this.shiftThumbs)?2:3;d.style.position="relative";d.style.overflow="visible";d.style.cursor="pointer";d.style.left=(n+j)+"px";d.style.top=(l+j)+"px";d.style.width=b+"px";d.style.height=k+"px";i.appendChild(d);mxText.prototype.getTableSize=c};Sidebar.prototype.createItem=function(b){var a=document.createElement("a");a.setAttribute("href","javascript:void(0);");a.className="geItem";mxEvent.addListener(a,"click",function(c){mxEvent.consume(c)});this.createThumb(b,this.thumbWidth,this.thumbHeight,a);return a};Sidebar.prototype.createDropHandler=function(a,b){return function(i,f,j,d,k){a=i.getImportableCells(a);if(a.length>0){var g=(j!=null)?i.isValidDropTarget(j,a,f):false;var c=null;if(j!=null&&!g){j=null}if(b&&i.isSplitEnabled()&&i.isSplitTarget(j,a,f)){i.splitEdge(j,a,null,d,k);c=a}else{if(a.length>0){c=i.importCells(a,d,k,j)}}if(c!=null&&c.length>0){i.scrollCellToVisible(c[0]);i.setSelectionCells(c)}}}};Sidebar.prototype.createDragPreview=function(c,a){var b=document.createElement("div");b.style.border="1px dashed black";b.style.width=c+"px";b.style.height=a+"px";return b};Sidebar.prototype.createDragSource=function(c,b,d){var a=mxUtils.makeDraggable(c,this.editorUi.editor.graph,b,d,0,0,this.editorUi.editor.graph.autoscroll,true,true);a.getDropTarget=function(g,f,j){var i=mxDragSource.prototype.getDropTarget.apply(this,arguments);if(!g.isValidRoot(i)){i=null}return i};return a};Sidebar.prototype.addClickHandler=function(a,d){var c=this.editorUi.editor.graph;var f=null;var b=(mxClient.IS_TOUCH)?"touchstart":"mousedown";mxEvent.addListener(a,b,function(i){f=new mxPoint(mxEvent.getClientX(i),mxEvent.getClientY(i))});var g=d.mouseUp;d.mouseUp=function(j){if(!mxEvent.isPopupTrigger(j)&&this.currentGraph==null&&f!=null){var i=c.tolerance;if(Math.abs(f.x-mxEvent.getClientX(j))<=i&&Math.abs(f.y-mxEvent.getClientY(j))<=i){var k=c.getGridSize();d.drop(c,j,null,k,k)}}g.apply(this,arguments);f=null}};Sidebar.prototype.createVertexTemplate=function(d,c,a,f){var b=[new mxCell((f!=null)?f:"",new mxGeometry(0,0,c,a),d)];b[0].vertex=true;return this.createVertexTemplateFromCells(b,c,a)};Sidebar.prototype.createVertexTemplateFromCells=function(c,d,a){var b=this.createItem(c);var f=this.createDragSource(b,this.createDropHandler(c,true),this.createDragPreview(d,a));this.addClickHandler(b,f);f.isGuidesEnabled=mxUtils.bind(this,function(){return this.editorUi.editor.graph.graphHandler.guidesEnabled});if(!touchStyle){mxEvent.addListener(b,"mousemove",mxUtils.bind(this,function(g){this.showTooltip(b,c)}))}return b};Sidebar.prototype.createEdgeTemplate=function(d,c,a,f){var b=[new mxCell((f!=null)?f:"",new mxGeometry(0,0,c,a),d)];b[0].geometry.setTerminalPoint(new mxPoint(0,a),true);b[0].geometry.setTerminalPoint(new mxPoint(c,0),false);b[0].edge=true;return this.createEdgeTemplateFromCells(b,c,a)};Sidebar.prototype.createEdgeTemplateFromCells=function(c,d,a){var b=this.createItem(c);this.createDragSource(b,this.createDropHandler(c,false),this.createDragPreview(d,a));var f=this.editorUi.editor.graph;mxEvent.addListener(b,"click",mxUtils.bind(this,function(g){if(this.installEdges){f.connectionHandler.createEdgeState=function(i){return f.view.createState(c[0])};f.connectionHandler.factoryMethod=function(){return f.cloneCells([c[0]])[0]}}b.style.backgroundColor="#ffffff";window.setTimeout(function(){b.style.backgroundColor=""},200);mxEvent.consume(g)}));if(!touchStyle){mxEvent.addListener(b,"mousemove",mxUtils.bind(this,function(g){this.showTooltip(b,c)}))}return b};Sidebar.prototype.addPalette=function(i,f,a,d){var b=this.createTitle(f);this.container.appendChild(b);var g=document.createElement("div");g.className="geSidebar";if(a){d(g);d=null}else{g.style.display="none"}this.addFoldingHandler(b,g,d);var c=document.createElement("div");c.appendChild(g);this.container.appendChild(c);if(i!=null){this.palettes[i]=[b,c]}};Sidebar.prototype.addFoldingHandler=function(d,b,a){var c=false;d.style.backgroundImage=(b.style.display=="none")?"url("+IMAGE_PATH+"/collapsed.gif)":"url("+IMAGE_PATH+"/expanded.gif)";d.style.backgroundRepeat="no-repeat";d.style.backgroundPosition="100% 50%";mxEvent.addListener(d,"click",function(f){if(b.style.display=="none"){if(!c){c=true;if(a!=null){a(b)}}d.style.backgroundImage="url("+IMAGE_PATH+"/expanded.gif)";b.style.display="block"}else{d.style.backgroundImage="url("+IMAGE_PATH+"/collapsed.gif)";b.style.display="none"}mxEvent.consume(f)})};Sidebar.prototype.removePalette=function(c){var b=this.palettes[c];if(b!=null){this.palettes[c]=null;for(var a=0;a<b.length;a++){this.container.removeChild(b[a])}return true}return false};Sidebar.prototype.addImagePalette=function(f,c,b,d,a){this.addPalette(f,c,false,mxUtils.bind(this,function(k){for(var g=0;g<a.length;g++){var j=b+a[g]+d;k.appendChild(this.createVertexTemplate("image;image="+j,80,80,""))}}))};Sidebar.prototype.addStencilPalette=function(i,f,a,b,g,c,d){d=(d!=null)?d:1;this.addPalette(i,f,true,mxUtils.bind(this,function(j){if(b==null){b=""}if(c!=null){c.call(this,j)}mxStencilRegistry.loadStencilSet(a,mxUtils.bind(this,function(m,n,l,k,o){if(g==null||mxUtils.indexOf(g,n)<0){j.appendChild(this.createVertexTemplate("shape="+m+n.toLowerCase()+b,Math.round(k*d),Math.round(o*d),""))}}),true)}))};function Toolbar(b,a){this.editorUi=b;this.container=a;this.init();var c=(mxClient.IS_TOUCH)?"touchstart":"mousedown";mxEvent.addListener(document,c,mxUtils.bind(this,function(d){this.hideMenu()}))}Toolbar.prototype.init=function(){this.addItems(["save","import","export","-"]);this.addItems(["undo","redo","delete","-","actualSize","zoomIn","zoomOut","-"]);var a=this.addMenu("12",mxResources.get("fontSize"),true,"fontSize");a.style.whiteSpace="nowrap";a.style.overflow="hidden";a.style.width="30px";this.addItems(["-","bold","italic"]);var f=this.addMenuFunction("geSprite-left",mxResources.get("align"),false,mxUtils.bind(this,function(g){this.editorUi.menus.styleChange(g,"",[mxConstants.STYLE_ALIGN],[mxConstants.ALIGN_LEFT],"geIcon geSprite geSprite-left",null).setAttribute("title",mxResources.get("left"));this.editorUi.menus.styleChange(g,"",[mxConstants.STYLE_ALIGN],[mxConstants.ALIGN_CENTER],"geIcon geSprite geSprite-center",null).setAttribute("title",mxResources.get("center"));this.editorUi.menus.styleChange(g,"",[mxConstants.STYLE_ALIGN],[mxConstants.ALIGN_RIGHT],"geIcon geSprite geSprite-right",null).setAttribute("title",mxResources.get("right"));this.editorUi.menus.styleChange(g,"",[mxConstants.STYLE_VERTICAL_ALIGN],[mxConstants.ALIGN_TOP],"geIcon geSprite geSprite-top",null).setAttribute("title",mxResources.get("top"));this.editorUi.menus.styleChange(g,"",[mxConstants.STYLE_VERTICAL_ALIGN],[mxConstants.ALIGN_MIDDLE],"geIcon geSprite geSprite-middle",null).setAttribute("title",mxResources.get("middle"));this.editorUi.menus.styleChange(g,"",[mxConstants.STYLE_VERTICAL_ALIGN],[mxConstants.ALIGN_BOTTOM],"geIcon geSprite geSprite-bottom",null).setAttribute("title",mxResources.get("bottom"))}));this.addItems(["fontColor","-"]);var b=this.addMenuFunction("geSprite-straight",mxResources.get("line"),false,mxUtils.bind(this,function(g){this.editorUi.menus.styleChange(g,"",[mxConstants.STYLE_EDGE],[null],"geIcon geSprite geSprite-straight",null).setAttribute("title",mxResources.get("straight"));this.editorUi.menus.styleChange(g,"",[mxConstants.STYLE_EDGE],["entityRelationEdgeStyle"],"geIcon geSprite geSprite-entity",null).setAttribute("title",mxResources.get("entityRelation"));this.editorUi.menus.styleChange(g,"",[mxConstants.STYLE_EDGE,mxConstants.STYLE_ELBOW],["elbowEdgeStyle","horizontal"],"geIcon geSprite geSprite-helbow",null).setAttribute("title",mxResources.get("horizontal"));this.editorUi.menus.styleChange(g,"",[mxConstants.STYLE_EDGE,mxConstants.STYLE_ELBOW],["elbowEdgeStyle","vertical"],"geIcon geSprite geSprite-velbow",null).setAttribute("title",mxResources.get("vertical"));this.editorUi.menus.styleChange(g,"",[mxConstants.STYLE_EDGE],["segmentEdgeStyle"],"geIcon geSprite geSprite-segment",null).setAttribute("title",mxResources.get("plain"));this.editorUi.menus.styleChange(g,"",[mxConstants.STYLE_EDGE],["orthogonalEdgeStyle"],"geIcon geSprite geSprite-orthogonal",null).setAttribute("title",mxResources.get("orthogonal"))}));this.addItems(["-","strokeColor","fillColor"]);this.addItem("geSprite-gradientcolor","gradientColor").setAttribute("title",mxResources.get("gradient"));this.addItems(["shadow"]);var c=this.editorUi.editor.graph;var d=mxUtils.bind(this,function(){var i="Helvetica";var g="12";var j=c.getView().getState(c.getSelectionCell());if(j!=null){i=j.style[mxConstants.STYLE_FONTFAMILY]||i;g=j.style[mxConstants.STYLE_FONTSIZE]||g;if(i.length>10){i=i.substring(0,8)+"..."}a.innerHTML=g}});c.getSelectionModel().addListener(mxEvent.CHANGE,d);c.getModel().addListener(mxEvent.CHANGE,d);this.addEdgeSelectionHandler([b]);this.addSelectionHandler([f])};Toolbar.prototype.hideMenu=function(){if(this.currentMenu!=null){this.currentMenu.hideMenu();this.currentMenu.destroy();this.currentMenu=null}};Toolbar.prototype.addMenu=function(c,f,d,b){var g=this.editorUi.menus.get(b);var a=this.addMenuFunction(c,f,d,g.funct);g.addListener("stateChanged",function(){a.setEnabled(g.enabled)});return a};Toolbar.prototype.addMenuFunction=function(c,f,d,a){var b=(d)?this.createLabel(c):this.createButton(c);this.initElement(b,f);this.addMenuHandler(b,d,a);this.container.appendChild(b);return b};Toolbar.prototype.addSeparator=function(){var a=document.createElement("div");a.className="geSeparator";this.container.appendChild(a);return a};Toolbar.prototype.addItems=function(c){for(var b=0;b<c.length;b++){var a=c[b];if(a=="-"){this.addSeparator()}else{this.addItem("geSprite-"+a.toLowerCase(),a)}}};Toolbar.prototype.addItem=function(c,b){var d=this.editorUi.actions.get(b);var a=null;if(d!=null){a=this.addButton(c,d.label,d.funct);a.setEnabled(d.enabled);d.addListener("stateChanged",function(){a.setEnabled(d.enabled)})}return a};Toolbar.prototype.addButton=function(d,c,a){var b=this.createButton(d);this.initElement(b,c);this.addClickHandler(b,a);this.container.appendChild(b);return b};Toolbar.prototype.addSelectionHandler=function(a){var c=this.editorUi.editor.graph;var b=function(){var f=!c.isSelectionEmpty();for(var d=0;d<a.length;d++){a[d].setEnabled(f)}};c.getSelectionModel().addListener(mxEvent.CHANGE,b);b()};Toolbar.prototype.addEdgeSelectionHandler=function(a){var c=this.editorUi.editor.graph;var b=function(){var d=false;if(!c.isSelectionEmpty()){var f=c.getSelectionCells();for(var g=0;g<f.length;g++){if(c.getModel().isEdge(f[g])){d=true;break}}}for(var g=0;g<a.length;g++){a[g].setEnabled(d)}};c.getSelectionModel().addListener(mxEvent.CHANGE,b);b()};Toolbar.prototype.initElement=function(a,b){a.setAttribute("tabindex","0");if(b!=null){a.setAttribute("title",b)}this.addEnabledState(a)};Toolbar.prototype.addEnabledState=function(a){var b=a.className;a.setEnabled=function(c){a.enabled=c;if(c){a.className=b}else{a.className=b+" geDisabled"}};a.setEnabled(true)};Toolbar.prototype.addClickHandler=function(b,a){if(a!=null){mxEvent.addListener(b,"click",function(c){if(b.enabled){a(c)}mxEvent.consume(c)})}};Toolbar.prototype.createButton=function(c){var b=document.createElement("a");b.setAttribute("href","javascript:void(0);");b.className="geButton";var a=document.createElement("div");a.className="geSprite "+c;b.appendChild(a);return b};Toolbar.prototype.createLabel=function(b,c){var a=document.createElement("a");a.setAttribute("href","javascript:void(0);");a.className="geLabel";mxUtils.write(a,b);return a};Toolbar.prototype.addMenuHandler=function(b,f,a,c){if(a!=null){var d=this.editorUi.editor.graph;var g=null;mxEvent.addListener(b,"click",mxUtils.bind(this,function(i){if(b.enabled==null||b.enabled){d.panningHandler.hideMenu();g=new mxPopupMenu(a);g.div.className+=" geToolbarMenu";g.showDisabled=c;g.labels=f;g.autoExpand=true;g.popup(b.offsetLeft,b.offsetTop+b.offsetHeight+4,null,i);this.currentMenu=g}mxEvent.consume(i)}))}};
